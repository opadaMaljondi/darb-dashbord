import{_ as X,Z as ee,B as te,$ as se,P as ae,S as ie,W as k,D as oe,r as M,o as le,g as p,i as C,y as ne,w as r,a as re,N as de,Y as b,l as n,n as e,J as i,k as q,F as Z,L as J,C as K,t as ce,M as _e,z as P}from"./vendor-54d6cb1e.js";import{L as ue}from"./dispatchmain-7b8a389c.js";import{P as me}from"./page-header-ff719701.js";import{F as ve}from"./FormValidation-cabc17c8.js";import"./footer-7e4f68d9.js";import"./dispatchHorizontal-f9ab2bd0.js";import"./app-cb082573.js";const ge={data(){return{rightOffcanvas:!1}},components:{Layout:ue,PageHeader:me,Head:ee,Link:te,Scrollbar:se,FormValidation:ve,flatPickr:ae},computed:{...ie(["permissions"])},props:{successMessage:String,alertMessage:String,firebaseSettings:Array,app_for:String,map_key:String,driver_radius:Number,result:Object},methods:{timer(){let s;k.fire({title:"Booking alert!",html:"Your Ride has been Booked <b></b> Successfully.",timer:2e3,timerProgressBar:!0,didOpen:()=>{k.showLoading(),s=setInterval(()=>{k.getContent().querySelector("b").textContent=k.getTimerLeft()},100)},didClose:()=>{clearInterval(s)}}).then(t=>{t.dismiss===k.DismissReason.timer&&console.log("I was closed by the timer")})}},setup(s){const{t}=oe(),c=M(!1),m=M(s.driver_radius??10),H=M(s.successMessage||""),N=M(s.alertMessage||""),A=()=>{H.value="",N.value=""},S=M(""),f=M([]),x=M(null),v=M(s.result),R=a=>{L.setView(a.latlng,15)},O=a=>{x.value=a,c.value=!0},F=async a=>{try{const _=await re.post(`/dispatcher/ongoing_request/assign-driver/${v.value.id}`,{driver_id:a.id});_.data.status?(c.value=!1,k.fire(t("success"),t("users_deleted_successfully"),"success")):(k.fire(t("Warning"),_.data.message,"warning"),console.log(_))}catch(_){k.fire(t("Warning"),response.data.message,"warning"),console.error(_)}},E=(a,_,u,d)=>{const B=(u-a)*Math.PI/180,w=(d-_)*Math.PI/180,h=Math.sin(B/2)*Math.sin(B/2)+Math.cos(a*Math.PI/180)*Math.cos(u*Math.PI/180)*Math.sin(w/2)*Math.sin(w/2);return 6371*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)))},$=()=>{f.value=[];const a=firebase.database().ref("drivers");firebase.database().ref("requests").child(v.value.id).on("value",u=>{const d=u.val();d&&(d.is_accept||"driver_id"in d)&&de.get(`/dispatcher/rides_request/view/${v.value.id}`)}),a.on("value",u=>{f.value=[],u.forEach(d=>{const l=d.val(),w=Date.now()-15*60*1e3;if(l.updated_at<w)return;const h=o(l.g);let I=!0;if(S.value.length>0&&l.name&&(I=l.name.includes(S.value)||l.mobile.includes(S.value)),h&&I)if(E(v.value.pick_lat,v.value.pick_lng,h.lat,h.lon)<=m.value&&l.is_available&&l.is_active&&l.vehicle_types.includes(v.value.vehicle_type_id)){let z=`/image/map/${l.vehicle_type_icon}-online.png`;const T=[h.lat,h.lon];if(l.latlng=T,f.value.push(l),g[l.id])y(g[l.id],g[l.id].getLatLng(),T),g[l.id].setIcon(b.icon({iconUrl:z,iconSize:[30,30]}));else{const D=b.marker(T,{icon:b.icon({iconUrl:z,iconSize:[30,30]})}).addTo(L);D.bindTooltip(`<strong>${l.name}</strong><br>Mobile: ${s.app_for=="demo"?"***********":l.mobile}`,{permanent:!1,direction:"top",offset:[0,-10]}),g[l.id]=D,y(D,D.getLatLng(),T)}}else G(l.id)})}),a.on("child_changed",u=>{const d=u.val();j(d)}),a.on("child_removed",u=>{const d=u.val();G(d.id)})},o=a=>{const _="0123456789bcdefghjkmnpqrstuvwxyz",u=[16,8,4,2,1];let d=!0,l=-90,B=90,w=-180,h=180,I,U;if(a){for(let z=0;z<a.length;z++){let T=a.charAt(z),D=_.indexOf(T);for(let W=0;W<5;W++){let Y=u[W];if(d){let V=(w+h)/2;D&Y?w=V:h=V}else{let V=(l+B)/2;D&Y?l=V:B=V}d=!d}}return I=(l+B)/2,U=(w+h)/2,{lat:I,lon:U}}return null};watch(S.value,debounce(function(a){$()},300));const y=(a,_,u)=>{a.setLatLng(u).update()},j=a=>{const _=o(a.g);if(_){const u=[_.lat,_.lon],d=`/image/map/${a.vehicle_type_icon}.png`;if(g[a.id])y(g[a.id],g[a.id].getLatLng(),u),g[a.id].setIcon(b.icon({iconUrl:d,iconSize:[30,30]}));else{const l=b.marker(u,{icon:b.icon({iconUrl:d,iconSize:[30,30]})}).addTo(L);g[a.id]=l}}else console.error(`${t("failed_to_decode_geohash")} ${a.id}`)},G=a=>{g[a]&&(L.removeLayer(g[a]),delete g[a])};let L,g={};const Q=()=>{L=b.map("map").setView([v.value.pick_lat,v.value.pick_lng],15),b.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(L);const a=b.icon({iconUrl:"/image/map/pickup.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]});b.marker([v.value.pick_lat,v.value.pick_lng],{icon:a}).addTo(L),$()};return le(async()=>{try{var a={apiKey:s.firebaseSettings.firebase_api_key,authDomain:s.firebaseSettings.firebase_auth_domain,databaseURL:s.firebaseSettings.firebase_database_url,projectId:s.firebaseSettings.firebase_project_id,storageBucket:s.firebaseSettings.firebase_storage_bucket,messagingSenderId:s.firebaseSettings.firebase_messaging_sender_id,appId:s.firebaseSettings.firebase_app_id};firebase.apps.length||firebase.initializeApp(a),Q()}catch(_){console.error(t("error_initializing_firebase_or_fetching_settings"),_)}}),{modalShow:c,successMessage:H,alertMessage:N,modalDriver:x,driverSearch:S,assignDriver:F,assignModal:O,fleetDrivers:f,dismissMessage:A,errors:{},driverFocus:R}}},he={class:"col-lg-3"},fe={class:"card-header"},pe={class:"card-title mb-0"},be={class:"card-body p-4 text-center"},ye={class:"mx-auto avatar-md mb-3"},we=["src"],ke={class:"card-title mb-1"},Me={class:"text-muted mb-0"},Se={class:"col-lg-3"},xe={class:"card-header"},Le={class:"card-title mb-0"},Be={class:"card-body p-4 text-center"},De={class:"mx-auto avatar-md mb-3"},Ce=["src"],Ie={class:"card-title mb-1"},ze={class:"col-lg-6"},Te={class:"card-header"},qe={class:"card-title mb-0"},Pe={class:"card-body p-4"},Re={class:"mb-2"},Ve={class:"mb-2"},$e={key:0},je={class:"mb-2"},Ue={class:"mb-2"},He={class:"btn-group mb-2"},Ne={class:"btn btn-light dropdown-toggle",type:"button",id:"stop_locations_list","data-bs-toggle":"dropdown","data-bs-auto-close":"outside","aria-expanded":"false"},Ae={class:"dropdown-menu overflow-auto",style:{"max-width":"500px"},"aria-labelledby":"stop_locations_list"},Oe={class:"dropdown-item overflow-auto"},Fe={key:1},Ee={class:"mb-2"},We={class:"mb-2"},Ge={class:"position-relative col-lg-4"},Ye={class:"row"},Ze={class:"col-12 col-lg-5",style:{"overflow-x":"auto"}},Je={class:"row"},Ke={class:"row"},Qe=["onClick"],Xe={class:"col-sm-2 border-end d-flex align-items-center justify-content-center"},et=["src"],tt={class:"col-sm-4 mt-3 border-end"},st={class:"d-flex align-items-center"},at={class:"d-flex align-items-center"},it={class:"d-flex align-items-center"},ot={class:"col-sm-6 d-flex align-items-center"},lt={class:"row"},nt={class:"col-lg-12"},rt=["onClick"],dt={class:"col-lg-12"},ct={class:"d-flex list-inline mb-0 mt-3"},_t={class:"list-inline-item avatar-xs"},ut=["title"],mt={class:"mt-2",style:{width:"max-content"}},vt={class:"list-inline-item avatar-xs ms-5"},gt=["title"],ht={class:"mt-2",style:{width:"max-content"}},ft={class:"list-inline-item avatar-xs ms-5"},pt=["title"],bt={class:"mt-2",style:{width:"max-content"}},yt={class:"col-12 col-lg-7"},wt={class:"mb-3 text-center m-auto"},kt={id:"map",style:{height:"500px"}},Mt={class:"col-lg-12"},St={class:"card-header"},xt={class:"card-title mb-0"},Lt={class:"card-body p-4 text-center"},Bt={class:"mx-auto avatar-md mb-3"},Dt=["src"],Ct={class:"card-title mb-1"},It={class:"text-muted mb-0"},zt={class:"text-muted mb-0"},Tt={class:"modal-footer v-modal-footer"};function qt(s,t,c,m,H,N){const A=p("Head"),S=p("PageHeader"),f=p("BRow"),x=p("BCardBody"),v=p("BCard"),R=p("BCol"),O=p("BCardHeader"),F=p("BLink"),E=p("BModal"),$=p("Layout");return C(),ne($,null,{default:r(()=>[n(A,{title:"Taxi Ride"}),n(S,{title:s.$t("book"),pageTitle:s.$t("taxi_ride"),pageLink:"/dispatcher/ongoing_request"},null,8,["title","pageTitle"]),n(f,null,{default:r(()=>[n(R,null,{default:r(()=>[n(v,null,{default:r(()=>[n(x,null,{default:r(()=>[n(f,null,{default:r(()=>[e("div",he,[e("div",fe,[e("h6",pe,i(s.$t("user_details")),1)]),e("div",be,[e("div",ye,[e("img",{src:c.result.userDetail.data.profile_picture,alt:"2",class:"avatar-md rounded-circle"},null,8,we)]),e("h5",ke,i(c.result.userDetail.data.name),1),e("p",Me,i(c.app_for=="demo"?"***********":c.result.userDetail.data.mobile),1)])]),e("div",Se,[e("div",xe,[e("h6",Le,i(s.$t("vehicle_details")),1)]),e("div",Be,[e("div",De,[e("img",{src:c.result.vehicle_type_image,alt:"2",class:"avatar-md rounded-circle"},null,8,Ce)]),e("h5",Ie,i(c.result.vehicle_type_name),1)])]),e("div",ze,[e("div",Te,[e("h6",qe,i(s.$t("trip_details")),1)]),e("div",Pe,[e("h5",Re,[e("b",null,i(s.$t("pickup_location")),1)]),e("h6",Ve,i(c.result.pick_address),1),c.result.requestStops.data.length>0?(C(),q("div",$e,[e("h5",je,[e("b",null,i(s.$t("stop_location")),1)]),e("h5",Ue,[e("b",null,i(s.$t("stop_location")),1)]),e("div",He,[e("button",Ne,i(s.$t("view_stop_location")),1),e("ul",Ae,[(C(!0),q(Z,null,J(c.result.requestStops.data,(o,y)=>(C(),q("li",null,[e("a",Oe,i(o.address),1)]))),256))])])])):K("",!0),c.result.is_rental?K("",!0):(C(),q("div",Fe,[e("h5",Ee,[e("b",null,i(s.$t("drop_location")),1)]),e("h6",We,i(c.result.drop_address),1)]))])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n(f,null,{default:r(()=>[n(R,{lg:"12"},{default:r(()=>[n(v,{"no-body":"",id:"tasksList"},{default:r(()=>[n(O,{class:"border-0"},{default:r(()=>[e("div",Ge,[ce(e("input",{type:"text",class:"form-control",placeholder:"Search...","onUpdate:modelValue":t[0]||(t[0]=o=>m.driverSearch=o),autocomplete:"off",id:"search-options",value:""},null,512),[[_e,m.driverSearch]])])]),_:1}),n(x,{class:"border border-dashed border-end-0 border-start-0"},{default:r(()=>[e("div",Ye,[e("div",Ze,[e("div",Je,[n(f,null,{default:r(()=>[n(v,{"no-body":""},{default:r(()=>[n(x,{class:"overflow-y-auto",style:{"max-height":"500px",width:"100%"}},{default:r(()=>[n(R,{xl:"12"},{default:r(()=>[e("div",Ke,[(C(!0),q(Z,null,J(m.fleetDrivers,o=>(C(),q("div",{key:o.driver_id,onClick:y=>m.driverFocus(o),class:"row"},[e("div",Xe,[e("div",null,[e("img",{class:"rounded-circle avatar-md",alt:"200x200",src:o.profile_picture},null,8,et)])]),e("div",tt,[e("div",st,[t[4]||(t[4]=e("i",{class:"ri-user-line",style:{"font-size":"20px"}},null,-1)),t[5]||(t[5]=P("    ",-1)),e("span",null,i(o.name),1)]),e("div",at,[t[6]||(t[6]=e("i",{class:"ri-phone-line",style:{"font-size":"20px"}},null,-1)),t[7]||(t[7]=P("    ",-1)),e("span",null,i(c.app_for=="demo"?"***********":o.mobile),1)]),e("div",it,[t[8]||(t[8]=e("i",{class:"ri-star-fill",style:{"font-size":"20px"}},null,-1)),t[9]||(t[9]=P("    ",-1)),e("span",null,i(o.rating),1)])]),e("div",ot,[e("div",lt,[e("div",nt,[e("div",null,[e("button",{onClick:y=>m.assignModal(o),type:"button",class:"btn btn-info btn-label waves-effect waves-light"},[t[10]||(t[10]=e("i",{class:"ri-car-line label-icon fs-20 align-middle me-2"},null,-1)),P(" "+i(s.$t("assign")),1)],8,rt)])]),e("div",dt,[e("ul",ct,[e("li",_t,[e("a",{href:"javascript:void(0);",class:"avatar-title bg-success-subtle text-success fs-15 rounded","data-bs-toggle":"tooltip","data-bs-placement":"top",title:s.$t("today_rides_distance")},[...t[11]||(t[11]=[e("i",{class:"ri-pin-distance-line"},null,-1)])],8,ut),e("h6",mt,i(o.total_kms?o.total_kms:"-"),1)]),e("li",vt,[e("a",{href:"javascript:void(0);",class:"avatar-title bg-danger-subtle text-danger fs-15 rounded","data-bs-toggle":"tooltip","data-bs-placement":"top",title:s.$t("today_rides_taken")},[...t[12]||(t[12]=[e("i",{class:"ri-police-car-fill"},null,-1)])],8,gt),e("h6",ht,i(o.total_rides_taken),1)]),e("li",ft,[e("a",{href:"javascript:void(0);",class:"avatar-title bg-warning-subtle text-warning fs-15 rounded","data-bs-toggle":"tooltip","data-bs-placement":"top",title:s.$t("today_active")},[...t[13]||(t[13]=[e("i",{class:"ri-map-pin-time-line"},null,-1)])],8,pt),e("h6",bt,i(o.total_active_hrs?o.total_active_hrs:"-"),1)])])])])])],8,Qe))),128))])]),_:1})]),_:1})]),_:1})]),_:1})])]),e("div",yt,[e("div",wt,[e("div",kt,i(s.$t("map_loading")),1)])])])]),_:1})]),_:1})]),_:1})]),_:1}),e("div",null,[n(E,{modelValue:m.modalShow,"onUpdate:modelValue":t[3]||(t[3]=o=>m.modalShow=o),"hide-footer":"",title:s.$t("driver_details"),class:"v-modal-custom",size:"sm"},{default:r(()=>[n(v,null,{default:r(()=>[n(x,null,{default:r(()=>[n(f,null,{default:r(()=>{var o,y,j;return[e("div",Mt,[e("div",St,[e("h6",xt,i(s.$t("confirm_assign_driver")),1)]),e("div",Lt,[e("div",Bt,[e("img",{src:(o=m.modalDriver)==null?void 0:o.profile_picture,alt:"2",class:"avatar-md rounded-circle"},null,8,Dt)]),e("h5",Ct,i((y=m.modalDriver)==null?void 0:y.name),1),e("p",It,i(c.app_for=="demo"?"***********":(j=m.modalDriver)==null?void 0:j.mobile),1)]),e("p",zt,i(s.$t("confirm_assign_driver_info")),1)])]}),_:1})]),_:1})]),_:1}),e("div",Tt,[n(F,{href:"javascript:void(0);",class:"btn btn-link link-warning fw-medium",onClick:t[1]||(t[1]=o=>m.modalShow=!1)},{default:r(()=>[t[14]||(t[14]=e("i",{class:"ri-close-line me-1 align-middle"},null,-1)),P(" "+i(s.$t("close")),1)]),_:1}),e("button",{type:"button",class:"btn btn-soft-info waves-effect waves-light",onClick:t[2]||(t[2]=o=>m.assignDriver(m.modalDriver))},[t[15]||(t[15]=e("i",{class:"ri-car-line me-1 align-middle"},null,-1)),P(" "+i(s.$t("assign_driver")),1)])])]),_:1},8,["modelValue","title"])])]),_:1})}const Nt=X(ge,[["render",qt]]);export{Nt as default};
