import{_ as Q,Z as X,B as ee,$ as te,P as se,S as ae,W as w,D as oe,r as x,o as ie,g as h,i as B,y as ne,w as r,a as le,Y as p,l as n,n as e,J as o,k as T,F as Y,L as Z,C as J,z as P,N as re}from"./vendor-54d6cb1e.js";import{L as de}from"./main-b839be26.js";import{P as ce}from"./page-header-ff719701.js";import{F as _e}from"./FormValidation-cabc17c8.js";import"./footer-7e4f68d9.js";import"./app-cb082573.js";const ue={data(){return{rightOffcanvas:!1}},components:{Layout:de,PageHeader:ce,Head:X,Link:ee,Scrollbar:te,FormValidation:_e,flatPickr:se},computed:{...ae(["permissions"])},props:{successMessage:String,alertMessage:String,firebaseSettings:Array,app_for:String,map_key:String,driver_radius:Number,result:Object},methods:{timer(){let s;w.fire({title:"Booking alert!",html:"Your Ride has been Booked <b></b> Successfully.",timer:2e3,timerProgressBar:!0,didOpen:()=>{w.showLoading(),s=setInterval(()=>{w.getContent().querySelector("b").textContent=w.getTimerLeft()},100)},didClose:()=>{clearInterval(s)}}).then(a=>{a.dismiss===w.DismissReason.timer&&console.log("I was closed by the timer")})}},setup(s){const{t:a}=oe(),d=x(!1),f=x(s.driver_radius??10),j=x(s.successMessage||""),H=x(s.alertMessage||""),N=()=>{j.value="",H.value=""},C=x([]),b=x(null),m=x(s.result),D=t=>{L.setView(t.latlng,15)},R=t=>{b.value=t,d.value=!0},O=async t=>{try{const c=await le.post(`/ongoing-rides/assign-driver/${m.value.id}`,{driver_id:t.id});c.data.status?(d.value=!1,w.fire(a("success"),a("users_deleted_successfully"),"success")):(w.fire(a("Warning"),c.data.message,"warning"),console.log(c))}catch(c){w.fire(a("Warning"),response.data.message,"warning"),console.error(c)}},A=(t,c,_,u)=>{const S=(_-t)*Math.PI/180,y=(u-c)*Math.PI/180,g=Math.sin(S/2)*Math.sin(S/2)+Math.cos(t*Math.PI/180)*Math.cos(_*Math.PI/180)*Math.sin(y/2)*Math.sin(y/2);return 6371*(2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g)))},F=()=>{C.value=[];const t=firebase.database().ref("drivers");firebase.database().ref("requests").child(m.value.id).on("value",_=>{const u=_.val();(u.is_accept||u.hasOwnProperty("driver_id"))&&re.get(`/rides-request/view/${m.value.id}`)}),t.on("value",_=>{C.value=[],_.forEach(u=>{const i=u.val(),y=Date.now()-15*60*1e3;if(i.updated_at<y)return;const g=$(i.g);if(g)if(A(m.value.pick_lat,m.value.pick_lng,g.lat,g.lon)<=f.value&&i.is_available&&i.is_active&&i.vehicle_types.includes(m.value.vehicle_type_id)){let I=`/image/map/${i.vehicle_type_icon}-online.png`;const k=[g.lat,g.lon];if(i.latlng=k,C.value.push(i),v[i.id])l(v[i.id],v[i.id].getLatLng(),k),v[i.id].setIcon(p.icon({iconUrl:I,iconSize:[30,30]}));else{const z=p.marker(k,{icon:p.icon({iconUrl:I,iconSize:[30,30]})}).addTo(L);z.bindTooltip(`<strong>${i.name}</strong><br>Mobile: ${s.app_for=="demo"?"***********":i.mobile}`,{permanent:!1,direction:"top",offset:[0,-10]}),v[i.id]=z,l(z,z.getLatLng(),k)}}else q(i.id)})}),t.on("child_changed",_=>{const u=_.val();M(u)}),t.on("child_removed",_=>{const u=_.val();q(u.id)})},$=t=>{const c="0123456789bcdefghjkmnpqrstuvwxyz",_=[16,8,4,2,1];let u=!0,i=-90,S=90,y=-180,g=180,U,I;if(t){for(let k=0;k<t.length;k++){let z=t.charAt(k),W=c.indexOf(z);for(let E=0;E<5;E++){let G=_[E];if(u){let V=(y+g)/2;W&G?y=V:g=V}else{let V=(i+S)/2;W&G?i=V:S=V}u=!u}}return U=(i+S)/2,I=(y+g)/2,{lat:U,lon:I}}return null},l=(t,c,_)=>{t.setLatLng(_).update()},M=t=>{const c=$(t.g);if(c){const _=[c.lat,c.lon],u=`/image/map/${t.vehicle_type_icon}.png`;if(v[t.id])l(v[t.id],v[t.id].getLatLng(),_),v[t.id].setIcon(p.icon({iconUrl:u,iconSize:[30,30]}));else{const i=p.marker(_,{icon:p.icon({iconUrl:u,iconSize:[30,30]})}).addTo(L);v[t.id]=i}}else console.error(`${a("failed_to_decode_geohash")} ${t.id}`)},q=t=>{v[t]&&(L.removeLayer(v[t]),delete v[t])};let L,v={};const K=()=>{L=p.map("map").setView([m.value.pick_lat,m.value.pick_lng],15),p.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(L);const t=p.icon({iconUrl:"/image/map/pickup.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]});p.marker([m.value.pick_lat,m.value.pick_lng],{icon:t}).addTo(L),F()};return ie(async()=>{try{var t={apiKey:s.firebaseSettings.firebase_api_key,authDomain:s.firebaseSettings.firebase_auth_domain,databaseURL:s.firebaseSettings.firebase_database_url,projectId:s.firebaseSettings.firebase_project_id,storageBucket:s.firebaseSettings.firebase_storage_bucket,messagingSenderId:s.firebaseSettings.firebase_messaging_sender_id,appId:s.firebaseSettings.firebase_app_id};firebase.apps.length||firebase.initializeApp(t),K()}catch(c){console.error(a("error_initializing_firebase_or_fetching_settings"),c)}}),{modalShow:d,successMessage:j,alertMessage:H,modalDriver:b,assignDriver:O,assignModal:R,fleetDrivers:C,dismissMessage:N,errors:{},driverFocus:D}}},me={class:"col-lg-3"},fe={class:"card-header"},ve={class:"card-title mb-0"},ge={class:"card-body p-4 text-center"},he={class:"mx-auto avatar-md mb-3"},pe=["src"],be={class:"card-title mb-1"},ye={class:"text-muted mb-0"},ke={class:"col-lg-3"},we={class:"card-header"},Me={class:"card-title mb-0"},Le={class:"card-body p-4 text-center"},Se={class:"mx-auto avatar-md mb-3"},xe=["src"],Be={class:"card-title mb-1"},Ce={class:"col-lg-6"},De={class:"card-header"},Ie={class:"card-title mb-0"},ze={class:"card-body p-4"},Te={class:"mb-2"},Pe={class:"mb-2"},Re={key:0},qe={class:"mb-2"},Ve={class:"mb-2"},$e={class:"btn-group mb-2"},Ue={class:"btn btn-light dropdown-toggle",type:"button",id:"stop_locations_list","data-bs-toggle":"dropdown","data-bs-auto-close":"outside","aria-expanded":"false"},je={class:"dropdown-menu overflow-auto",style:{"max-width":"500px"},"aria-labelledby":"stop_locations_list"},He={class:"dropdown-item overflow-auto"},Ne={key:1},Oe={class:"mb-2"},Ae={class:"mb-2"},Fe={class:"row"},Ee={class:"col-12 col-lg-4",style:{"overflow-x":"auto"}},We={class:"row"},Ge={class:"row"},Ye=["onClick"],Ze={class:"col-sm-3 border-end d-flex align-items-center justify-content-center"},Je=["src"],Ke={class:"col-sm-5 mt-3 border-end"},Qe={class:"d-flex align-items-center"},Xe={class:"d-flex align-items-center"},et={class:"d-flex align-items-center"},tt={class:"col-sm-4 d-flex align-items-center justify-content-center"},st=["onClick"],at={class:"col-12 col-lg-8"},ot={class:"mb-3 text-center m-auto"},it={id:"map",style:{height:"500px"}},nt={class:"col-lg-12"},lt={class:"card-header"},rt={class:"card-title mb-0"},dt={class:"card-body p-4 text-center"},ct={class:"mx-auto avatar-md mb-3"},_t=["src"],ut={class:"card-title mb-1"},mt={class:"text-muted mb-0"},ft={class:"text-muted mb-0"},vt={class:"modal-footer v-modal-footer"};function gt(s,a,d,f,j,H){const N=h("Head"),C=h("PageHeader"),b=h("BRow"),m=h("BCardBody"),D=h("BCard"),R=h("BCol"),O=h("BCardHeader"),A=h("BLink"),F=h("BModal"),$=h("Layout");return B(),ne($,null,{default:r(()=>[n(N,{title:"Taxi Ride"}),n(C,{title:s.$t("book"),pageTitle:s.$t("taxi_ride"),pageLink:"/ongoing-rides"},null,8,["title","pageTitle"]),n(b,null,{default:r(()=>[n(R,null,{default:r(()=>[n(D,null,{default:r(()=>[n(m,null,{default:r(()=>[n(b,null,{default:r(()=>[e("div",me,[e("div",fe,[e("h6",ve,o(s.$t("user_details")),1)]),e("div",ge,[e("div",he,[e("img",{src:d.result.userDetail.data.profile_picture,alt:"2",class:"avatar-md rounded-circle"},null,8,pe)]),e("h5",be,o(d.result.userDetail.data.name),1),e("p",ye,o(d.app_for=="demo"?"***********":d.result.userDetail.data.mobile),1)])]),e("div",ke,[e("div",we,[e("h6",Me,o(s.$t("vehicle_details")),1)]),e("div",Le,[e("div",Se,[e("img",{src:d.result.vehicle_type_image,alt:"2",class:"avatar-md rounded-circle"},null,8,xe)]),e("h5",Be,o(d.result.vehicle_type_name),1)])]),e("div",Ce,[e("div",De,[e("h6",Ie,o(s.$t("trip_details")),1)]),e("div",ze,[e("h5",Te,[e("b",null,o(s.$t("pickup_location")),1)]),e("h6",Pe,o(d.result.pick_address),1),d.result.requestStops.data.length>0?(B(),T("div",Re,[e("h5",qe,[e("b",null,o(s.$t("stop_location")),1)]),e("h5",Ve,[e("b",null,o(s.$t("stop_location")),1)]),e("div",$e,[e("button",Ue,o(s.$t("view_stop_location")),1),e("ul",je,[(B(!0),T(Y,null,Z(d.result.requestStops.data,(l,M)=>(B(),T("li",null,[e("a",He,o(l.address),1)]))),256))])])])):J("",!0),d.result.is_rental?J("",!0):(B(),T("div",Ne,[e("h5",Oe,[e("b",null,o(s.$t("drop_location")),1)]),e("h6",Ae,o(d.result.drop_address),1)]))])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n(b,null,{default:r(()=>[n(R,{lg:"12"},{default:r(()=>[n(D,{"no-body":"",id:"tasksList"},{default:r(()=>[n(O,{class:"border-0"}),n(m,{class:"border border-dashed border-end-0 border-start-0"},{default:r(()=>[e("div",Fe,[e("div",Ee,[e("div",We,[n(b,null,{default:r(()=>[n(D,{"no-body":""},{default:r(()=>[n(m,{class:"overflow-y-auto",style:{"max-height":"500px",width:"100%"}},{default:r(()=>[n(R,{xl:"12"},{default:r(()=>[e("div",Ge,[(B(!0),T(Y,null,Z(f.fleetDrivers,l=>(B(),T("div",{key:l.driver_id,onClick:M=>f.driverFocus(l),class:"row"},[e("div",Ze,[e("div",null,[e("img",{class:"rounded-circle avatar-md",alt:"200x200",src:l.profile_picture},null,8,Je)])]),e("div",Ke,[e("div",Qe,[a[3]||(a[3]=e("i",{class:"ri-user-line",style:{"font-size":"20px"}},null,-1)),a[4]||(a[4]=P("    ",-1)),e("span",null,o(l.name),1)]),e("div",Xe,[a[5]||(a[5]=e("i",{class:"ri-phone-line",style:{"font-size":"20px"}},null,-1)),a[6]||(a[6]=P("    ",-1)),e("span",null,o(d.app_for=="demo"?"***********":l.mobile),1)]),e("div",et,[a[7]||(a[7]=e("i",{class:"ri-star-fill",style:{"font-size":"20px"}},null,-1)),a[8]||(a[8]=P("    ",-1)),e("span",null,o(l.rating),1)])]),e("div",tt,[e("div",null,[e("button",{onClick:M=>f.assignModal(l),type:"button",class:"btn btn-info btn-label waves-effect waves-light"},[a[9]||(a[9]=e("i",{class:"ri-car-line label-icon fs-20 align-middle me-2"},null,-1)),P(" "+o(s.$t("assign")),1)],8,st)])])],8,Ye))),128))])]),_:1})]),_:1})]),_:1})]),_:1})])]),e("div",at,[e("div",ot,[e("div",it,o(s.$t("map_loading")),1)])])])]),_:1})]),_:1})]),_:1})]),_:1}),e("div",null,[n(F,{modelValue:f.modalShow,"onUpdate:modelValue":a[2]||(a[2]=l=>f.modalShow=l),"hide-footer":"",title:s.$t("driver_details"),class:"v-modal-custom",size:"sm"},{default:r(()=>[n(D,null,{default:r(()=>[n(m,null,{default:r(()=>[n(b,null,{default:r(()=>{var l,M,q;return[e("div",nt,[e("div",lt,[e("h6",rt,o(s.$t("confirm_assign_driver")),1)]),e("div",dt,[e("div",ct,[e("img",{src:(l=f.modalDriver)==null?void 0:l.profile_picture,alt:"2",class:"avatar-md rounded-circle"},null,8,_t)]),e("h5",ut,o((M=f.modalDriver)==null?void 0:M.name),1),e("p",mt,o(d.app_for=="demo"?"***********":(q=f.modalDriver)==null?void 0:q.mobile),1)]),e("p",ft,o(s.$t("confirm_assign_driver_info")),1)])]}),_:1})]),_:1})]),_:1}),e("div",vt,[n(A,{href:"javascript:void(0);",class:"btn btn-link link-warning fw-medium",onClick:a[0]||(a[0]=l=>f.modalShow=!1)},{default:r(()=>[a[10]||(a[10]=e("i",{class:"ri-close-line me-1 align-middle"},null,-1)),P(" "+o(s.$t("close")),1)]),_:1}),e("button",{type:"button",class:"btn btn-soft-info waves-effect waves-light",onClick:a[1]||(a[1]=l=>f.assignDriver(f.modalDriver))},[a[11]||(a[11]=e("i",{class:"ri-car-line me-1 align-middle"},null,-1)),P(" "+o(s.$t("assign_driver")),1)])])]),_:1},8,["modelValue","title"])])]),_:1})}const Mt=Q(ue,[["render",gt]]);export{Mt as default};
