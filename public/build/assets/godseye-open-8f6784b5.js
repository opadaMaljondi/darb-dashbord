import{_ as ne,O as ie,D as re,r as n,T as ce,R as Q,Y as y,o as de,a3 as fe,g as u,i as W,y as _e,w as g,l as f,n as a,J as v,z as O,t as ue,K as ve,k as pe,C as me}from"./vendor-8caf5d52.js";import{L as he}from"./main-cc7bd0ce.js";import{P as ge}from"./page-header-18309276.js";import{u as be}from"./footer-502c2797.js";import"./app-974c65a1.js";const ye={data(){return{rightOffcanvas:!1}},components:{Layout:he,PageHeader:ge,Multiselect:ie},props:{firebaseSettings:Object,service_location:Array,vehicle_type:Array,app_for:String,default_lat:String,default_lng:String},setup(l){const{t:s}=re(),S=n(null),o=n(null),q=n(""),F=ce({all:"",locked:""}),{selectedLocation:B}=be(),H=n([]),A=n({}),C=n(!1),P=n(parseFloat(l.default_lat)),R=n(parseFloat(l.default_lng)),$=n(!1),r=n([]),D=n(l.service_location.map(e=>({value:e.id,label:e.name}))),j=n(l.vehicle_type.map(e=>({value:e.id,label:e.name}))),p=()=>{$.value=!0},X=()=>{F.reset(),fetchDatas(),$.value=!1};Q([o,r],()=>{b()}),Q(B,e=>{e!=="all"&&(S.value=e),b()});let T,i={};const ee=()=>{T=y.map("map").setView({lat:P.value,lng:R.value},15),y.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(T);var e={apiKey:l.firebaseSettings.firebase_api_key,authDomain:l.firebaseSettings.firebase_auth_domain,databaseURL:l.firebaseSettings.firebase_database_url,projectId:l.firebaseSettings.firebase_project_id,storageBucket:l.firebaseSettings.firebase_storage_bucket,messagingSenderId:l.firebaseSettings.firebase_messaging_sender_id,appId:l.firebaseSettings.firebase_app_id};firebase.apps.length||firebase.initializeApp(e),B.value!=="all"&&(S.value=B.value),b()},te=()=>{o.value=null,r.value=[],b()},le=()=>{console.log(r.value),b()},b=()=>{const e=firebase.database().ref("drivers");e.on("value",c=>{c.forEach(d=>{const t=d.val(),m=J(t.g);if(m){const M=[m.lat,m.lon];let w=r.value.length>0?r.value.includes("online"):!0,V=r.value.length>0?r.value.includes("onride"):!0,U=r.value.length>0?r.value.includes("offline"):!0,h="";t.hasOwnProperty("is_active")&&t.hasOwnProperty("is_available")&&(t.is_active==1&&t.is_available==!0&&w?h=`/image/map/${t.vehicle_type_icon}.png`:t.is_active==1&&t.is_available==!1&&V?h=`/image/map/${t.vehicle_type_icon}.png`:U&&(h=`/image/map/${t.vehicle_type_icon}.png`));let L=!1;D.value.find(_=>_.value==t.service_location_id)&&(L=!0),S.value&&(L=S.value==t.service_location_id);let z=Array.isArray(t.vehicle_types);if(o.value&&Array.isArray(t.vehicle_types)&&t.vehicle_types.length>0&&(z=(Array.isArray(t.vehicle_types)&&t.vehicle_types.some(_=>o.value===_))??!1),h.length>0&&z&&L)if(i[t.id])E(i[t.id],i[t.id].getLatLng(),M),i[t.id].setIcon(y.icon({iconUrl:h,iconSize:[30,30]}));else{const _=y.marker(M,{icon:y.icon({iconUrl:h,iconSize:[30,30]})}).addTo(T);_.bindTooltip(`<strong>${t.name}</strong><br>Mobile: ${l.app_for=="demo"?"**********":t.mobile}`,{permanent:!1,direction:"top",offset:[0,-10]}),i[t.id]=_,E(_,_.getLatLng(),M)}else G(t.id)}})}),e.on("child_changed",c=>{const d=c.val();ae(d)}),e.on("child_removed",c=>{const d=c.val();G(d.id)})},E=(e,c,d)=>{e.setLatLng(d).update()},ae=e=>{const c=J(e.g);if(c){const d=[c.lat,c.lon],t=`/image/map/${e.vehicle_type_icon}.png`;if(i[e.id])E(i[e.id],i[e.id].getLatLng(),d),i[e.id].setIcon(y.icon({iconUrl:t,iconSize:[30,30]}));else{const m=y.marker(d,{icon:y.icon({iconUrl:t,iconSize:[30,30]})}).addTo(T);i[e.id]=m}}else console.error(`${s("failed_to_decode_geohash")} ${e.id}`)},G=e=>{i[e]&&(T.removeLayer(i[e]),delete i[e])},J=e=>{const c="0123456789bcdefghjkmnpqrstuvwxyz",d=[16,8,4,2,1];let t=!0,m=-90,M=90,w=-180,V=180,U,h;if(e){for(let L=0;L<e.length;L++){let z=e.charAt(L),_=c.indexOf(z);for(let K=0;K<5;K++){let x=d[K];if(t){let I=(w+V)/2;_&x?w=I:V=I}else{let I=(m+M)/2;_&x?m=I:M=I}t=!t}}return U=(m+M)/2,h=(w+V)/2,{lat:U,lon:h}}return null};de(()=>{ee();const e=localStorage.getItem("refreshMethod")??0;Y.value=e,Z(e)});const Y=n(),N=n(!1),k=n(null),oe=async e=>{localStorage.setItem("refreshMethod",e),Z(e)},se=async()=>{await b()},Z=e=>{k.value&&(clearInterval(k.value),k.value=null),e==0?(N.value=!1,k.value=setInterval(async()=>{await b()},1e3)):(N.value=!0,clearInterval(k.value),k.value=null)};return{fetchData:fe.debounce(b,300),results:H,paginator:A,filter:F,searchTerm:q,serviceLocations:D,vehicleTypes:j,selectedServiceLocations:S,selectedVehicleTypes:o,filterData:p,clearFilter:X,clearFilters:te,applyFilters:le,modalShow:C,modalFilter:$,selectedModes:r,refreshMethod:oe,refresh_Method:Y,refresh_btn:N,refreshBtn:se}}},Me={class:"row"},Le={class:"col-12 col-lg-4"},Se={class:"mb-3"},ke={for:"select_mode",class:"form-label"},Be={class:"col-12 col-lg-4"},Ce={class:"mb-3"},$e={for:"vehicle_type",class:"form-label"},Te={class:"col-sm-2"},we={class:"mb-3"},Ve={for:"type",class:"form-label"},Ie={disabled:"",value:""},Ae={value:"0"},De={value:"1"},Ue={key:0,class:"col-sm-2"},ze={class:"mb-3 mt-4"},Oe={class:"col-12 col-lg-6 d-flex gap-1"},Fe={id:"map",style:{height:"400px"}};function He(l,s,S,o,q,F){const B=u("Head"),H=u("PageHeader"),A=u("Multiselect"),C=u("BButton"),P=u("BCardHeader"),R=u("BCardBody"),$=u("BCard"),r=u("BCol"),D=u("BRow"),j=u("Layout");return W(),_e(j,null,{default:g(()=>[f(B,{title:l.$t("gods-eye")},null,8,["title"]),f(H,{title:l.$t("gods-eye"),pageTitle:l.$t("map")},null,8,["title","pageTitle"]),f(D,null,{default:g(()=>[f(r,{lg:"12"},{default:g(()=>[f($,{"no-body":"",id:"tasksList"},{default:g(()=>[f(P,{class:"border-0"},{default:g(()=>[a("div",Me,[a("div",Le,[a("div",Se,[a("label",ke,v(l.$t("drivers")),1),f(A,{id:"select_mode",mode:"tags","close-on-select":!1,searchable:!0,"create-option":!1,modelValue:o.selectedModes,"onUpdate:modelValue":s[0]||(s[0]=p=>o.selectedModes=p),options:[{value:"offline",label:l.$t("offline")},{value:"online",label:l.$t("online")},{value:"onride",label:l.$t("onride")}],placeholder:l.$t("select_mode")},null,8,["modelValue","options","placeholder"])])]),a("div",Be,[a("div",Ce,[a("label",$e,v(l.$t("vehicle_types")),1),f(A,{modelValue:o.selectedVehicleTypes,"onUpdate:modelValue":s[1]||(s[1]=p=>o.selectedVehicleTypes=p),options:o.vehicleTypes,label:"label","track-by":"value",multiple:"","close-on-select":"",placeholder:l.$t("select_vehicle_types"),id:"select_service_location"},null,8,["modelValue","options","placeholder"])])]),a("div",Te,[a("div",null,[a("div",we,[a("label",Ve,[O(v(l.$t("refresh_method"))+" ",1),s[5]||(s[5]=a("span",{class:"text-danger"},"*",-1))]),ue(a("select",{id:"type",class:"form-select","onUpdate:modelValue":s[2]||(s[2]=p=>o.refresh_Method=p),onChange:s[3]||(s[3]=p=>o.refreshMethod(o.refresh_Method))},[a("option",Ie,v(l.$t("select_refresh_method")),1),a("option",Ae,v(l.$t("automatic")),1),a("option",De,v(l.$t("manual")),1)],544),[[ve,o.refresh_Method]])])])]),o.refresh_btn?(W(),pe("div",Ue,[a("div",ze,[f(C,{type:"button",variant:"primary",class:"btn btn-md",onClick:s[4]||(s[4]=p=>o.refreshBtn())},{default:g(()=>[s[6]||(s[6]=a("i",{class:"bx bx-refresh"},null,-1)),O(" "+v(l.$t("refresh")),1)]),_:1,__:[6]})])])):me("",!0),a("div",Oe,[f(C,{type:"button",variant:"success",class:"btn btn-md",onClick:o.applyFilters},{default:g(()=>[O(v(l.$t("apply")),1)]),_:1},8,["onClick"]),f(C,{type:"button",variant:"danger",class:"btn btn-md",onClick:o.clearFilters},{default:g(()=>[O(v(l.$t("clear")),1)]),_:1},8,["onClick"])])])]),_:1}),f(R,{class:"border border-dashed border-end-0 border-start-0"},{default:g(()=>[a("div",Fe,v(l.$t("map_loading")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const Ke=ne(ye,[["render",He]]);export{Ke as default};
