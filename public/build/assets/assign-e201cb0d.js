import{_ as J,Z as K,B as Y,$ as Z,P as Q,S as X,W as k,D as $,r as f,o as ee,N as te,g as m,i as M,y as se,w as r,a as ae,l as o,n as e,J as a,k as D,F as O,L as G,C as W,t as le,M as ie,z as x}from"./vendor-54d6cb1e.js";import{L as oe}from"./dispatchmain-7b8a389c.js";import{P as ne}from"./page-header-ff719701.js";import{F as re}from"./FormValidation-cabc17c8.js";import{g as de}from"./googleMap-c31fbadb.js";import"./footer-7e4f68d9.js";import"./dispatchHorizontal-f9ab2bd0.js";import"./app-cb082573.js";const ce={data(){return{rightOffcanvas:!1}},components:{Layout:oe,PageHeader:ne,Head:K,Link:Y,Scrollbar:Z,FormValidation:re,googleMap:de,flatPickr:Q},computed:{...X(["permissions"])},props:{successMessage:String,alertMessage:String,firebaseSettings:Array,app_for:String,map_key:String,driver_radius:Number,result:Object,baseUrl:String},methods:{timer(){let s;k.fire({title:"Booking alert!",html:"Your Ride has been Booked <b></b> Successfully.",timer:2e3,timerProgressBar:!0,onBeforeOpen:()=>{k.showLoading(),s=setInterval(()=>{k.getContent().querySelector("b").textContent=k.getTimerLeft()},100)},onClose:()=>{clearInterval(s)}}).then(t=>{t.dismiss===k.DismissReason.timer&&console.log("I was closed by the timer")})}},setup(s){const{t}=$(),n=f(!1),d=f(s.driver_radius??10),P=f(s.successMessage||""),j=f(s.alertMessage||""),S=f(""),H=()=>{P.value="",j.value=""},g=f(null),h=f([]),w=f(null),v=f(s.result),C=f({}),V=c=>{w.value=c,n.value=!0},z=async c=>{try{const _=await ae.post(`/dispatcher/ongoing_request/assign-driver/${v.value.id}`,{driver_id:c.id});_.data.status?(n.value=!1,k.fire(t("success"),t("users_assigned_successfully"),"success")):(k.fire(t("Warning"),_.data.message,"warning"),console.log(_))}catch(_){k.fire(t("Warning"),response.data.message,"warning"),console.error(_)}},N=()=>{C.value={},firebase.database().ref("drivers").on("value",_=>{h.value=[],_.forEach(b=>{const i=b.val(),p=Date.now()-15*60*1e3;if(i.updated_at<p)return;const y=i.g,u=T(y);let B=!0;if(S.value.length>0&&i.name&&(B=i.name.includes(S.value)||i.mobile.includes(S.value)),u&&B&&l(v.value.pick_lat,v.value.pick_lng,u.lat,u.lon)<=d.value&&i.is_available&&i.is_active&&i.vehicle_types.includes(v.value.vehicle_type_id)){h.value.push(i);const I=s.app_for=="demo"?"*********":i.name,U=s.app_for=="demo"?"*********":i.mobile;g.value=null,C.value[i.id]={lat:u.lat,lng:u.lon,type_icon:i.vehicle_type_icon,name:I,mobile:U}}})})},T=c=>{const _="0123456789bcdefghjkmnpqrstuvwxyz",b=[16,8,4,2,1];let i=!0,L=-90,p=90,y=-180,u=180,B,R;if(c){for(let I=0;I<c.length;I++){let U=c.charAt(I),E=_.indexOf(U);for(let A=0;A<5;A++){let F=b[A];if(i){let q=(y+u)/2;E&F?y=q:u=q}else{let q=(L+p)/2;E&F?L=q:p=q}i=!i}}return B=(L+p)/2,R=(y+u)/2,{lat:B,lon:R}}},l=(c,_,b,i)=>{const p=(b-c)*Math.PI/180,y=(i-_)*Math.PI/180,u=Math.sin(p/2)*Math.sin(p/2)+Math.cos(c*Math.PI/180)*Math.cos(b*Math.PI/180)*Math.sin(y/2)*Math.sin(y/2);return 6371*(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)))};return ee(async()=>{try{var c={apiKey:s.firebaseSettings.firebase_api_key,authDomain:s.firebaseSettings.firebase_auth_domain,databaseURL:s.firebaseSettings.firebase_database_url,projectId:s.firebaseSettings.firebase_project_id,storageBucket:s.firebaseSettings.firebase_storage_bucket,messagingSenderId:s.firebaseSettings.firebase_messaging_sender_id,appId:s.firebaseSettings.firebase_app_id};firebase.apps.length||firebase.initializeApp(c),firebase.database().ref("requests").child(v.value.id).on("value",b=>{const i=b.val();(i&&(i.is_accept||"driver_id"in i)||!i)&&te.get(`/dispatcher/rides_request/view/${v.value.id}`)}),N()}catch(_){console.error(t("error_initializing_firebase_or_fetching_settings"),_)}}),{modalShow:n,selectedDriver:g,successMessage:P,driverSearch:S,alertMessage:j,modalDriver:w,assignDriver:z,assignModal:V,driverMarkers:C,fleetDrivers:h,dismissMessage:H,errors:{}}}},_e={class:"col-lg-3"},ue={class:"card-header"},me={class:"card-title mb-0"},ve={class:"card-body p-4 text-center"},fe={class:"mx-auto avatar-md mb-3"},ge=["src"],he={class:"card-title mb-1"},be={class:"text-muted mb-0"},pe={class:"col-lg-3"},ye={class:"card-header"},ke={class:"card-title mb-0"},we={class:"card-body p-4 text-center"},Me={class:"mx-auto avatar-md mb-3"},xe=["src"],Se={class:"card-title mb-1"},Be={class:"col-lg-6"},De={class:"card-header"},Ce={class:"card-title mb-0"},Le={class:"card-body p-4"},Ie={class:"mb-2"},qe={class:"mb-2"},Re={key:0},Pe={class:"mb-2"},je={class:"mb-2"},He={class:"btn-group mb-2"},Ve={class:"btn btn-light dropdown-toggle",type:"button",id:"stop_locations_list","data-bs-toggle":"dropdown","data-bs-auto-close":"outside","aria-expanded":"false"},ze={class:"dropdown-menu overflow-auto",style:{"max-width":"500px"},"aria-labelledby":"stop_locations_list"},Ne={class:"dropdown-item overflow-auto"},Te={key:1},Ue={class:"mb-2"},Ae={class:"mb-2"},Ee={class:"position-relative col-lg-4"},Fe={class:"row"},Oe={class:"col-12 col-lg-5",style:{"overflow-x":"auto"}},Ge={class:"row"},We={class:"row"},Je=["onClick"],Ke={class:"col-sm-2 border-end d-flex align-items-center justify-content-center"},Ye=["src"],Ze={class:"col-sm-4 mt-3 border-end"},Qe={class:"d-flex align-items-center"},Xe={class:"d-flex align-items-center"},$e={class:"d-flex align-items-center"},et={class:"col-sm-6 d-flex align-items-center"},tt={class:"row"},st={class:"col-lg-12"},at=["onClick"],lt={class:"col-lg-12"},it={class:"d-flex list-inline mb-0 mt-3"},ot={class:"list-inline-item avatar-xs"},nt=["title"],rt={class:"mt-2",style:{width:"max-content"}},dt={class:"list-inline-item avatar-xs ms-5"},ct=["title"],_t={class:"mt-2",style:{width:"max-content"}},ut={class:"list-inline-item avatar-xs ms-5"},mt=["title"],vt={class:"mt-2",style:{width:"max-content"}},ft={class:"col-12 col-lg-7"},gt={class:"mb-3 text-center m-auto"},ht={id:"map",style:{height:"500px"}},bt={class:"col-lg-12"},pt={class:"card-header"},yt={class:"card-title mb-0"},kt={class:"card-body p-4 text-center"},wt={class:"mx-auto avatar-md mb-3"},Mt=["src"],xt={class:"card-title mb-1"},St={class:"text-muted mb-0"},Bt={class:"text-muted mb-0"},Dt={class:"modal-footer v-modal-footer"};function Ct(s,t,n,d,P,j){const S=m("Head"),H=m("PageHeader"),g=m("BRow"),h=m("BCardBody"),w=m("BCard"),v=m("BCol"),C=m("BCardHeader"),V=m("googleMap"),z=m("BLink"),N=m("BModal"),T=m("Layout");return M(),se(T,null,{default:r(()=>[o(S,{title:"Taxi Ride"}),o(H,{title:s.$t("book"),pageTitle:s.$t("taxi_ride"),pageLink:"/dispatcher/ongoing_request"},null,8,["title","pageTitle"]),o(g,null,{default:r(()=>[o(v,null,{default:r(()=>[o(w,null,{default:r(()=>[o(h,null,{default:r(()=>[o(g,null,{default:r(()=>[e("div",_e,[e("div",ue,[e("h6",me,a(s.$t("user_details")),1)]),e("div",ve,[e("div",fe,[e("img",{src:n.result.userDetail.data.profile_picture,alt:"2",class:"avatar-md rounded-circle"},null,8,ge)]),e("h5",he,a(n.result.userDetail.data.name),1),e("p",be,a(n.app_for=="demo"?"***********":n.result.userDetail.data.mobile),1)])]),e("div",pe,[e("div",ye,[e("h6",ke,a(s.$t("vehicle_details")),1)]),e("div",we,[e("div",Me,[e("img",{src:n.result.vehicle_type_image,alt:"2",class:"avatar-md rounded-circle"},null,8,xe)]),e("h5",Se,a(n.result.vehicle_type_name),1)])]),e("div",Be,[e("div",De,[e("h6",Ce,a(s.$t("trip_details")),1)]),e("div",Le,[e("h5",Ie,[e("b",null,a(s.$t("pickup_location")),1)]),e("h6",qe,a(n.result.pick_address),1),n.result.requestStops.data.length>0?(M(),D("div",Re,[e("h5",Pe,[e("b",null,a(s.$t("stop_location")),1)]),e("h5",je,[e("b",null,a(s.$t("stop_location")),1)]),e("div",He,[e("button",Ve,a(s.$t("view_stop_location")),1),e("ul",ze,[(M(!0),D(O,null,G(n.result.requestStops.data,(l,c)=>(M(),D("li",null,[e("a",Ne,a(l.address),1)]))),256))])])])):W("",!0),n.result.is_rental?W("",!0):(M(),D("div",Te,[e("h5",Ue,[e("b",null,a(s.$t("drop_location")),1)]),e("h6",Ae,a(n.result.drop_address),1)]))])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(g,null,{default:r(()=>[o(v,{lg:"12"},{default:r(()=>[o(w,{"no-body":"",id:"tasksList"},{default:r(()=>[o(C,{class:"border-0"},{default:r(()=>[e("div",Ee,[le(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=l=>d.driverSearch=l),placeholder:"Search...",autocomplete:"off",id:"search-options",value:""},null,512),[[ie,d.driverSearch]])])]),_:1}),o(h,{class:"border border-dashed border-end-0 border-start-0"},{default:r(()=>[e("div",Fe,[e("div",Oe,[e("div",Ge,[o(g,null,{default:r(()=>[o(w,{"no-body":""},{default:r(()=>[o(h,{class:"overflow-y-auto",style:{"max-height":"500px",width:"100%"}},{default:r(()=>[o(v,{xl:"12"},{default:r(()=>[e("div",We,[(M(!0),D(O,null,G(d.fleetDrivers,l=>(M(),D("div",{key:l.driver_id,onClick:()=>{d.selectedDriver=null,d.selectedDriver=d.driverMarkers[l.id]},class:"row"},[e("div",Ke,[e("div",null,[e("img",{class:"rounded-circle avatar-md",alt:"200x200",src:l.profile_picture},null,8,Ye)])]),e("div",Ze,[e("div",Qe,[t[4]||(t[4]=e("i",{class:"ri-user-line",style:{"font-size":"20px"}},null,-1)),t[5]||(t[5]=x("    ",-1)),e("span",null,a(l.name),1)]),e("div",Xe,[t[6]||(t[6]=e("i",{class:"ri-phone-line",style:{"font-size":"20px"}},null,-1)),t[7]||(t[7]=x("    ",-1)),e("span",null,a(n.app_for=="demo"?"***********":l.mobile),1)]),e("div",$e,[t[8]||(t[8]=e("i",{class:"ri-star-fill",style:{"font-size":"20px"}},null,-1)),t[9]||(t[9]=x("    ",-1)),e("span",null,a(l.rating),1)])]),e("div",et,[e("div",tt,[e("div",st,[e("div",null,[e("button",{onClick:c=>d.assignModal(l),type:"button",class:"btn btn-info btn-label waves-effect waves-light"},[t[10]||(t[10]=e("i",{class:"ri-car-line label-icon fs-20 align-middle me-2"},null,-1)),x(" "+a(s.$t("assign")),1)],8,at)])]),e("div",lt,[e("ul",it,[e("li",ot,[e("a",{href:"javascript:void(0);",class:"avatar-title bg-success-subtle text-success fs-15 rounded","data-bs-toggle":"tooltip","data-bs-placement":"top",title:s.$t("today_rides_distance")},[...t[11]||(t[11]=[e("i",{class:"ri-pin-distance-line"},null,-1)])],8,nt),e("h6",rt,a(l.total_kms?l.total_kms:"-"),1)]),e("li",dt,[e("a",{href:"javascript:void(0);",class:"avatar-title bg-danger-subtle text-danger fs-15 rounded","data-bs-toggle":"tooltip","data-bs-placement":"top",title:s.$t("today_rides_taken")},[...t[12]||(t[12]=[e("i",{class:"ri-police-car-fill"},null,-1)])],8,ct),e("h6",_t,a(l.total_rides_taken),1)]),e("li",ut,[e("a",{href:"javascript:void(0);",class:"avatar-title bg-warning-subtle text-warning fs-15 rounded","data-bs-toggle":"tooltip","data-bs-placement":"top",title:s.$t("today_active")},[...t[13]||(t[13]=[e("i",{class:"ri-map-pin-time-line"},null,-1)])],8,mt),e("h6",vt,a(l.total_active_hrs?l.total_active_hrs:"-"),1)])])])])])],8,Je))),128))])]),_:1})]),_:1})]),_:1})]),_:1})])]),e("div",ft,[e("div",gt,[e("div",ht,[o(V,{baseUrl:n.baseUrl,pick_location:{lat:n.result.pick_lat,lng:n.result.pick_lng},nearbyDrivers:d.driverMarkers,driver:d.selectedDriver,map_key:n.map_key,libraries:["marker","geometry","geocoding"]},{default:r(()=>[x(a(s.$t("map_loading")),1)]),_:1},8,["baseUrl","pick_location","nearbyDrivers","driver","map_key"])])])])])]),_:1})]),_:1})]),_:1})]),_:1}),e("div",null,[o(N,{modelValue:d.modalShow,"onUpdate:modelValue":t[3]||(t[3]=l=>d.modalShow=l),"hide-footer":"",title:s.$t("driver_details"),class:"v-modal-custom",size:"sm"},{default:r(()=>[o(w,null,{default:r(()=>[o(h,null,{default:r(()=>[o(g,null,{default:r(()=>{var l,c,_;return[e("div",bt,[e("div",pt,[e("h6",yt,a(s.$t("confirm_assign_driver")),1)]),e("div",kt,[e("div",wt,[e("img",{src:(l=d.modalDriver)==null?void 0:l.profile_picture,alt:"2",class:"avatar-md rounded-circle"},null,8,Mt)]),e("h5",xt,a((c=d.modalDriver)==null?void 0:c.name),1),e("p",St,a(n.app_for=="demo"?"***********":(_=d.modalDriver)==null?void 0:_.mobile),1)]),e("p",Bt,a(s.$t("confirm_assign_driver_info")),1)])]}),_:1})]),_:1})]),_:1}),e("div",Dt,[o(z,{href:"javascript:void(0);",class:"btn btn-link link-warning fw-medium",onClick:t[1]||(t[1]=l=>d.modalShow=!1)},{default:r(()=>[t[14]||(t[14]=e("i",{class:"ri-close-line me-1 align-middle"},null,-1)),x(" "+a(s.$t("close")),1)]),_:1}),e("button",{type:"button",class:"btn btn-soft-info waves-effect waves-light",onClick:t[2]||(t[2]=l=>d.assignDriver(d.modalDriver))},[t[15]||(t[15]=e("i",{class:"ri-car-line me-1 align-middle"},null,-1)),x(" "+a(s.$t("assign_driver")),1)])])]),_:1},8,["modelValue","title"])])]),_:1})}const zt=J(ce,[["render",Ct]]);export{zt as default};
