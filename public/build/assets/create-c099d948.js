import{_ as x,Z as H,O as R,D as V,T as L,r as d,g as i,i as B,y as N,w as u,a as S,W as w,N as k,l as n,n as t,z as D,J as _,p as P,k as F,C as T}from"./vendor-54d6cb1e.js";import{L as U}from"./main-b839be26.js";import{P as j}from"./page-header-ff719701.js";import{P as E}from"./Pagination-b5e3d5c9.js";import{F as O}from"./FormValidation-cabc17c8.js";import{I as q}from"./ImageUpload-95e3fa21.js";import"./footer-7e4f68d9.js";import"./app-cb082573.js";const z={components:{Layout:U,PageHeader:j,Head:H,Pagination:E,Multiselect:R,FormValidation:O,ImageUpload:q},props:{successMessage:String,alertMessage:String,DriverImported:{type:Object,required:!0},validate:Function},setup(o){const{t:e}=V(),a=L({user_file:null}),r={user_file:{required:!0}},g=d(null),c=d({}),f=d(o.successMessage||""),m=d(o.alertMessage||""),v=()=>{f.value="",m.value=""},b=async()=>{if(c.value=g.value.validate(),console.log("errors.value",c.value),!(Object.keys(c.value).length>0))try{console.log("form.user_file",a.user_file);const s=new FormData;s.append("file",a.user_file);let l;console.log("DriverImported",o.DriverImported),o.DriverImported?l=await S.post(`/driver-import/reupload-invalid-file-store/${o.DriverImported.id}`,s,{headers:{"Content-Type":"multipart/form-data"}}):l=await S.post("/driver-import/import-file",s,{headers:{"Content-Type":"multipart/form-data"}}),console.log("response",l),l.status===201?w.fire({title:"Success!",text:e("driver_files_imported_successfully"),icon:"success"}).then(async I=>{I.isConfirmed&&(a.reset(),k.get("/driver-import"))}):w.fire({title:"Error!",text:e("failed_to_create_user_imported_files."),icon:e("error")})}catch(s){s.response&&s.response.status===422?c.value=s.response.data.errors:s.response&&s.response.status===403?(m.value=s.response.data.alertMessage,setTimeout(()=>{k.get("/driver-import")},5e3)):(console.error(e("error_creating_user_imported_files"),s),m.value=e("failed_to_create_user_imported_files_catch"))}},y=(s,l)=>{a[l]=s},M=s=>{a[s]=null},p=d(!1),C=async s=>{if(o.app_for=="demo"){w.fire(e("error"),e("you_are_not_authorised"),"error");return}const l=s.target.files[0];if(l&&!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv"].includes(l.type)){p.value=!0,a.user_file=null;return}a.user_file=l},h=o.bannerimage?o.bannerimage.image:null;return{form:a,successMessage:f,alertMessage:m,handleSubmit:b,dismissMessage:v,selectedCountry:d(null),selectedTimezone:d(null),validationRules:r,validationRef:g,errors:c,handleImageSelected:y,handleImageRemoved:M,iconUrl:h,handleFileUpload:C,userFileError:p}}},A={class:"row"},J={class:"col-sm-6"},W={class:"mb-3"},Z={for:"firebase_json",class:"form-label"},G=["disabled"],K={class:"col-lg-12"},Q={class:"text-end"},X={type:"submit",class:"btn btn-primary"},Y={key:0,class:"custom-alert alert alert-success alert-border-left fade show",role:"alert",id:"alertMsg"},$={class:"alert-content"},ee={key:1,class:"custom-alert alert alert-danger alert-border-left fade show",role:"alert",id:"alertMsg"},se={class:"alert-content"};function te(o,e,a,r,g,c){const f=i("Head"),m=i("PageHeader"),v=i("BCardHeader"),b=i("FormValidation"),y=i("BCardBody"),M=i("BCard"),p=i("BCol"),C=i("BRow"),h=i("Layout");return B(),N(h,null,{default:u(()=>[n(f,{title:"Driver Import"}),n(m,{title:o.bannerimage?o.$t("edit"):o.$t("create"),pageTitle:o.$t("driver-import"),pageLink:"/driver-import"},null,8,["title","pageTitle"]),n(C,null,{default:u(()=>[n(p,{lg:"12"},{default:u(()=>[n(M,{"no-body":"",id:"tasksList"},{default:u(()=>[n(v,{class:"border-0"}),n(y,{class:"border border-dashed border-end-0 border-start-0"},{default:u(()=>[t("form",{onSubmit:e[1]||(e[1]=P((...s)=>r.handleSubmit&&r.handleSubmit(...s),["prevent"]))},[n(b,{form:r.form,rules:r.validationRules,ref:"validationRef"},{default:u(()=>[t("div",A,[t("div",J,[t("div",W,[t("label",Z,[D(_(o.$t("Driver Files"))+" ",1),e[4]||(e[4]=t("span",{class:"text-danger"},"*",-1))]),t("input",{disabled:o.app_for==="demo",type:"file",class:"form-control",onChange:e[0]||(e[0]=(...s)=>r.handleFileUpload&&r.handleFileUpload(...s)),accept:".xlsx,.xls,.csv"},null,40,G)])]),t("div",K,[t("div",Q,[t("button",X,_(a.DriverImported?o.$t("update"):o.$t("save")),1)])])])]),_:1},8,["form","rules"])],32)]),_:1})]),_:1})]),_:1})]),_:1}),t("div",null,[r.successMessage?(B(),F("div",Y,[t("div",$,[e[5]||(e[5]=t("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),e[6]||(e[6]=t("strong",null,"Success",-1)),D(" - "+_(r.successMessage)+" ",1),t("button",{type:"button",class:"btn-close btn-close-success",onClick:e[2]||(e[2]=(...s)=>r.dismissMessage&&r.dismissMessage(...s)),"aria-label":"Close Success Message"})])])):T("",!0),r.alertMessage?(B(),F("div",ee,[t("div",se,[e[7]||(e[7]=t("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),e[8]||(e[8]=t("strong",null,"Alert",-1)),D(" - "+_(r.alertMessage)+" ",1),t("button",{type:"button",class:"btn-close btn-close-danger",onClick:e[3]||(e[3]=(...s)=>r.dismissMessage&&r.dismissMessage(...s)),"aria-label":"Close Alert Message"})])])):T("",!0)])]),_:1})}const me=x(z,[["render",te]]);export{me as default};
