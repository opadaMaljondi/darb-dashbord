import{_ as te,Z as oe,D as se,r as v,T as ae,o as re,g as L,i as d,y as le,w as k,a as z,N as q,l as b,k as p,n as s,p as ne,J as u,t as N,K as ie,F as K,L as V,C as O,M as G,z as ce}from"./vendor-54d6cb1e.js";import{L as de}from"./main-b839be26.js";import{P as ge}from"./page-header-ff719701.js";import{u as pe}from"./footer-7e4f68d9.js";import"./app-cb082573.js";const ue={components:{Layout:de,PageHeader:ge,Head:oe},props:{airport:Object,googleMapKey:String,successMessage:String,languages:Array,alertMessage:String,app_for:String},setup(i){const{airport:e,googleMapKey:h}=i,{t:a}=se(),{languages:I,fetchData:B}=pe(),A=v("English"),E=v(i.successMessage||""),g=v(i.alertMessage||""),m=ae({service_location_id:e.service_location_id,name:e.name,coordinates:e.coordinates||[]}),n=v([]);let f,x,c=[];const w=v(null),y=v(null),D=async()=>{const t=await z.get("/airport/list");n.value=t.data.results},P=v(""),S=v([]),H=()=>{P.value.length<3?S.value=[]:setTimeout(()=>{J(P.value)},300)},J=t=>{const o="https://places.googleapis.com/v1/places:autocomplete",r={"Content-Type":"application/json","X-Goog-Api-Key":i.googleMapKey,"X-Goog-FieldMask":"suggestions.placePrediction.placeId,suggestions.placePrediction.place,suggestions.placePrediction.text"};fetch(o,{method:"POST",headers:r,body:JSON.stringify({input:t})}).then(l=>l.json()).then(l=>{var M;((M=l.suggestions)==null?void 0:M.length)>0&&(S.value=l.suggestions.filter(C=>C.placePrediction).map(C=>({placeId:C.placePrediction.placeId,formattedAddress:C.placePrediction.text.text})))}).catch(l=>{console.error("Error fetching autocomplete results:",l)})},U=async t=>{const o={"X-Goog-Api-Key":i.googleMapKey,"X-Goog-FieldMask":"viewport,location"};fetch(`https://places.googleapis.com/v1/places/${t.placeId}?fields=viewport,location`,{headers:o}).then(r=>r.json()).then(r=>{P.value="",S.value=[];const _=new google.maps.LatLng(r.location.latitude,r.location.longitude);if(f.setCenter(_),r.viewport&&r.viewport.high&&r.viewport.low){const l=new google.maps.LatLngBounds(new google.maps.LatLng(r.viewport.low.latitude,r.viewport.low.longitude),new google.maps.LatLng(r.viewport.high.latitude,r.viewport.high.longitude));f.fitBounds(l)}else f.setZoom(15)}).catch(r=>{console.error("Error fetching autocomplete results:",r)})},F=()=>{if(e&&e.coordinates){f=new google.maps.Map(document.getElementById("map"),{center:{lat:0,lng:0},zoom:10});const t=new google.maps.LatLngBounds;let o=[];if(Array.isArray(e.coordinates))o=e.coordinates;else if(e.coordinates&&typeof e.coordinates=="object"&&e.coordinates.coordinates)o=e.coordinates.coordinates;else if(typeof e.coordinates=="string")try{const r=JSON.parse(e.coordinates);o=Array.isArray(r)?r:r.coordinates||[]}catch(r){console.error("Error parsing coordinates:",r),o=[]}Array.isArray(o)&&o.length>0&&(o.forEach(r=>{if(Array.isArray(r)&&r.length>0&&Array.isArray(r[0])){const _=r[0].map(l=>l&&l.coordinates&&Array.isArray(l.coordinates)?{lat:l.coordinates[1],lng:l.coordinates[0]}:Array.isArray(l)&&l.length>=2?{lat:l[1],lng:l[0]}:null).filter(l=>l!==null);_.length>0&&(x=new google.maps.Polygon({paths:_,fillColor:"#0000FF",fillOpacity:.3,strokeWeight:1,clickable:!0,editable:!1,zIndex:1,map:f}),c.push(x),T(x),x.getPath().forEach(l=>t.extend(l)))}}),c.length>0&&f.fitBounds(t)),R()}},T=t=>{google.maps.event.addListener(t,"click",()=>{y.value!==t&&(c.forEach(o=>{o.setOptions({fillColor:"#0000FF",editable:!1})}),t.setOptions({fillColor:"#00FF00",editable:!0}),y.value=t)})},j=t=>{if(w.value){let o=t=="draw"?google.maps.drawing.OverlayType.POLYGON:null;w.value.setDrawingMode(o)}},X=()=>{if(y.value){const t=Z(y.value);t>-1&&(c[t].setMap(null),c.splice(t,1)),y.value=null,j("grab")}},W=()=>{c.forEach(t=>{t.setMap(null),y.value=null}),c=[]},Y=(t,o)=>{const r=t.getPath().getArray().map(l=>({lat:l.lat(),lng:l.lng()})),_=o.getPath().getArray().map(l=>({lat:l.lat(),lng:l.lng()}));return JSON.stringify(r)===JSON.stringify(_)},Z=t=>{for(let o=0;o<c.length;o++)if(Y(t,c[o]))return o;return-1},R=()=>{w.value=new google.maps.drawing.DrawingManager({drawingMode:null,drawingControl:!1,polygonOptions:{fillColor:"#0000FF",fillOpacity:.3,strokeWeight:1,clickable:!0,editable:!1,zIndex:1}}),w.value.setMap(f),google.maps.event.addListener(w.value,"overlaycomplete",function(t){t.type===google.maps.drawing.OverlayType.POLYGON&&(c.push(t.overlay),T(t.overlay))})},Q=async()=>{if(i.app_for=="demo"){Swal.fire(a("error"),a("you_are_not_authorised"),"error");return}const t=$();if(Object.keys(t).length===0)try{if(c.length===0){g.value=a("at_least_one_completed_polygon_is_required");return}const o=c.map(l=>l.getPath().getArray().map(M=>[M.lng(),M.lat()])),r={...m.data(),coordinates:JSON.stringify(o)};(await z.post(`/airport/update/${e.id}`,r)).status===200?(E.value=a("airport_created_successfully"),m.reset(),q.get("/airport")):console.error(a("failed_to_update_airport"))}catch(o){o.response&&o.response.status===403?(g.value=o.response.data.alertMessage,setTimeout(()=>{q.get("/airport")},5e3)):o.response&&o.response.status===422?(g.value=o.response.data.message,m.errors={coordinates:o.response.data.message}):(m.errors={},g.value=a("failed_to_create_airport_catch"),console.error(a("error_updating_airport"),o))}else m.errors=t},$=()=>{const{service_location_id:t}=m,o={};return t?delete o.service_location_id:o.service_location_id=a("service_location_is_required"),o},ee=t=>{A.value=t};return re(async()=>{let t=!1;if(!h){console.error(a("google_map_api_key_is_null_or_undefined"));return}if(Object.keys(I).length==0&&await B(),document.querySelector(`script[src="https://maps.googleapis.com/maps/api/js?key=${h}&libraries=places,drawing"]`))t||(F(),D(),t=!0);else{const o=document.createElement("script");o.src=`https://maps.googleapis.com/maps/api/js?key=${h}&libraries=places,drawing`,o.onload=()=>{t||(F(),D(),t=!0)},document.head.appendChild(o)}}),{form:m,serviceLocations:n,handleSubmit:Q,serviceLocations:n,setActiveTab:ee,serviceLocations:n,search:P,suggestions:S,handleInput:H,selectSuggestion:U,alertMessage:g,languages:I,removeAllPolygons:W,removeSelectedPolygon:X,changeDrawingMode:j,activeTab:A}}},me={key:0,class:"row"},fe={class:"col-lg-6"},_e={class:"card"},ve={class:"card-body"},he={class:"mb-3"},ye={for:"service_location",class:"form-label"},be={value:"",disabled:""},we=["value"],Me={key:0,class:"text-danger"},ke={class:"mb-3"},Ae={for:"name",class:"form-label"},xe={class:"text-end"},Pe=["disabled"],Se={class:"mb-3"},Ce={key:0,class:"text-danger"},Le={class:"col-lg-6"},Oe={class:"card"},Ie={class:"card-body"},Ee={class:"autocomplete-container"},Ne={class:"input-group"},Be=["placeholder"],De={key:0,class:"autocomplete-results"},Fe=["onClick"],Te={class:"col-lg-1 col-md-2 col-sm-2",style:{position:"absolute","z-index":"50",top:"20%"}},je={class:"d-flex align-items-center"},ze={class:"card-body"},qe={class:"d-flex align-items-center"},Ke={class:"card-body"},Ve={class:"d-flex align-items-center"},Ge={class:"card-body"},He={class:"d-flex align-items-center"},Je={class:"card-body"},Ue={key:1},Xe={key:2,class:"custom-alert alert alert-danger alert-border-left fade show",role:"alert",id:"alertMsg"},We={class:"alert-content"};function Ye(i,e,h,a,I,B){const A=L("Head"),E=L("PageHeader"),g=L("BButton"),m=L("Layout");return d(),le(m,null,{default:k(()=>[b(A,{title:"Edit Airport"}),b(E,{title:i.$t("edit"),pageTitle:i.$t("airport"),pageLink:"/airport"},null,8,["title","pageTitle"]),h.airport?(d(),p("div",me,[s("div",fe,[s("div",_e,[s("div",ve,[s("form",{onSubmit:e[2]||(e[2]=ne((...n)=>a.handleSubmit&&a.handleSubmit(...n),["prevent"]))},[s("div",he,[s("label",ye,u(i.$t("service_location")),1),N(s("select",{class:"form-select",id:"service_location","onUpdate:modelValue":e[0]||(e[0]=n=>a.form.service_location_id=n)},[s("option",be,u(i.$t("select_service_location")),1),(d(!0),p(K,null,V(a.serviceLocations,n=>(d(),p("option",{key:n.id,value:n.id},u(n.name),9,we))),128))],512),[[ie,a.form.service_location_id]]),a.form.errors.service_location_id?(d(),p("span",Me,u(a.form.errors.service_location_id),1)):O("",!0)]),s("div",ke,[s("label",Ae,u(i.$t("name")),1),N(s("input",{type:"text",class:"form-control",placeholder:"Enter Name",id:"name","onUpdate:modelValue":e[1]||(e[1]=n=>a.form.name=n),required:""},null,512),[[G,a.form.name]])]),s("div",xe,[s("button",{type:"submit",class:"btn btn-primary",disabled:h.app_for==="demo"},u(i.$t("update")),9,Pe)]),s("div",Se,[a.form.errors.coordinates?(d(),p("span",Ce,u(a.form.errors.coordinates),1)):O("",!0)])],32)])])]),s("div",Le,[s("div",Oe,[s("div",Ie,[s("div",Ee,[s("div",Ne,[N(s("input",{type:"text",class:"form-control","onUpdate:modelValue":e[3]||(e[3]=n=>a.search=n),placeholder:i.$t("search_for_a_city"),id:"pac-input",autocomplete:"off",onInput:e[4]||(e[4]=(...n)=>a.handleInput&&a.handleInput(...n))},null,40,Be),[[G,a.search]])]),a.suggestions.length>0?(d(),p("div",De,[(d(!0),p(K,null,V(a.suggestions,n=>(d(),p("div",{key:n.placeId,class:"autocomplete-item",onClick:f=>a.selectSuggestion(n)},u(n.formattedAddress),9,Fe))),128))])):O("",!0)]),e[12]||(e[12]=s("div",{id:"map",style:{height:"400px"}},null,-1)),s("div",Te,[s("div",je,[s("div",ze,[b(g,{onClick:e[5]||(e[5]=n=>a.changeDrawingMode("grab")),class:"align-center"},{default:k(()=>[...e[8]||(e[8]=[s("i",{class:"bx bxs-hand-up fs-16"},null,-1)])]),_:1})])]),s("div",qe,[s("div",Ke,[b(g,{onClick:e[6]||(e[6]=n=>a.changeDrawingMode("draw")),class:"align-center"},{default:k(()=>[...e[9]||(e[9]=[s("i",{class:"bx bx-plus fs-16"},null,-1)])]),_:1})])]),s("div",Ve,[s("div",Ge,[b(g,{onClick:a.removeSelectedPolygon,class:"align-center"},{default:k(()=>[...e[10]||(e[10]=[s("i",{class:"bx bx-x fs-16"},null,-1)])]),_:1},8,["onClick"])])]),s("div",He,[s("div",Je,[b(g,{onClick:a.removeAllPolygons,class:"align-center"},{default:k(()=>[...e[11]||(e[11]=[s("i",{class:"bx bx-trash fs-16"},null,-1)])]),_:1},8,["onClick"])])])])])])])])):(d(),p("div",Ue,u(i.$t("lodaing")),1)),a.alertMessage?(d(),p("div",Xe,[s("div",We,[e[13]||(e[13]=s("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),e[14]||(e[14]=s("strong",null,"Alert",-1)),ce(" - "+u(a.alertMessage)+" ",1),s("button",{type:"button",class:"btn-close btn-close-danger",onClick:e[7]||(e[7]=(...n)=>i.dismissMessage&&i.dismissMessage(...n)),"aria-label":"Close Alert Message"})])])):O("",!0)]),_:1})}const tt=te(ue,[["render",Ye],["__scopeId","data-v-246b4684"]]);export{tt as default};
