import{_ as W,Z as J,B as K,$ as Y,P as Z,S as Q,W as p,D as X,r as g,o as $,N as ee,g as f,i as w,y as te,w as d,a as se,l,n as e,J as o,k as S,F as E,L as F,C as O,z as M}from"./vendor-54d6cb1e.js";import{L as ae}from"./main-b839be26.js";import{P as oe}from"./page-header-ff719701.js";import{F as le}from"./FormValidation-cabc17c8.js";import{g as ie}from"./googleMap-c31fbadb.js";import"./footer-7e4f68d9.js";import"./app-cb082573.js";const ne={data(){return{rightOffcanvas:!1}},components:{Layout:ae,PageHeader:oe,Head:J,Link:K,Scrollbar:Y,FormValidation:le,googleMap:ie,flatPickr:Z},computed:{...Q(["permissions"])},props:{successMessage:String,alertMessage:String,firebaseSettings:Array,app_for:String,map_key:String,driver_radius:Number,result:Object,baseUrl:String},methods:{timer(){let t;p.fire({title:"Booking alert!",html:"Your Ride has been Booked <b></b> Successfully.",timer:2e3,timerProgressBar:!0,didOpen:()=>{p.showLoading(),t=setInterval(()=>{p.getContent().querySelector("b").textContent=p.getTimerLeft()},100)},didClose:()=>{clearInterval(t)}}).then(s=>{s.dismiss===p.DismissReason.timer&&console.log("I was closed by the timer")})}},setup(t){const{t:s}=X(),i=g(!1),c=g(t.driver_radius??10),I=g(t.successMessage||""),R=g(t.alertMessage||""),P=()=>{I.value="",R.value=""},q=g(null),v=g([]),y=g(null),u=g(t.result),k=g({}),H=a=>{y.value=a,i.value=!0},j=async a=>{try{const r=await se.post(`/ongoing-rides/assign-driver/${u.value.id}`,{driver_id:a.id});r.data.status?(i.value=!1,p.fire(s("success"),s("users_assigned_successfully"),"success")):(p.fire(s("Warning"),r.data.message,"warning"),console.log(r))}catch(r){p.fire(s("Warning"),response.data.message,"warning"),console.error(r)}},z=()=>{k.value={},firebase.database().ref("drivers").on("value",r=>{v.value=[],r.forEach(m=>{const n=m.val(),b=Date.now()-15*60*1e3;if(n.updated_at<b)return;const h=n.g,_=N(h);if(_&&V(u.value.pick_lat,u.value.pick_lng,_.lat,_.lon)<=c.value&&n.is_available&&n.is_active&&n.vehicle_types.includes(u.value.vehicle_type_id)){v.value.push(n);const x=t.app_for=="demo"?"*********":n.name,D=t.app_for=="demo"?"*********":n.mobile;k.value[n.id]={lat:_.lat,lng:_.lon,type_icon:n.vehicle_type_icon,name:x,mobile:D}}})})},N=a=>{const r="0123456789bcdefghjkmnpqrstuvwxyz",m=[16,8,4,2,1];let n=!0,B=-90,b=90,h=-180,_=180,L,x;if(a){for(let D=0;D<a.length;D++){let G=a.charAt(D),U=r.indexOf(G);for(let T=0;T<5;T++){let A=m[T];if(n){let C=(h+_)/2;U&A?h=C:_=C}else{let C=(B+b)/2;U&A?B=C:b=C}n=!n}}return L=(B+b)/2,x=(h+_)/2,{lat:L,lon:x}}},V=(a,r,m,n)=>{const b=(m-a)*Math.PI/180,h=(n-r)*Math.PI/180,_=Math.sin(b/2)*Math.sin(b/2)+Math.cos(a*Math.PI/180)*Math.cos(m*Math.PI/180)*Math.sin(h/2)*Math.sin(h/2);return 6371*(2*Math.atan2(Math.sqrt(_),Math.sqrt(1-_)))};return $(async()=>{try{var a={apiKey:t.firebaseSettings.firebase_api_key,authDomain:t.firebaseSettings.firebase_auth_domain,databaseURL:t.firebaseSettings.firebase_database_url,projectId:t.firebaseSettings.firebase_project_id,storageBucket:t.firebaseSettings.firebase_storage_bucket,messagingSenderId:t.firebaseSettings.firebase_messaging_sender_id,appId:t.firebaseSettings.firebase_app_id};firebase.apps.length||firebase.initializeApp(a),firebase.database().ref("requests").child(u.value.id).on("value",m=>{const n=m.val();(n&&(n.is_accept||"driver_id"in n)||!n)&&ee.get(`/rides-request/view/${u.value.id}`)}),z()}catch(r){console.error(s("error_initializing_firebase_or_fetching_settings"),r)}}),{modalShow:i,selectedDriver:q,successMessage:I,alertMessage:R,modalDriver:y,assignDriver:j,assignModal:H,driverMarkers:k,fleetDrivers:v,dismissMessage:P,errors:{}}}},re={class:"col-lg-3"},de={class:"card-header"},ce={class:"card-title mb-0"},_e={class:"card-body p-4 text-center"},ue={class:"mx-auto avatar-md mb-3"},me=["src"],fe={class:"card-title mb-1"},ve={class:"text-muted mb-0"},ge={class:"col-lg-3"},be={class:"card-header"},he={class:"card-title mb-0"},pe={class:"card-body p-4 text-center"},ye={class:"mx-auto avatar-md mb-3"},ke=["src"],we={class:"card-title mb-1"},Me={class:"col-lg-6"},Se={class:"card-header"},Be={class:"card-title mb-0"},xe={class:"card-body p-4"},De={class:"mb-2"},Ce={class:"mb-2"},Le={key:0},Ie={class:"mb-2"},Re={class:"mb-2"},Pe={class:"btn-group mb-2"},qe={class:"btn btn-light dropdown-toggle",type:"button",id:"stop_locations_list","data-bs-toggle":"dropdown","data-bs-auto-close":"outside","aria-expanded":"false"},He={class:"dropdown-menu overflow-auto",style:{"max-width":"500px"},"aria-labelledby":"stop_locations_list"},je={class:"dropdown-item overflow-auto"},ze={key:1},Ne={class:"mb-2"},Ve={class:"mb-2"},Te={class:"row"},Ue={class:"col-12 col-lg-4",style:{"overflow-x":"auto"}},Ae={class:"row"},Ee={class:"row"},Fe=["onClick"],Oe={class:"col-sm-3 border-end d-flex align-items-center justify-content-center"},Ge=["src"],We={class:"col-sm-5 mt-3 border-end"},Je={class:"d-flex align-items-center"},Ke={class:"d-flex align-items-center"},Ye={class:"d-flex align-items-center"},Ze={class:"col-sm-4 d-flex align-items-center justify-content-center"},Qe=["onClick"],Xe={class:"col-12 col-lg-8"},$e={class:"mb-3 text-center m-auto"},et={id:"map",style:{height:"500px"}},tt={class:"col-lg-12"},st={class:"card-header"},at={class:"card-title mb-0"},ot={class:"card-body p-4 text-center"},lt={class:"mx-auto avatar-md mb-3"},it=["src"],nt={class:"card-title mb-1"},rt={class:"text-muted mb-0"},dt={class:"text-muted mb-0"},ct={class:"modal-footer v-modal-footer"};function _t(t,s,i,c,I,R){const P=f("Head"),q=f("PageHeader"),v=f("BRow"),y=f("BCardBody"),u=f("BCard"),k=f("BCol"),H=f("BCardHeader"),j=f("googleMap"),z=f("BLink"),N=f("BModal"),V=f("Layout");return w(),te(V,null,{default:d(()=>[l(P,{title:"Taxi Ride"}),l(q,{title:t.$t("book"),pageTitle:t.$t("taxi_ride"),pageLink:"/ongoing-rides"},null,8,["title","pageTitle"]),l(v,null,{default:d(()=>[l(k,null,{default:d(()=>[l(u,null,{default:d(()=>[l(y,null,{default:d(()=>[l(v,null,{default:d(()=>[e("div",re,[e("div",de,[e("h6",ce,o(t.$t("user_details")),1)]),e("div",_e,[e("div",ue,[e("img",{src:i.result.userDetail.data.profile_picture,alt:"2",class:"avatar-md rounded-circle"},null,8,me)]),e("h5",fe,o(i.result.userDetail.data.name),1),e("p",ve,o(i.app_for=="demo"?"***********":i.result.userDetail.data.mobile),1)])]),e("div",ge,[e("div",be,[e("h6",he,o(t.$t("vehicle_details")),1)]),e("div",pe,[e("div",ye,[e("img",{src:i.result.vehicle_type_image,alt:"2",class:"avatar-md rounded-circle"},null,8,ke)]),e("h5",we,o(i.result.vehicle_type_name),1)])]),e("div",Me,[e("div",Se,[e("h6",Be,o(t.$t("trip_details")),1)]),e("div",xe,[e("h5",De,[e("b",null,o(t.$t("pickup_location")),1)]),e("h6",Ce,o(i.result.pick_address),1),i.result.requestStops.data.length>0?(w(),S("div",Le,[e("h5",Ie,[e("b",null,o(t.$t("stop_location")),1)]),e("h5",Re,[e("b",null,o(t.$t("stop_location")),1)]),e("div",Pe,[e("button",qe,o(t.$t("view_stop_location")),1),e("ul",He,[(w(!0),S(E,null,F(i.result.requestStops.data,(a,r)=>(w(),S("li",null,[e("a",je,o(a.address),1)]))),256))])])])):O("",!0),i.result.is_rental?O("",!0):(w(),S("div",ze,[e("h5",Ne,[e("b",null,o(t.$t("drop_location")),1)]),e("h6",Ve,o(i.result.drop_address),1)]))])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(v,null,{default:d(()=>[l(k,{lg:"12"},{default:d(()=>[l(u,{"no-body":"",id:"tasksList"},{default:d(()=>[l(H,{class:"border-0"}),l(y,{class:"border border-dashed border-end-0 border-start-0"},{default:d(()=>[e("div",Te,[e("div",Ue,[e("div",Ae,[l(v,null,{default:d(()=>[l(u,{"no-body":""},{default:d(()=>[l(y,{class:"overflow-y-auto",style:{"max-height":"500px",width:"100%"}},{default:d(()=>[l(k,{xl:"12"},{default:d(()=>[e("div",Ee,[(w(!0),S(E,null,F(c.fleetDrivers,a=>(w(),S("div",{key:a.driver_id,onClick:r=>c.selectedDriver=c.driverMarkers[a.id],class:"row"},[e("div",Oe,[e("div",null,[e("img",{class:"rounded-circle avatar-md",alt:"200x200",src:a.profile_picture},null,8,Ge)])]),e("div",We,[e("div",Je,[s[3]||(s[3]=e("i",{class:"ri-user-line",style:{"font-size":"20px"}},null,-1)),s[4]||(s[4]=M("    ",-1)),e("span",null,o(a.name),1)]),e("div",Ke,[s[5]||(s[5]=e("i",{class:"ri-phone-line",style:{"font-size":"20px"}},null,-1)),s[6]||(s[6]=M("    ",-1)),e("span",null,o(i.app_for=="demo"?"***********":a.mobile),1)]),e("div",Ye,[s[7]||(s[7]=e("i",{class:"ri-star-fill",style:{"font-size":"20px"}},null,-1)),s[8]||(s[8]=M("    ",-1)),e("span",null,o(a.rating),1)])]),e("div",Ze,[e("div",null,[e("button",{onClick:r=>c.assignModal(a),type:"button",class:"btn btn-info btn-label waves-effect waves-light"},[s[9]||(s[9]=e("i",{class:"ri-car-line label-icon fs-20 align-middle me-2"},null,-1)),M(" "+o(t.$t("assign")),1)],8,Qe)])])],8,Fe))),128))])]),_:1})]),_:1})]),_:1})]),_:1})])]),e("div",Xe,[e("div",$e,[e("div",et,[l(j,{baseUrl:i.baseUrl,pick_location:{lat:i.result.pick_lat,lng:i.result.pick_lng},nearbyDrivers:c.driverMarkers,driver:c.selectedDriver,map_key:i.map_key,libraries:["marker","geometry"]},{default:d(()=>[M(o(t.$t("map_loading")),1)]),_:1},8,["baseUrl","pick_location","nearbyDrivers","driver","map_key"])])])])])]),_:1})]),_:1})]),_:1})]),_:1}),e("div",null,[l(N,{modelValue:c.modalShow,"onUpdate:modelValue":s[2]||(s[2]=a=>c.modalShow=a),"hide-footer":"",title:t.$t("driver_details"),class:"v-modal-custom",size:"sm"},{default:d(()=>[l(u,null,{default:d(()=>[l(y,null,{default:d(()=>[l(v,null,{default:d(()=>{var a,r,m;return[e("div",tt,[e("div",st,[e("h6",at,o(t.$t("confirm_assign_driver")),1)]),e("div",ot,[e("div",lt,[e("img",{src:(a=c.modalDriver)==null?void 0:a.profile_picture,alt:"2",class:"avatar-md rounded-circle"},null,8,it)]),e("h5",nt,o((r=c.modalDriver)==null?void 0:r.name),1),e("p",rt,o(i.app_for=="demo"?"***********":(m=c.modalDriver)==null?void 0:m.mobile),1)]),e("p",dt,o(t.$t("confirm_assign_driver_info")),1)])]}),_:1})]),_:1})]),_:1}),e("div",ct,[l(z,{href:"javascript:void(0);",class:"btn btn-link link-warning fw-medium",onClick:s[0]||(s[0]=a=>c.modalShow=!1)},{default:d(()=>[s[10]||(s[10]=e("i",{class:"ri-close-line me-1 align-middle"},null,-1)),M(" "+o(t.$t("close")),1)]),_:1}),e("button",{type:"button",class:"btn btn-soft-info waves-effect waves-light",onClick:s[1]||(s[1]=a=>c.assignDriver(c.modalDriver))},[s[11]||(s[11]=e("i",{class:"ri-car-line me-1 align-middle"},null,-1)),M(" "+o(t.$t("assign_driver")),1)])])]),_:1},8,["modelValue","title"])])]),_:1})}const pt=W(ne,[["render",_t]]);export{pt as default};
