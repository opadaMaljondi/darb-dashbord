import{_ as $,Z as ee,O as te,P as ae,B as se,D as ie,r as _,T as oe,R as le,o as ne,a as Y,S as re,g as c,i as m,y as G,w as d,W as I,N as de,l as n,n as e,J as o,t as w,K as ce,k as f,L as J,F as K,q as C,C as h,z as u,p as X,X as S}from"./vendor-8caf5d52.js";import{L as me}from"./dispatchmain-dd968ef5.js";import{P as _e}from"./page-header-18309276.js";import{P as fe}from"./Pagination-0518e4bd.js";import{s as ue}from"./search-769502e2.js";import{s as ve}from"./searchbar-e42e22fa.js";import"./footer-502c2797.js";import{_ as pe}from"./search-file-ab3e1046.js";import"./dispatchHorizontal-e3ea663d.js";import"./app-974c65a1.js";const be={data(){return{rightOffcanvas:!1}},components:{Layout:me,PageHeader:_e,Head:ee,Pagination:fe,Multiselect:te,flatPickr:ae,Link:se,search:ue,searchbar:ve},props:{successMessage:String,alertMessage:String,zones:Object,firebaseConfig:Object,service_location_id:String,ongoing_rides:Object,enable_outstation:Boolean,types:Object},methods:{navigateToInvoice(i,t){const y=`/dispatcher/rides_request/download-invoice/${t}?invoice_type=${i}`;window.location.href=y},navigateUserInvoice(i){this.navigateToInvoice("user",i)},navigateDriverInvoice(i){this.navigateToInvoice("driver",i)}},setup(i){const{t}=ie(),y=_(""),s=_("all"),P=oe({ride_status:"all",is_bid_ride:null,zone_id:null,vehicle_type_id:null,is_paid:null,service_location_id:i.service_location_id,limit:10,payment_opt:null}),x=_(i.zones),L=_(i.types),A=_(i.ongoing_rides),r=_([]),T=_({}),B=_(!1),M=_(!1),H=_(null),V=_(i.successMessage||""),q=_(i.alertMessage||""),U=_({}),R=_([]),z=()=>{V.value="",q.value=""},D=_(!1),F=()=>{k(),M.value=!0,D.value=!1},E=()=>{P.reset(),k(),M.value=!1,D.value=!1};le(s,l=>{P.ride_status=l,k()}),ne(async()=>{try{const l=i.firebaseConfig;firebase.apps.length||firebase.initializeApp(l);const v=firebase.database();A.value.forEach(b=>{v.ref(`requests/${b}`).on("value",function(Q){const g=r.value.findIndex(p=>p.id===b);if(g!==-1){const p=Q.val();p.is_completed&&(r.value[g].is_completed=!0),p.accept!==1&&(r.value[g].driver_id=null),p.driver_id&&(r.value[g].driver_id=p.driver_id),p.hasOwnProperty("modified_by_driver")&&(r.value[g].is_driver_started=1),p.trip_arrived==1&&(r.value[g].is_driver_arrived=!0),p.trip_start==1&&(r.value[g].is_trip_start=!0),p.is_completed&&(r.value[g].is_completed=!0),(p.is_cancelled||p.is_cancel)&&(r.value[g].is_cancelled=!0)}})}),k()}catch(l){console.error(t("error_initializing_firebase_or_fetching_settings"),l)}});const N=()=>{B.value=!1},a=async l=>{try{const v=await Y.get(`/dispatcher/rides_request/cancel/${l}`),b=r.value.findIndex(W=>W.id===l);b!==-1&&(r.value[b]=v.data.request),B.value=!1,I.fire(t("success"),t("trip_cancelled_successfully"),"success")}catch(v){console.log(v),I.fire(t("error"),t("failed_to_cancel_trip"),"error")}},j=async l=>{I.fire({title:"Are you sure?",text:"You want to be cancel this ride!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#34c38f",cancelButtonColor:"#f46a6a",confirmButtonText:"Yes, Cancel!",cancelButtonText:"Close"}).then(async v=>{if(v.isConfirmed)try{await a(l)}catch(b){console.error(t("error_deleting_data"),b),I.fire(t("error"),t("failed_to_cancel_the_data"),"error")}})},O=async l=>{y.value=l,k()},k=async(l=1)=>{try{const v=P.data();y.value.length>0&&(v.search=y.value),v.page=l;const b=await Y.get("/dispatcher/rides_request/list",{params:v});r.value=b.data.results,T.value=b.data.paginator,Z(T.value.total),M.value=!1}catch(v){console.error(t("error_fetching_requests"),v)}},Z=()=>{U.value=[10,25,50,100,200,500]};return{results:r,modalShow:B,deleteItemId:H,successMessage:V,alertMessage:q,filterData:F,deleteModal:j,closeModal:N,deleteData:a,dismissMessage:z,searchTerm:y,paginator:T,modalFilter:M,clearFilter:E,fetchDatas:k,filter:P,zones:x,types:L,rideStatus:l=>l.is_cancelled?"Cancelled":l.is_completed?"Completed":l.is_trip_start?"On Trip":l.is_driver_arrived?"Driver Arrived":l.is_later&&l.is_driver_started?"Driver Started":l.is_driver_started?"Accepted":l.is_later?"Upcoming":"Searching",handlePageChanged:async l=>{k(l)},editData:async l=>{de.get(`/dispatcher/rides_request/view/${l.id}`)},activeTab:s,fetchSearch:O,rightOffcanvas:D,paginatorOption:U,changeEntriesPerPage:()=>{k()},zoneList:R}},computed:{...re(["permissions"])}},ge={class:"d-flex align-items-center mt-3"},he={class:"me-2 text-muted"},ye=["value"],ke={class:"ms-2 text-muted"},we={class:"card-header"},Ce={class:"row align-items-center"},Be={class:"col"},Me={class:"nav nav-tabs-custom card-header-tabs border-bottom-0",role:"tablist"},Se={class:"nav-item",role:"presentation"},Pe={class:"nav-item",role:"presentation"},Te={class:"nav-item",role:"presentation"},Ve={class:"nav-item",role:"presentation"},De={key:0,class:"nav-item",role:"presentation"},Oe={class:"nav-item",role:"presentation"},xe={class:"d-flex align-items-center gap-2"},qe={class:"table-responsive"},Ue={class:"table align-middle position-relative table-nowrap"},ze={class:"table-active"},Ie={scope:"col"},Le={scope:"col"},Ae={scope:"col"},He={scope:"col"},Re={scope:"col"},Fe={scope:"col"},Ee={scope:"col"},Ne={scope:"col"},je={key:0},We={class:"dropdown"},Ye={class:"dropdown-menu dropdown-menu-end"},Ge=["onClick"],Je={key:1},Ke=["onClick"],Xe={key:2},Ze={key:3},Qe=["onClick"],$e=["onClick"],et={key:1},tt={colspan:"10",class:"text-center"},at={key:0,class:"custom-alert alert alert-success alert-border-left fade show",data:"alert",id:"alertMsg"},st={class:"alert-content"},it={key:1,class:"custom-alert alert alert-danger alert-border-left fade show",data:"alert",id:"alertMsg"},ot={class:"alert-content"},lt={class:"offcanvas-body"},nt={class:"mb-4"},rt={for:"zone-select",class:"form-label text-muted text-uppercase fw-semibold mb-3"},dt={class:"mb-4"},ct={for:"vehicle_type",class:"form-label text-muted text-uppercase fw-semibold mb-3"},mt={class:"mb-4"},_t={for:"payment-status-select",class:"form-label text-muted text-uppercase fw-semibold mb-3"},ft={class:"form-check form-check-inline"},ut={class:"form-check-label",for:"not_paid"},vt={class:"form-check form-check-inline"},pt={class:"form-check-label",for:"paid"},bt={class:"mb-4"},gt={for:"dispatch-type-select",class:"form-label text-muted text-uppercase fw-semibold mb-3"},ht={class:"form-check form-check-inline"},yt={class:"form-check-label",for:"normal"},kt={class:"form-check form-check-inline"},wt={class:"form-check-label",for:"bidding"},Ct={class:"mb-4"},Bt={for:"payment-status-select",class:"form-label text-muted text-uppercase fw-semibold mb-3"},Mt={class:"form-check form-check-inline"},St={class:"form-check-label",for:"card"},Pt={class:"form-check form-check-inline"},Tt={class:"form-check-label",for:"cash"},Vt={class:"form-check form-check-inline"},Dt={class:"form-check-label",for:"wallet"},Ot={class:"offcanvas-footer border-top p-3 text-center hstack gap-2"};function xt(i,t,y,s,P,x){const L=c("Head"),A=c("PageHeader"),r=c("BCol"),T=c("searchbar"),B=c("BButton"),M=c("BRow"),H=c("BCardHeader"),V=c("BBadge"),q=c("Link"),U=c("BCardBody"),R=c("BCard"),z=c("Multiselect"),D=c("BFrom"),F=c("BOffcanvas"),E=c("Pagination"),N=c("Layout");return m(),G(N,null,{default:d(()=>[n(L,{title:"Rides Request"}),n(A,{title:i.$t("index"),pageTitle:i.$t("ride_request")},null,8,["title","pageTitle"]),n(M,null,{default:d(()=>[n(r,{lg:"12"},{default:d(()=>[n(R,{"no-body":"",id:"tasksList"},{default:d(()=>[n(H,{class:"border-0"},{default:d(()=>[n(M,{class:"g-2"},{default:d(()=>[n(r,{md:"3"},{default:d(()=>[e("div",ge,[e("label",he,o(i.$t("show")),1),w(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>s.filter.limit=a),onChange:t[1]||(t[1]=(...a)=>s.changeEntriesPerPage&&s.changeEntriesPerPage(...a)),class:"form-select form-select-sm w-auto"},[(m(!0),f(K,null,J(s.paginatorOption,a=>(m(),f("option",{key:a,value:a},o(a),9,ye))),128))],544),[[ce,s.filter.limit]]),e("label",ke,o(i.$t("entries")),1)])]),_:1}),n(r,{md:"6"},{default:d(()=>[e("div",we,[e("div",Ce,[e("div",Be,[e("ul",Me,[e("li",Se,[e("a",{class:C(["nav-link fw-semibold btn",{active:s.activeTab==="all"}]),onClick:t[2]||(t[2]=a=>s.activeTab="all"),role:"tab","aria-selected":"false"},o(i.$t("all")),3)]),e("li",Pe,[e("a",{class:C(["nav-link fw-semibold btn",{active:s.activeTab==="completed"}]),onClick:t[3]||(t[3]=a=>s.activeTab="completed"),role:"tab","aria-selected":"false"},o(i.$t("completed")),3)]),e("li",Te,[e("a",{class:C(["nav-link fw-semibold btn",{active:s.activeTab==="cancelled"}]),onClick:t[4]||(t[4]=a=>s.activeTab="cancelled"),role:"tab","aria-selected":"true"},o(i.$t("cancelled")),3)]),e("li",Ve,[e("a",{class:C(["nav-link fw-semibold btn",{active:s.activeTab==="upcoming"}]),onClick:t[5]||(t[5]=a=>s.activeTab="upcoming"),role:"tab","aria-selected":"true"},o(i.$t("upcoming")),3)]),y.enable_outstation?(m(),f("li",De,[e("a",{class:C(["nav-link fw-semibold btn",{active:s.activeTab==="outstation"}]),onClick:t[6]||(t[6]=a=>s.activeTab="outstation"),role:"tab","aria-selected":"true"},o(i.$t("outstation")),3)])):h("",!0),e("li",Oe,[e("a",{class:C(["nav-link fw-semibold btn",{active:s.activeTab==="ontrip"}]),onClick:t[7]||(t[7]=a=>s.activeTab="ontrip"),role:"tab","aria-selected":"true"},o(i.$t("on_trip")),3)])])])])])]),_:1}),n(r,{md:"auto",class:"ms-auto"},{default:d(()=>[e("div",xe,[n(T,{onSearch:s.fetchSearch},null,8,["onSearch"]),n(B,{variant:"danger",onClick:t[8]||(t[8]=a=>s.rightOffcanvas=!0)},{default:d(()=>[t[21]||(t[21]=e("i",{class:"ri-filter-2-line me-1 align-bottom"},null,-1)),u(" "+o(i.$t("filters")),1)]),_:1,__:[21]})])]),_:1})]),_:1})]),_:1}),n(U,{class:"border border-dashed border-end-0 border-start-0"},{default:d(()=>[e("div",qe,[e("table",Ue,[e("thead",ze,[e("tr",null,[e("th",Ie,o(i.$t("request_id")),1),e("th",Le,o(i.$t("date")),1),e("th",Ae,o(i.$t("user_name")),1),e("th",He,o(i.$t("driver_name")),1),e("th",Re,o(i.$t("transport_type")),1),e("th",Fe,o(i.$t("trip_status")),1),e("th",Ee,o(i.$t("payment_option")),1),e("th",Ne,o(i.$t("action")),1)])]),s.results.length>0?(m(),f("tbody",je,[(m(!0),f(K,null,J(s.results,(a,j)=>(m(),f("tr",{key:j},[e("td",null,o(a.request_number),1),e("td",null,o(a.is_later?a.converted_trip_start_time:a.converted_created_at),1),e("td",null,o(a.user_name?a.user_name:"----"),1),e("td",null,o(a.driver_name?a.driver_name:"----"),1),e("td",null,o(a.transport_type=="taxi"?i.$t("taxi"):i.$t("delivery"))+" "+o(a.is_bid_ride?i.$t("bidding"):""),1),e("td",null,[n(V,{class:C({"text-uppercase":!0,"text-bg-success":s.rideStatus(a)==="Completed"||s.rideStatus(a)==="Accepted"||s.rideStatus(a)==="Driver Started","text-bg-danger":s.rideStatus(a)==="Cancelled","text-bg-info":s.rideStatus(a)==="On Trip","text-bg-warning":s.rideStatus(a)==="Upcoming"||s.rideStatus(a)==="Driver Arrived"||s.rideStatus(a)==="Searching"})},{default:d(()=>[u(o(s.rideStatus(a)),1)]),_:2},1032,["class"])]),e("td",null,[n(V,{class:C({"text-uppercase":!0,"text-bg-success":a.is_paid,"text-bg-danger":!a.is_paid})},{default:d(()=>[u(o(a.payment_opt==1?"Cash":a.payment_opt==2?"Wallet":"Card"),1)]),_:2},1032,["class"])]),e("td",null,[e("div",We,[t[27]||(t[27]=e("a",{class:"text-reset",href:"#","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},[e("span",{class:"text-muted fs-18"},[e("i",{class:"mdi mdi-dots-vertical"})])],-1)),e("div",Ye,[i.permissions.includes("dispatcher-ride-request-view")?(m(),f("div",{key:0,class:"dropdown-item",type:"button",onClick:X(O=>s.editData(a),["prevent"])},[t[22]||(t[22]=e("i",{class:"bx bx-show-alt align-center text-muted me-2"},null,-1)),u(" "+o(i.$t("view")),1)],8,Ge)):h("",!0),i.permissions.includes("dispatcher-ride-request-cancel")?(m(),f("div",Je,[!a.is_cancelled&&!a.is_completed?(m(),f("div",{key:0,class:"dropdown-item",type:"button",onClick:X(O=>s.deleteModal(a.id),["prevent"])},[t[23]||(t[23]=e("i",{class:"bx bx-show-alt align-center text-muted me-2"},null,-1)),u(" "+o(i.$t("cancel")),1)],8,Ke)):h("",!0)])):h("",!0),i.permissions.includes("dispatcher-ride-request-assign")?(m(),f("div",Xe,[!a.driver_id&&!a.is_cancelled&&!a.is_completed?(m(),G(q,{key:0,class:"dropdown-item",type:"button",href:`ongoing_request/assign/${a.id}`},{default:d(()=>[t[24]||(t[24]=e("i",{class:"bx bx-show-alt align-center text-muted me-2"},null,-1)),u(" "+o(i.$t("assign")),1)]),_:2,__:[24]},1032,["href"])):h("",!0)])):h("",!0),a.is_completed?(m(),f("div",Ze,[e("button",{onClick:O=>x.navigateUserInvoice(a.id),class:"dropdown-item"},[t[25]||(t[25]=e("i",{class:"bx bx-file align-center text-muted me-2"},null,-1)),u(" "+o(i.$t("Download User Invoice")),1)],8,Qe),e("button",{onClick:O=>x.navigateDriverInvoice(a.id),class:"dropdown-item"},[t[26]||(t[26]=e("i",{class:"bx bx-file align-center text-muted me-2"},null,-1)),u(" "+o(i.$t("Download Driver Invoice")),1)],8,$e)])):h("",!0)])])])]))),128))])):(m(),f("tbody",et,[e("tr",null,[e("td",tt,[t[28]||(t[28]=e("img",{src:pe,alt:"Loading...",style:{width:"100px"}},null,-1)),e("h5",null,o(i.$t("no_data_found")),1)])])]))])])]),_:1})]),_:1})]),_:1})]),_:1}),e("div",null,[s.successMessage?(m(),f("div",at,[e("div",st,[t[29]||(t[29]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),t[30]||(t[30]=u()),t[31]||(t[31]=e("strong",null,"Success",-1)),u(" - "+o(s.successMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-success",onClick:t[9]||(t[9]=(...a)=>s.dismissMessage&&s.dismissMessage(...a)),"aria-label":"Close Success Message"})])])):h("",!0),s.alertMessage?(m(),f("div",it,[e("div",ot,[t[32]||(t[32]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),t[33]||(t[33]=u()),t[34]||(t[34]=e("strong",null,"Alert",-1)),u(" - "+o(s.alertMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-danger",onClick:t[10]||(t[10]=(...a)=>s.dismissMessage&&s.dismissMessage(...a)),"aria-label":"Close Alert Message"})])])):h("",!0)]),n(F,{modelValue:s.rightOffcanvas,"onUpdate:modelValue":t[20]||(t[20]=a=>s.rightOffcanvas=a),placement:"end",title:i.$t("filters"),"header-class":"bg-light","body-class":"p-0 overflow-hidden","footer-class":"border-top p-3 text-center"},{default:d(()=>[n(D,{action:"",class:"d-flex flex-column justify-content-end h-100"},{default:d(()=>[e("div",lt,[e("div",nt,[e("label",rt,o(i.$t("zone")),1),n(z,{modelValue:s.filter.zone_id,"onUpdate:modelValue":t[11]||(t[11]=a=>s.filter.zone_id=a),id:"zone_id",mode:"tags",options:s.zoneList.map(a=>({value:a.id,label:a.name})),"close-on-select":!1,multiple:!0,searchable:!0,placeholder:i.$t("select_a_zone"),"create-option":!1},null,8,["modelValue","options","placeholder"])]),e("div",dt,[e("label",ct,o(i.$t("vehicle_type")),1),n(z,{id:"vehicle_type_id",mode:"tags",modelValue:s.filter.vehicle_type_id,"onUpdate:modelValue":t[12]||(t[12]=a=>s.filter.vehicle_type_id=a),options:s.types.map(a=>({value:a.id,label:a.name})),"close-on-select":!1,searchable:!0,placeholder:i.$t("select_vehicle_type"),"create-option":!1},null,8,["modelValue","options","placeholder"])]),e("div",mt,[e("label",_t,o(i.$t("payment_status")),1),e("div",null,[e("div",ft,[w(e("input",{class:"form-check-input",type:"radio",name:"payment_status",id:"not_paid",value:"1","onUpdate:modelValue":t[13]||(t[13]=a=>s.filter.is_paid=a)},null,512),[[S,s.filter.is_paid]]),e("label",ut,o(i.$t("paid")),1)]),e("div",vt,[w(e("input",{class:"form-check-input",type:"radio",name:"payment_status",id:"paid",value:"0","onUpdate:modelValue":t[14]||(t[14]=a=>s.filter.is_paid=a)},null,512),[[S,s.filter.is_paid]]),e("label",pt,o(i.$t("not_paid")),1)])])]),e("div",bt,[e("label",gt,o(i.$t("ride_type")),1),e("div",null,[e("div",ht,[w(e("input",{class:"form-check-input",type:"radio",name:"dispatch-type",id:"normal",value:"0","onUpdate:modelValue":t[15]||(t[15]=a=>s.filter.is_bid_ride=a)},null,512),[[S,s.filter.is_bid_ride]]),e("label",yt,o(i.$t("regural")),1)]),e("div",kt,[w(e("input",{class:"form-check-input",type:"radio",name:"dispatch-type",id:"bidding",value:"1","onUpdate:modelValue":t[16]||(t[16]=a=>s.filter.is_bid_ride=a)},null,512),[[S,s.filter.is_bid_ride]]),e("label",wt,o(i.$t("bidding")),1)])])]),e("div",Ct,[e("label",Bt,o(i.$t("payment_option")),1),e("div",null,[e("div",Mt,[w(e("input",{class:"form-check-input",type:"radio",name:"payment_opt",id:"card",value:"0","onUpdate:modelValue":t[17]||(t[17]=a=>s.filter.payment_opt=a)},null,512),[[S,s.filter.payment_opt]]),e("label",St,o(i.$t("card")),1)]),e("div",Pt,[w(e("input",{class:"form-check-input",type:"radio",name:"payment_opt",id:"cash",value:"1","onUpdate:modelValue":t[18]||(t[18]=a=>s.filter.payment_opt=a)},null,512),[[S,s.filter.payment_opt]]),e("label",Tt,o(i.$t("cash")),1)]),e("div",Vt,[w(e("input",{class:"form-check-input",type:"radio",name:"payment_opt",id:"wallet",value:"2","onUpdate:modelValue":t[19]||(t[19]=a=>s.filter.payment_opt=a)},null,512),[[S,s.filter.payment_opt]]),e("label",Dt,o(i.$t("wallet")),1)])])]),t[35]||(t[35]=e("div",null,null,-1))]),e("div",Ot,[n(B,{variant:"light",onClick:s.clearFilter,class:"w-100"},{default:d(()=>[u(o(i.$t("clear_filter")),1)]),_:1},8,["onClick"]),n(B,{type:"submit",onClick:s.filterData,variant:"success",class:"w-100"},{default:d(()=>[u(o(i.$t("apply")),1)]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["modelValue","title"]),n(E,{paginator:s.paginator,onPageChanged:s.handlePageChanged},null,8,["paginator","onPageChanged"])]),_:1})}const Gt=$(be,[["render",xt]]);export{Gt as default};
