import{_ as ut,Z as _t,O as mt,P as ft,B as pt,D as gt,r as u,T as X,R as ht,S as vt,a as B,g as c,i as _,y as yt,w as d,W as b,N as G,l as i,n as t,J as s,t as S,K as H,k as m,L as J,F as K,z as f,C as E,p as Z,X as Q}from"./vendor-8caf5d52.js";import{L as bt}from"./main-cc7bd0ce.js";import{P as kt}from"./page-header-18309276.js";import{P as wt}from"./Pagination-0518e4bd.js";import{s as Ct}from"./searchbar-e42e22fa.js";import{u as Bt,l as St}from"./footer-502c2797.js";import{_ as xt}from"./search-file-ab3e1046.js";import"./app-974c65a1.js";const Mt={data(){return{rightOffcanvas:!1,counts:{open:0,acknowledge:0,closed:0,total:0}}},components:{Layout:bt,PageHeader:kt,Head:_t,Pagination:wt,Multiselect:mt,flatPickr:ft,Link:pt,searchbar:Ct},props:{successMessage:String,alertMessage:String,app_for:String,employees:Array,ticket:Object,support_ticket:Array,admin:Array},setup(a){const{t:e}=gt(),T=u(""),{selectedLocation:n}=Bt(),g=X({support_type:null,user_type:null,service_location_id:"all",status:null,limit:10}),h=u([]),x=u({}),M=u(!1),v=u(!1),j=u(null),k=u(!1),P=u([]);u(a.support_ticket);const V=u(),L=u(null),A=u({}),q=u(a.admin),w=X({assign_to:a.ticket&&a.ticket.assign_to||""}),N={assign_to:{required:!0}},R=u(a.successMessage||""),U=u(a.alertMessage||""),I=()=>{R.value="",U.value=""},O=u(!1),$=()=>{y(),v.value=!0,O.value=!1},z=()=>{g.reset(),y(),O.value=!1},o=()=>{M.value=!1},D=async l=>{try{await B.delete(`/title/delete/${l}`);const r=h.value.findIndex(p=>p.id===l);r!==-1&&h.value.splice(r,1),M.value=!1,b.fire(e("success"),e("title_deleted_successfully"),"success")}catch{b.fire(e("error"),e("failed_to_delete_title"),"error")}},Y=async l=>{b.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#34c38f",cancelButtonColor:"#f46a6a",confirmButtonText:"Yes, delete it!"}).then(async r=>{if(r.isConfirmed)try{await D(l)}catch(p){console.error(e("error_deleting_data"),p),b.fire(e("error"),e("failed_to_delete_the_data"),"error")}})},tt=async l=>{T.value=l,y()},y=async(l=1)=>{try{const r=g.data();r.search=T.value,r.page=l;const p=await B.get("/support-tickets/list",{params:r});h.value=p.data.results,console.log("result",h.value),x.value=p.data.paginator,rt(x.value.total),v.value=!1}catch(r){console.error(e("error_fetching_title"),r)}},et=async(l,r,p)=>{b.fire({title:e("are_you_sure"),text:e("you_are_about_to_change_status"),icon:"warning",showCancelButton:!0,confirmButtonColor:"#34c38f",cancelButtonColor:"#f46a6a",confirmButtonText:e("yes"),cancelButtonText:e("cancel")}).then(async F=>{if(F.isConfirmed)try{await B.post("/support-tickets/update-status",{id:l,status:r,employee_id:p});const C=h.value.findIndex(ct=>ct.id===l);C!==-1&&(h.value[C].active=r),b.fire(e("changed"),e("status_updated_successfully"),"success"),G.get("/support-tickets")}catch(C){console.error(e("error_updating_status"),C),b.fire(e("error"),e("failed_to_update_status"),"error")}})},st=async l=>{y(l)},ot=async l=>{G.get(`/title/edit/${l.id}`)},at=async l=>{k.value=!0,V.value=l;const r=V.value.ticket_title.category_type;r?await W(r):console.error("Category type is undefined")},W=async l=>{try{const r=await B.get(`/admins/list?category_type=${l}`),p=l.split(",");console.log(r.data.results),P.value=r.data.results.filter(F=>F.category_type&&p.some(C=>F.category_type.includes(C)))}catch(r){console.error("Error fetching employees:",r)}},nt=async()=>{console.log("data",w.data());try{const l=await B.post(`support-tickets/update/${V.value.id}`,{assign_to:w.assign_to});l.status===200||l.status===201?(w.reset(),G.get("/support-tickets")):console.error("Unexpected response status:",l.status)}catch(l){console.error("Error submitting form:",l)}},lt=l=>{switch(l){case 1:return"Pending";case 2:return"Acknowledge";case 3:return"Closed";default:return"Unknown"}},it=l=>{switch(l){case 1:return"primary";case 2:return"warning";case 3:return"danger";default:return"secondary"}},rt=()=>{A.value=[10,25,50,100,200,500]},dt=()=>{y()};return ht(n,l=>{g.service_location_id=l,y()}),{results:h,modalShow:M,deleteItemId:j,successMessage:R,alertMessage:U,filterData:$,deleteModal:Y,closeModal:o,deleteData:D,dismissMessage:I,searchTerm:T,fetchSearch:tt,paginator:x,modalFilter:v,clearFilter:z,fetchDatas:y,filter:g,handlePageChanged:st,editData:ot,rightOffcanvas:O,toggleActiveStatus:et,assignEmployees:at,showEmployess:k,employees_name:P,handleSubmit:nt,validationRules:N,validationRef:L,form:w,fetchEmployees:W,getStatusLabel:lt,getStatusVariant:it,paginatorOption:A,changeEntriesPerPage:dt,employee_id:q,selectedLocation:n}},computed:{...St,...vt(["permissions"])},methods:{async fetchTicketCounts(){try{const a=await B.get("/support-tickets/ticket-counts",{params:{service_location_id:this.selectedLocation}});this.counts=a.data}catch(a){console.error("Error fetching ticket counts:",a)}}},mounted(){this.filter.service_location_id=this.selectedLocation,this.fetchDatas(),this.fetchTicketCounts(),setInterval(this.fetchTicketCounts,1e4)}},Pt={class:"row"},Vt={class:"col-xxl-3 col-sm-6"},Lt={class:"card card-animate"},Ot={class:"card-body"},Et={class:"d-flex justify-content-between"},Tt={class:"fw-medium text-muted mb-0"},At={class:"mt-4 ff-secondary fw-semibold"},Rt={class:"counter-value","data-target":"547"},Ut={class:"col-xxl-3 col-sm-6"},Dt={class:"card card-animate"},Ft={class:"card-body"},Ht={class:"d-flex justify-content-between"},jt={class:"fw-medium text-muted mb-0"},qt={class:"mt-4 ff-secondary fw-semibold"},Nt={class:"counter-value","data-target":"547"},It={class:"col-xxl-3 col-sm-6"},$t={class:"card card-animate"},zt={class:"card-body"},Yt={class:"d-flex justify-content-between"},Gt={class:"fw-medium text-muted mb-0"},Jt={class:"mt-4 ff-secondary fw-semibold"},Kt={class:"counter-value","data-target":"124"},Wt={class:"col-xxl-3 col-sm-6"},Xt={class:"card card-animate"},Zt={class:"card-body"},Qt={class:"d-flex justify-content-between"},te={class:"fw-medium text-muted mb-0"},ee={class:"mt-4 ff-secondary fw-semibold"},se={class:"counter-value","data-target":"107"},oe={class:"d-flex align-items-center mt-3"},ae={class:"me-2 text-muted"},ne=["value"],le={class:"ms-2 text-muted"},ie={class:"d-flex align-items-center gap-2"},re={class:"table-responsive"},de={class:"table align-middle position-relative table-nowrap"},ce={class:"table-active"},ue={scope:"col"},_e={scope:"col"},me={scope:"col"},fe={scope:"col"},pe={scope:"col"},ge={scope:"col"},he={scope:"col"},ve={scope:"col"},ye={scope:"col"},be={scope:"col"},ke={key:0},we={key:0},Ce={style:{cursor:"pointer"}},Be={key:0},Se={key:1},xe={class:"dropdown"},Me={class:"dropdown-menu dropdown-menu-end"},Pe={key:0,class:"dropdown-item",href:"#"},Ve=["onClick"],Le=["onClick"],Oe={key:1},Ee={colspan:"12",class:"text-center"},Te={key:0,class:"custom-alert alert alert-success alert-border-left fade show",data:"alert",id:"alertMsg"},Ae={class:"alert-content"},Re={key:1,class:"custom-alert alert alert-danger alert-border-left fade show",data:"alert",id:"alertMsg"},Ue={class:"alert-content"},De={class:"row"},Fe={class:"col-sm-12"},He={class:"mb-3"},je={for:"assing_to",class:"form-label"},qe={value:"",disabled:""},Ne=["value"],Ie={class:"modal-footer v-modal-footer"},$e={class:"offcanvas-body"},ze={class:"mb-4"},Ye={for:"datepicker-range",class:"form-label text-muted text-uppercase fw-semibold mb-3"},Ge={selected:"",disabled:""},Je={value:"1"},Ke={value:"2"},We={value:"3"},Xe={class:"mb-4"},Ze={for:"user_type",class:"form-label text-muted text-uppercase fw-semibold mb-3"},Qe={disabled:"",value:""},ts={value:"user"},es={value:"driver"},ss={class:"mb-4"},os={for:"datepicker-range",class:"form-label text-muted text-uppercase fw-semibold mb-3"},as={class:"form-check form-check-inline"},ns={class:"form-check-label",for:"general"},ls={class:"form-check form-check-inline"},is={class:"form-check-label",for:"request"},rs={class:"offcanvas-footer border-top p-3 text-center hstack gap-2"};function ds(a,e,T,n,g,h){const x=c("Head"),M=c("PageHeader"),v=c("BCol"),j=c("searchbar"),k=c("BButton"),P=c("BRow"),V=c("BCardHeader"),L=c("BBadge"),A=c("Link"),q=c("BCardBody"),w=c("BCard"),N=c("BLink"),R=c("FormValidation"),U=c("BModal"),I=c("BFrom"),O=c("BOffcanvas"),$=c("Pagination"),z=c("Layout");return _(),yt(z,null,{default:d(()=>[i(x,{title:"Tickets"}),i(M,{title:a.$t("tickets"),pageTitle:a.$t("support_management")},null,8,["title","pageTitle"]),t("div",Pt,[t("div",Vt,[t("div",Lt,[t("div",Ot,[t("div",Et,[t("div",null,[t("h5",Tt,s(a.$t("total_tickets")),1),t("h2",At,[t("span",Rt,s(g.counts.total??0),1)])]),e[15]||(e[15]=t("div",null,[t("div",{class:"avatar-sm flex-shrink-0"},[t("span",{class:"avatar-title bg-success-subtle text-success rounded-circle fs-4"},[t("i",{class:"ri-ticket-2-line"})])])],-1))])])])]),t("div",Ut,[t("div",Dt,[t("div",Ft,[t("div",Ht,[t("div",null,[t("h5",jt,s(a.$t("pending"))+" "+s(a.$t("tickets")),1),t("h2",qt,[t("span",Nt,s(g.counts.open??0),1)])]),e[16]||(e[16]=t("div",null,[t("div",{class:"avatar-sm flex-shrink-0"},[t("span",{class:"avatar-title bg-info-subtle text-info rounded-circle fs-4"},[t("i",{class:"ri-ticket-2-line"})])])],-1))])])])]),t("div",It,[t("div",$t,[t("div",zt,[t("div",Yt,[t("div",null,[t("h5",Gt,s(a.$t("assigned_tickets")),1),t("h2",Jt,[t("span",Kt,s(g.counts.acknowledge??0),1)])]),e[17]||(e[17]=t("div",null,[t("div",{class:"avatar-sm flex-shrink-0"},[t("span",{class:"avatar-title bg-warning-subtle text-warning rounded-circle fs-4"},[t("i",{class:"ri-ticket-2-line"})])])],-1))])])])]),t("div",Wt,[t("div",Xt,[t("div",Zt,[t("div",Qt,[t("div",null,[t("h5",te,s(a.$t("closed_tickets")),1),t("h2",ee,[t("span",se,s(g.counts.closed??0),1)])]),e[18]||(e[18]=t("div",null,[t("div",{class:"avatar-sm flex-shrink-0"},[t("span",{class:"avatar-title bg-danger-subtle text-danger rounded-circle fs-4"},[t("i",{class:"ri-ticket-2-line"})])])],-1))])])])])]),i(P,null,{default:d(()=>[i(v,{lg:"12"},{default:d(()=>[i(w,{"no-body":"",id:"tasksList"},{default:d(()=>[i(V,{class:"border-0"},{default:d(()=>[i(P,{class:"g-2"},{default:d(()=>[i(v,{md:"3"},{default:d(()=>[t("div",oe,[t("label",ae,s(a.$t("show")),1),S(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>n.filter.limit=o),onChange:e[1]||(e[1]=(...o)=>n.changeEntriesPerPage&&n.changeEntriesPerPage(...o)),class:"form-select form-select-sm w-auto"},[(_(!0),m(K,null,J(n.paginatorOption,o=>(_(),m("option",{key:o,value:o},s(o),9,ne))),128))],544),[[H,n.filter.limit]]),t("label",le,s(a.$t("entries")),1)])]),_:1}),i(v,{md:"3"}),i(v,{md:"auto",class:"ms-auto"},{default:d(()=>[t("div",ie,[i(j,{placeholder:"search_by_ticket_id",onSearch:n.fetchSearch},null,8,["onSearch"]),i(k,{variant:"danger",onClick:e[2]||(e[2]=o=>n.rightOffcanvas=!0)},{default:d(()=>[e[19]||(e[19]=t("i",{class:"ri-filter-2-line me-1 align-bottom"},null,-1)),f(" "+s(a.$t("filters")),1)]),_:1,__:[19]})])]),_:1})]),_:1})]),_:1}),i(q,{class:"border border-dashed border-end-0 border-start-0"},{default:d(()=>[t("div",re,[t("table",de,[t("thead",ce,[t("tr",null,[t("th",ue,s(a.$t("ticket_id")),1),t("th",_e,s(a.$t("title")),1),t("th",me,s(a.$t("date")),1),t("th",fe,s(a.$t("support_type")),1),t("th",pe,s(a.$t("service_location")),1),t("th",ge,s(a.$t("user_name")),1),t("th",he,s(a.$t("user_type")),1),t("th",ve,s(a.$t("assign_to")),1),t("th",ye,s(a.$t("status")),1),t("th",be,s(a.$t("action")),1)])]),n.results.length>0?(_(),m("tbody",ke,[(_(!0),m(K,null,J(n.results,(o,D)=>(_(),m("tr",{key:D},[t("td",null,s(o.ticket_id),1),t("td",null,s(o.title),1),t("td",null,s(o.converted_created_at),1),t("td",null,[f(s(o.support_type)+" ",1),o.request_id?(_(),m("span",we,"("+s(o.request_id)+")",1)):E("",!0)]),t("td",null,s(o.service_location_name),1),t("td",null,s(o.user_name),1),t("td",null,s(o.user_type),1),t("td",Ce,[o!=null&&o.admin_details?(_(),m("span",Be,[i(L,{variant:"success"},{default:d(()=>[f(s(o.admin_details.first_name),1)]),_:2},1024)])):(_(),m("span",Se,[i(L,{variant:"warning"},{default:d(()=>[f(s(a.$t("not_taken")),1)]),_:1})]))]),t("td",null,[i(L,{variant:n.getStatusVariant(o.status)},{default:d(()=>[f(s(n.getStatusLabel(o.status)),1)]),_:2},1032,["variant"])]),t("div",xe,[e[23]||(e[23]=t("a",{class:"text-reset",href:"#","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},[t("span",{class:"text-muted fs-18"},[t("i",{class:"mdi mdi-dots-vertical"})])],-1)),t("div",Me,[o.status===1?(_(),m("a",Pe,[e[20]||(e[20]=t("i",{class:"bx bx-radio-circle-marked align-center text-muted me-2"},null,-1)),t("span",{onClick:Y=>n.toggleActiveStatus(o.id,2,n.employee_id.user_id)},s(a.$t("acknowledge")),9,Ve)])):E("",!0),o.status===2?(_(),m("a",{key:1,class:"dropdown-item",href:"#",onClick:Y=>n.toggleActiveStatus(o.id,3,n.employee_id.user_id)},[e[21]||(e[21]=t("i",{class:"bx bx-radio-circle-marked align-center text-muted me-2"},null,-1)),t("span",null,s(a.$t("closed")),1)],8,Le)):E("",!0),i(A,{class:"dropdown-item",href:`/support-tickets/view-details/${o.id}`},{default:d(()=>[e[22]||(e[22]=t("i",{class:"bx bx-radio-circle-marked align-center text-muted me-2"},null,-1)),f(" "+s(a.$t("view")),1)]),_:2,__:[22]},1032,["href"])])])]))),128))])):(_(),m("tbody",Oe,[t("tr",null,[t("td",Ee,[e[24]||(e[24]=t("img",{src:xt,alt:"Loading...",style:{width:"100px"}},null,-1)),t("h5",null,s(a.$t("no_data_found")),1)])])]))])])]),_:1})]),_:1})]),_:1})]),_:1}),t("div",null,[n.successMessage?(_(),m("div",Te,[t("div",Ae,[e[25]||(e[25]=t("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),e[26]||(e[26]=f()),e[27]||(e[27]=t("strong",null,"Success",-1)),f(" - "+s(n.successMessage)+" ",1),t("button",{type:"button",class:"btn-close btn-close-success",onClick:e[3]||(e[3]=(...o)=>n.dismissMessage&&n.dismissMessage(...o)),"aria-label":"Close Success Message"})])])):E("",!0),n.alertMessage?(_(),m("div",Re,[t("div",Ue,[e[28]||(e[28]=t("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),e[29]||(e[29]=f()),e[30]||(e[30]=t("strong",null,"Alert",-1)),f(" - "+s(n.alertMessage)+" ",1),t("button",{type:"button",class:"btn-close btn-close-danger",onClick:e[4]||(e[4]=(...o)=>n.dismissMessage&&n.dismissMessage(...o)),"aria-label":"Close Alert Message"})])])):E("",!0)]),i(U,{modelValue:n.showEmployess,"onUpdate:modelValue":e[9]||(e[9]=o=>n.showEmployess=o),"hide-footer":"",title:a.$t("assign_to"),class:"v-modal-custom",size:"md"},{default:d(()=>[t("form",{onSubmit:e[8]||(e[8]=Z((...o)=>n.handleSubmit&&n.handleSubmit(...o),["prevent"])),enctype:"multipart/form-data"},[i(R,{form:n.form,rules:n.validationRules,ref:"validationRef"},{default:d(()=>[t("div",De,[t("div",Fe,[t("div",He,[t("label",je,[f(s(a.$t("assign_to")),1),e[31]||(e[31]=t("span",{class:"text-danger"},"*",-1))]),S(t("select",{id:"assing_to",class:"form-control","onUpdate:modelValue":e[5]||(e[5]=o=>n.form.assign_to=o)},[t("option",qe,s(a.$t("select_title")),1),(_(!0),m(K,null,J(n.employees_name,o=>(_(),m("option",{key:o.first_name,value:o.user_id},s(o.first_name),9,Ne))),128))],512),[[H,n.form.assign_to]])])])]),t("div",Ie,[i(N,{href:"javascript:void(0);",class:"btn btn-link link-warning fw-medium",onClick:e[6]||(e[6]=o=>n.showEmployess=!1)},{default:d(()=>[e[32]||(e[32]=t("i",{class:"ri-close-line me-1 align-middle"},null,-1)),f(" "+s(a.$t("close")),1)]),_:1,__:[32]}),t("button",{type:"button",class:"btn btn-soft-info waves-effect waves-light",onClick:e[7]||(e[7]=Z((...o)=>n.handleSubmit&&n.handleSubmit(...o),["prevent"]))},s(a.$t("submit")),1)])]),_:1},8,["form","rules"])],32)]),_:1},8,["modelValue","title"]),i(O,{modelValue:n.rightOffcanvas,"onUpdate:modelValue":e[14]||(e[14]=o=>n.rightOffcanvas=o),placement:"end",title:a.$t("Ticket_filters"),"header-class":"bg-light","body-class":"p-0 overflow-hidden","footer-class":"border-top p-3 text-center"},{default:d(()=>[i(I,{action:"",class:"d-flex flex-column justify-content-end h-100"},{default:d(()=>[t("div",$e,[t("div",ze,[t("label",Ye,s(a.$t("status")),1),S(t("select",{class:"form-control","data-choices":"","data-choices-search-false":"",name:"choices-select-status",id:"choices-select-status","onUpdate:modelValue":e[10]||(e[10]=o=>n.filter.status=o)},[t("option",Ge,s(a.$t("select")),1),t("option",Je,s(a.$t("open")),1),t("option",Ke,s(a.$t("acknowledge")),1),t("option",We,s(a.$t("closed")),1)],512),[[H,n.filter.status]])]),t("div",Xe,[t("label",Ze,s(a.$t("user_type")),1),S(t("select",{id:"user_type",class:"form-control","data-choices":"","data-choices-search-false":"",name:"user_type","onUpdate:modelValue":e[11]||(e[11]=o=>n.filter.user_type=o)},[t("option",Qe,s(a.$t("select")),1),t("option",ts,s(a.$t("user")),1),t("option",es,s(a.$t("driver")),1)],512),[[H,n.filter.user_type]])]),t("div",ss,[t("label",os,s(a.$t("support_type")),1),t("div",null,[t("div",as,[S(t("input",{class:"form-check-input","onUpdate:modelValue":e[12]||(e[12]=o=>n.filter.support_type=o),type:"radio",name:"inlineRadioOptions",id:"general",value:"general"},null,512),[[Q,n.filter.support_type]]),t("label",ns,s(a.$t("general")),1)]),t("div",ls,[S(t("input",{class:"form-check-input","onUpdate:modelValue":e[13]||(e[13]=o=>n.filter.support_type=o),type:"radio",name:"inlineRadioOptions",id:"request",value:"request"},null,512),[[Q,n.filter.support_type]]),t("label",is,s(a.$t("request")),1)])])])]),t("div",rs,[i(k,{variant:"light",onClick:n.clearFilter,class:"w-100"},{default:d(()=>[f(s(a.$t("clear_filter")),1)]),_:1},8,["onClick"]),i(k,{type:"submit",onClick:n.filterData,variant:"success",class:"w-100"},{default:d(()=>[f(s(a.$t("apply")),1)]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["modelValue","title"]),i($,{paginator:n.paginator,onPageChanged:n.handlePageChanged},null,8,["paginator","onPageChanged"])]),_:1})}const vs=ut(Mt,[["render",ds]]);export{vs as default};
