import{_ as z,Z as G,O as K,D as q,r as u,R as N,o as J,g as n,i as E,y as Z,w as c,l as i,n as a,J as r,z as D,t as Q,K as W,k as X,C as Y}from"./vendor-54d6cb1e.js";import{L as x}from"./main-b839be26.js";import{P as ee}from"./page-header-ff719701.js";import{g as te}from"./googleMap-c31fbadb.js";import{u as le}from"./footer-7e4f68d9.js";import"./app-cb082573.js";const ae={components:{Head:G,Layout:x,PageHeader:ee,Multiselect:K,googleMap:te},props:{firebaseSettings:Object,map_key:String,service_location:Array,vehicle_type:Array,baseUrl:String,default_location:Object,app_for:String},setup(e){q();const s=u(null),f=u(null),t=u([]),{selectedLocation:I}=le(),U=u(e.service_location.map(o=>({value:o.id,label:o.name}))),j=u(e.vehicle_type.map(o=>({value:o.id,label:o.name}))),g=u({}),L=()=>{f.value=null,t.value=[],_()},M=()=>{_()},_=async()=>{firebase.database().ref("drivers").once("value",y=>{const B=y.val();B&&(g.value={},Object.keys(B).forEach(S=>{const l=B[S],C=l.g,b=O(C);if(b&&l.service_location_id){let h=!1;U.value.find(v=>v.value==l.service_location_id)&&(h=!0),s.value&&(h=s.value==l.service_location_id);let V=Array.isArray(l.vehicle_types);f.value&&Array.isArray(l.vehicle_types)&&l.vehicle_types.length>0&&(V=(Array.isArray(l.vehicle_types)&&l.vehicle_types.some(v=>f.value===v))??!1);let H=t.value.length>0?t.value.includes("online"):!0,w=t.value.length>0?t.value.includes("onride"):!0,P=t.value.length>0?t.value.includes("offline"):!0,p=!1;if(l.hasOwnProperty("is_active")&&l.hasOwnProperty("is_available")&&(l.is_active==1&&l.is_available==!0&&H||l.is_active==1&&l.is_available==!1&&w||P)&&(p=!0),h&&V&&p){const v=e.app_for=="demo"?"*********":l.mobile;g.value[l.id]={lat:b.lat,lng:b.lon,type_icon:l.vehicle_type_icon,name:l.name,mobile:v}}}}))})},O=o=>{const y="0123456789bcdefghjkmnpqrstuvwxyz",B=[16,8,4,2,1];let S=!0,l=-90,C=90,b=-180,h=180,V,H;if(o){for(let w=0;w<o.length;w++){let P=o.charAt(w),p=y.indexOf(P);for(let v=0;v<5;v++){let F=B[v];if(S){let A=(b+h)/2;p&F?b=A:h=A}else{let A=(l+C)/2;p&F?l=A:C=A}S=!S}}return V=(l+C)/2,H=(b+h)/2,{lat:V,lon:H}}};N(I,o=>{o!=="all"&&(s.value=o),_()}),N([f,t],()=>{_()}),J(async()=>{I.value!=="all"&&(s.value=I.value);var o={apiKey:e.firebaseSettings.firebase_api_key,authDomain:e.firebaseSettings.firebase_auth_domain,databaseURL:e.firebaseSettings.firebase_database_url,projectId:e.firebaseSettings.firebase_project_id,storageBucket:e.firebaseSettings.firebase_storage_bucket,messagingSenderId:e.firebaseSettings.firebase_messaging_sender_id,appId:e.firebaseSettings.firebase_app_id};firebase.apps.length||firebase.initializeApp(o),_();const y=localStorage.getItem("refreshMethod")??0;T.value=y,d(y)});const T=u(),k=u(!1),m=u(null),R=async o=>{localStorage.setItem("refreshMethod",o),d(o)},$=async()=>{await _()},d=o=>{m.value&&(clearInterval(m.value),m.value=null),o==0?(k.value=!1,m.value=setInterval(async()=>{await _()},1e3)):(k.value=!0,clearInterval(m.value),m.value=null)};return{serviceLocations:U,vehicleTypes:j,selectedServiceLocations:s,selectedDriverModes:t,clearFilters:L,applyFilters:M,selectedVehicleTypes:f,driverMarkers:g,refreshMethod:R,refresh_Method:T,refresh_btn:k,refreshBtn:$}}},se={class:"row"},oe={class:"col-12 col-lg-4"},ie={class:"mb-3"},ne={for:"select_driver_mode",class:"form-label"},re={class:"col-12 col-lg-4"},de={class:"mb-3"},ce={for:"vehicle_type",class:"form-label"},fe={class:"col-sm-2"},_e={class:"mb-3"},ve={for:"type",class:"form-label"},ue={disabled:"",value:""},me={value:"0"},be={value:"1"},he={key:0,class:"col-sm-2"},pe={class:"mb-3 mt-4"},ye={class:"col-12 col-lg-6 d-flex gap-1"},ge={id:"map",style:{height:"400px"}};function Me(e,s,f,t,I,U){const j=n("Head"),g=n("PageHeader"),L=n("Multiselect"),M=n("BButton"),_=n("BCardHeader"),O=n("googleMap"),T=n("BCardBody"),k=n("BCard"),m=n("BCol"),R=n("BRow"),$=n("Layout");return E(),Z($,null,{default:c(()=>[i(j,{title:e.$t("gods-eye")},null,8,["title"]),i(g,{title:e.$t("gods-eye"),pageTitle:e.$t("map")},null,8,["title","pageTitle"]),i(R,null,{default:c(()=>[i(m,{lg:"12"},{default:c(()=>[i(k,{"no-body":"",id:"tasksList"},{default:c(()=>[i(_,{class:"border-0"},{default:c(()=>[a("h4",null,r(e.$t("filters")),1),a("div",se,[a("div",oe,[a("div",ie,[a("label",ne,r(e.$t("drivers")),1),i(L,{modelValue:t.selectedDriverModes,"onUpdate:modelValue":s[0]||(s[0]=d=>t.selectedDriverModes=d),id:"select_driver_mode",mode:"tags","close-on-select":!1,searchable:!0,onChange:t.applyFilters,"create-option":!1,options:[{value:"offline",label:e.$t("offline")},{value:"online",label:e.$t("online")},{value:"onride",label:e.$t("onride")}],placeholder:e.$t("select_mode")},null,8,["modelValue","onChange","options","placeholder"])])]),a("div",re,[a("div",de,[a("label",ce,r(e.$t("vehicle_types")),1),i(L,{modelValue:t.selectedVehicleTypes,"onUpdate:modelValue":s[1]||(s[1]=d=>t.selectedVehicleTypes=d),options:t.vehicleTypes,label:"label","track-by":"value",multiple:"","close-on-select":"",placeholder:e.$t("select_vehicle_types")},null,8,["modelValue","options","placeholder"])])]),a("div",fe,[a("div",null,[a("div",_e,[a("label",ve,[D(r(e.$t("refresh_method"))+" ",1),s[5]||(s[5]=a("span",{class:"text-danger"},"*",-1))]),Q(a("select",{id:"type",class:"form-select","onUpdate:modelValue":s[2]||(s[2]=d=>t.refresh_Method=d),onChange:s[3]||(s[3]=d=>t.refreshMethod(t.refresh_Method))},[a("option",ue,r(e.$t("select_refresh_method")),1),a("option",me,r(e.$t("automatic")),1),a("option",be,r(e.$t("manual")),1)],544),[[W,t.refresh_Method]])])])]),t.refresh_btn?(E(),X("div",he,[a("div",pe,[i(M,{type:"button",variant:"primary",class:"btn btn-md",onClick:s[4]||(s[4]=d=>t.refreshBtn())},{default:c(()=>[s[6]||(s[6]=a("i",{class:"bx bx-refresh"},null,-1)),D(" "+r(e.$t("refresh")),1)]),_:1})])])):Y("",!0),a("div",ye,[i(M,{type:"button",variant:"success",class:"btn btn-md",onClick:t.applyFilters},{default:c(()=>[D(r(e.$t("apply")),1)]),_:1},8,["onClick"]),i(M,{type:"button",variant:"danger",class:"btn btn-md",onClick:t.clearFilters},{default:c(()=>[D(r(e.$t("clear")),1)]),_:1},8,["onClick"])])])]),_:1}),i(T,{class:"border border-dashed border-end-0 border-start-0"},{default:c(()=>[a("div",ge,[i(O,{baseUrl:f.baseUrl,default_location:f.default_location,nearbyDrivers:t.driverMarkers,map_key:f.map_key,libraries:["marker"]},{default:c(()=>[D(r(e.$t("map_loading")),1)]),_:1},8,["baseUrl","default_location","nearbyDrivers","map_key"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const Ae=z(ae,[["render",Me]]);export{Ae as default};
