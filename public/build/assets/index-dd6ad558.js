import{_ as ee,Z as te,O as oe,P as se,B as ae,D as le,r as m,T as ne,R as W,a3 as ie,a as I,S as re,g as u,U as de,i as d,y as D,w as i,W as y,N as z,l as r,n as t,J as l,t as k,K as j,k as f,L as q,F as Y,z as v,C,q as ce,p as F,X as G}from"./vendor-54d6cb1e.js";import{L as ue}from"./main-b839be26.js";import{P as fe}from"./page-header-ff719701.js";import{P as me}from"./Pagination-b5e3d5c9.js";import{s as pe}from"./search-06463c60.js";import{s as _e}from"./searchbar-3bdb3315.js";import{u as ge,l as ve}from"./footer-7e4f68d9.js";import{_ as he}from"./search-file-ab3e1046.js";import"./app-cb082573.js";const be={data(){return{rightOffcanvas:!1}},components:{Layout:ue,PageHeader:fe,Head:te,Pagination:me,Multiselect:oe,flatPickr:se,Link:ae,search:pe,searchbar:_e},props:{successMessage:String,alertMessage:String,users:Array,promoCodes:{type:Object,required:!0}},setup(o){const{t:e}=le(),w=m(""),{selectedLocation:a}=ge(),B=ne({status:null,transport_type:null,service_location_id:"all",limit:10}),h=m([]),P=m({}),M=m(!1),_=m(!1),p=m(null),T=m(o.users),x=m({}),V=m(o.successMessage||""),$=m(o.alertMessage||""),A=()=>{V.value="",$.value=""},N=async(n,c)=>{y.fire({title:e("are_you_sure"),text:e("you_are_about_to_change_status"),icon:"warning",showCancelButton:!0,confirmButtonColor:"#34c38f",cancelButtonColor:"#f46a6a",confirmButtonText:e("yes"),cancelButtonText:e("cancel")}).then(async g=>{if(g.isConfirmed)try{await I.post("/promo-code/update-status",{id:n,status:c});const R=h.value.findIndex(Q=>Q.id===n);R!==-1&&(h.value[R].active=c),y.fire(e("changed"),e("status_updated_successfully"),"success")}catch(R){console.error(e("error_updating_status"),R),y.fire(e("error"),e("failed_to_update_status"),"error")}})},U=n=>n.charAt(0).toUpperCase()+n.slice(1),S=m(!1),E=()=>{b(),_.value=!0,S.value=!1},L=()=>{B.reset(),b(),S.value=!1},s=()=>{M.value=!1},H=async n=>{try{await I.delete(`/promo-code/delete/${n}`);const c=h.value.findIndex(g=>g.id===n);c!==-1&&h.value.splice(c,1),M.value=!1,y.fire(e("success"),e("promo_code_deleted_successfully"),"success")}catch{y.fire(e("error"),e("failed_to_delete_promo_code"),"error")}},O=async n=>{y.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#34c38f",cancelButtonColor:"#f46a6a",confirmButtonText:"Yes, delete it!"}).then(async c=>{if(c.isConfirmed)try{await H(n)}catch(g){console.error(e("error_deleting_data"),g),y.fire(e("error"),e("failed_to_delete_the_data"),"error")}})};W(w,ie.debounce(function(n){b(w.value)},300));const b=async(n=1)=>{try{const c=B.data();c.search=w.value,c.page=n;const g=await I.get("/promo-code/list",{params:c});h.value=g.data.results,P.value=g.data.paginator,Z(P.value.total),_.value=!1}catch(c){console.error(e("error_fetching_promo_codes"),c)}},J=async n=>{localStorage.setItem("promo-code/list",n),b(n)},K=async n=>{z.get(`/promo-code/edit/${n.id}`)},X=async n=>{z.get(`/promo-code/history/${n.id}`)},Z=()=>{x.value=[10,25,50,100,200,500]};return W(a,n=>{B.service_location_id=n,b()}),{results:h,users:T,modalShow:M,deleteItemId:p,successMessage:V,alertMessage:$,filterData:E,deleteModal:O,closeModal:s,deleteData:H,dismissMessage:A,searchTerm:w,paginator:P,modalFilter:_,clearFilter:L,fetchDatas:b,filter:B,handlePageChanged:J,editData:K,viewHistory:X,capitalizeFirstLetter:U,toggleActiveStatus:N,rightOffcanvas:S,paginatorOption:x,changeEntriesPerPage:()=>{b()},selectedLocation:a}},computed:{...ve,...re(["permissions"])},mounted(){this.filter.service_location_id=this.selectedLocation,console.log("this.filter.service_location_id",this.filter.service_location_id),this.fetchDatas();const o=localStorage.getItem("promo-code/list");o?this.handlePageChanged(Number(o)):this.handlePageChanged(1)}},ye={class:"d-flex align-items-center mt-3"},ke={class:"me-2 text-muted"},Ce=["value"],we={class:"ms-2 text-muted"},Be={class:"d-flex align-items-center gap-2"},Pe={class:"table-responsive"},Me={class:"table align-middle position-relative table-nowrap"},xe={class:"table-active"},Se={scope:"col"},Le={scope:"col"},Oe={scope:"col"},De={scope:"col"},Ve={scope:"col"},$e={key:0},He={class:"d-flex"},Re={class:"flex-grow-1"},Fe={key:0},Te={key:1},Ae={key:2},Ne={class:"d-flex"},Ue={class:"flex-grow-1"},Ee={key:0},Ie=["onClick","id","checked"],We={key:1},ze={colspan:"12",class:"text-center"},je={key:0,class:"custom-alert alert alert-success alert-border-left fade show",data:"alert",id:"alertMsg"},qe={class:"alert-content"},Ye={key:1,class:"custom-alert alert alert-danger alert-border-left fade show",data:"alert",id:"alertMsg"},Ge={class:"alert-content"},Je={class:"offcanvas-body"},Ke={class:"mb-4"},Xe={for:"datepicker-range",class:"form-label text-muted text-uppercase fw-semibold mb-3"},Ze={class:"form-check form-check-inline"},Qe={class:"form-check-label",for:"WithoutinlineRadio2"},et={class:"form-check form-check-inline"},tt={class:"form-check-label",for:"WithoutinlineRadio3"},ot={class:"mb-4"},st={for:"datepicker-range",class:"form-label text-muted text-uppercase fw-semibold mb-3"},at={value:"taxi"},lt={value:"delivery"},nt={value:"both"},it={class:"offcanvas-footer border-top p-3 text-center hstack gap-2"};function rt(o,e,w,a,B,h){const P=u("Head"),M=u("PageHeader"),_=u("BCol"),p=u("BButton"),T=u("Link"),x=u("BRow"),V=u("BCardHeader"),$=u("BCardBody"),A=u("BCard"),N=u("BFrom"),U=u("BOffcanvas"),S=u("Pagination"),E=u("Layout"),L=de("b-tooltip");return d(),D(E,null,{default:i(()=>[r(P,{title:"Promo Code"}),r(M,{title:o.$t("promo_code"),pageTitle:o.$t("promo_code")},null,8,["title","pageTitle"]),r(x,null,{default:i(()=>[r(_,{lg:"12"},{default:i(()=>[r(A,{"no-body":"",id:"tasksList"},{default:i(()=>[r(V,{class:"border-0"},{default:i(()=>[r(x,{class:"g-2"},{default:i(()=>[r(_,{md:"3"},{default:i(()=>[t("div",ye,[t("label",ke,l(o.$t("show")),1),k(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>a.filter.limit=s),onChange:e[1]||(e[1]=(...s)=>a.changeEntriesPerPage&&a.changeEntriesPerPage(...s)),class:"form-select form-select-sm w-auto"},[(d(!0),f(Y,null,q(a.paginatorOption,s=>(d(),f("option",{key:s,value:s},l(s),9,Ce))),128))],544),[[j,a.filter.limit]]),t("label",we,l(o.$t("entries")),1)])]),_:1}),r(_,{md:"3"}),r(_,{md:"auto",class:"ms-auto"},{default:i(()=>[t("div",Be,[r(p,{variant:"danger",onClick:e[2]||(e[2]=s=>a.rightOffcanvas=!0)},{default:i(()=>[e[10]||(e[10]=t("i",{class:"ri-filter-2-line me-1 align-bottom"},null,-1)),v(" "+l(o.$t("filters")),1)]),_:1}),o.permissions.includes("add-promo")?(d(),D(T,{key:0,href:"/promo-code/create"},{default:i(()=>[r(p,{variant:"primary",class:"float-end"},{default:i(()=>[e[11]||(e[11]=t("i",{class:"ri-add-line align-bottom me-1"},null,-1)),v(" "+l(o.$t("add_promo_code")),1)]),_:1})]),_:1})):C("",!0)])]),_:1})]),_:1})]),_:1}),r($,{class:"border border-dashed border-end-0 border-start-0"},{default:i(()=>[t("div",Pe,[t("table",Me,[t("thead",xe,[t("tr",null,[t("th",Se,l(o.$t("code")),1),t("th",Le,l(o.$t("transport_type")),1),t("th",Oe,l(o.$t("from_to_date")),1),t("th",De,l(o.$t("status")),1),t("th",Ve,l(o.$t("action")),1)])]),a.results.length>0?(d(),f("tbody",$e,[(d(!0),f(Y,null,q(a.results,(s,H)=>(d(),f("tr",{key:H},[t("td",null,[t("div",He,[t("div",Re,l(s.code),1)])]),t("td",null,[s.transport_type==="taxi"?(d(),f("span",Fe,l(o.$t("taxi")),1)):s.transport_type==="delivery"?(d(),f("span",Te,l(o.$t("delivery")),1)):(d(),f("span",Ae,l(o.$t("all")),1))]),t("td",null,[t("div",Ne,[t("div",Ue,l(s.from_date+` ${o.$t("to")} `+s.to_date),1)])]),o.permissions.includes("toggle-promo")?(d(),f("td",Ee,[t("div",{class:ce({"form-check":!0,"form-switch":!0,"form-switch-lg":!0,"form-switch-success":s.active})},[t("input",{class:"form-check-input",type:"checkbox",role:"switch",onClick:F(O=>a.toggleActiveStatus(s.id,!s.active),["prevent"]),id:"status_"+s.id,checked:s.active},null,8,Ie)],2)])):C("",!0),t("td",null,[o.permissions.includes("edit-promo")?k((d(),D(p,{key:0,onClick:F(O=>a.viewHistory(s),["prevent"]),class:"btn btn-soft-info btn-sm m-2","data-bs-toggle":"tooltip",title:o.$t("view")},{default:i(()=>[...e[12]||(e[12]=[t("i",{class:"bx bxs-show bx-xs"},null,-1)])]),_:1},8,["onClick","title"])),[[L,void 0,void 0,{hover:!0}]]):C("",!0),o.permissions.includes("edit-promo")?k((d(),D(p,{key:1,onClick:F(O=>a.editData(s),["prevent"]),class:"btn btn-soft-warning btn-sm m-2","data-bs-toggle":"tooltip",title:o.$t("edit")},{default:i(()=>[...e[13]||(e[13]=[t("i",{class:"bx bxs-edit-alt bx-xs"},null,-1)])]),_:1},8,["onClick","title"])),[[L,void 0,void 0,{hover:!0}]]):C("",!0),o.permissions.includes("delete-promo")?k((d(),D(p,{key:2,class:"btn btn-soft-danger btn-sm m-2",size:"sm",type:"button",onClick:F(O=>a.deleteModal(s.id),["prevent"]),"data-bs-toggle":"tooltip",title:o.$t("delete")},{default:i(()=>[...e[14]||(e[14]=[t("i",{class:"bx bx-trash bx-xs"},null,-1)])]),_:1},8,["onClick","title"])),[[L,void 0,void 0,{hover:!0}]]):C("",!0)])]))),128))])):(d(),f("tbody",We,[t("tr",null,[t("td",ze,[e[15]||(e[15]=t("img",{src:he,alt:"Loading...",style:{width:"100px"}},null,-1)),t("h5",null,l(o.$t("no_data_found")),1)])])]))])])]),_:1})]),_:1})]),_:1})]),_:1}),t("div",null,[a.successMessage?(d(),f("div",je,[t("div",qe,[e[16]||(e[16]=t("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),e[17]||(e[17]=v()),e[18]||(e[18]=t("strong",null,"Success",-1)),v(" - "+l(a.successMessage)+" ",1),t("button",{type:"button",class:"btn-close btn-close-success",onClick:e[3]||(e[3]=(...s)=>a.dismissMessage&&a.dismissMessage(...s)),"aria-label":"Close Success Message"})])])):C("",!0),a.alertMessage?(d(),f("div",Ye,[t("div",Ge,[e[19]||(e[19]=t("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),e[20]||(e[20]=v()),e[21]||(e[21]=t("strong",null,"Alert",-1)),v(" - "+l(a.alertMessage)+" ",1),t("button",{type:"button",class:"btn-close btn-close-danger",onClick:e[4]||(e[4]=(...s)=>a.dismissMessage&&a.dismissMessage(...s)),"aria-label":"Close Alert Message"})])])):C("",!0)]),r(U,{modelValue:a.rightOffcanvas,"onUpdate:modelValue":e[9]||(e[9]=s=>a.rightOffcanvas=s),placement:"end",title:o.$t("promo_filters"),"header-class":"bg-light","body-class":"p-0 overflow-hidden","footer-class":"border-top p-3 text-center"},{default:i(()=>[r(N,{action:"",class:"d-flex flex-column justify-content-end h-100"},{default:i(()=>[t("div",Je,[t("div",Ke,[t("label",Xe,l(o.$t("status")),1),t("div",null,[t("div",Ze,[k(t("input",{class:"form-check-input",type:"radio",name:"inlineRadioOptions",id:"WithoutinlineRadio2",value:"1","onUpdate:modelValue":e[5]||(e[5]=s=>a.filter.status=s)},null,512),[[G,a.filter.status]]),t("label",Qe,l(o.$t("active")),1)]),t("div",et,[k(t("input",{class:"form-check-input",type:"radio",name:"inlineRadioOptions",id:"WithoutinlineRadio3",value:"0","onUpdate:modelValue":e[6]||(e[6]=s=>a.filter.status=s)},null,512),[[G,a.filter.status]]),t("label",tt,l(o.$t("inactive")),1)])])]),t("div",ot,[t("label",st,l(o.$t("transport_type")),1),k(t("select",{class:"form-control","data-choices":"","data-choices-search-false":"",name:"choices-select-status",id:"choices-select-status","onUpdate:modelValue":e[7]||(e[7]=s=>a.filter.transport_type=s)},[t("option",at,l(o.$t("taxi")),1),t("option",lt,l(o.$t("delivery")),1),t("option",nt,l(o.$t("both")),1)],512),[[j,a.filter.transport_type]])])]),t("div",it,[r(p,{variant:"light",onClick:e[8]||(e[8]=s=>a.clearFilter()),class:"w-100"},{default:i(()=>[v(l(o.$t("clear_filter")),1)]),_:1}),r(p,{type:"submit",onClick:a.filterData,variant:"success",class:"w-100"},{default:i(()=>[v(l(o.$t("apply")),1)]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["modelValue","title"]),r(S,{paginator:a.paginator,onPageChanged:a.handlePageChanged},null,8,["paginator","onPageChanged"])]),_:1})}const bt=ee(be,[["render",rt]]);export{bt as default};
