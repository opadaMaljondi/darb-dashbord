import{_ as Y,af as $,ag as V,ah as ee,ai as oe,r,R as b,g as B,i as d,k as S,l as ne,w as Z,y as w,C,F as N,L as q}from"./vendor-8caf5d52.js";const te={name:"googleMap",components:{GoogleMap:$,Polyline:V,AdvancedMarker:ee,InfoWindow:oe},data(){return{geocoder:null}},props:{pick_location:Object,default_location:Object,drop_location:Object,polyline:String,map_key:String,baseUrl:String,current_location:Object,libraries:Array,driver:Object,stops:{type:Array,default:[]},nearbyDrivers:{type:Object,default:{}},draggable:{type:Boolean,default:!1}},setup(t,{emit:f}){const u=r(null),i=r(t.default_location),_=r(t.pick_location),p=r(t.drop_location),v=r(t.stops),M=r(t.nearbyDrivers),a=r(t.driver),O=r(null),I=r([]),s=r(null),m=r(null),y=r([]),h=r(null),G=r(t.polyline),P=r([]),U=r(null),j=r(null),z=o=>{var l;const e=window.google.maps,n=new e.LatLng(o.lat,o.lng),g=o.type_icon;if(U.value)T(U.value,j.value,n),j.value=n;else{const c=document.createElement("img");c.src=t.baseUrl+`/image/map/${g}.png`,c.style.width="30px",c.style.height="30px",U.value={marker:new e.marker.AdvancedMarkerElement({position:n,content:c,map:(l=u.value)==null?void 0:l.map}),icon:c},j.value=n}};function K(o,e,n,g){const l=L=>L*Math.PI/180,c=L=>L*180/Math.PI,k=l(g-e),D=Math.sin(k)*Math.cos(l(n)),E=Math.cos(l(o))*Math.sin(l(n))-Math.sin(l(o))*Math.cos(l(n))*Math.cos(k),A=Math.atan2(D,E);return(c(A)+360)%360}const T=(o,e,n)=>{const g=o.marker,l=o.icon,c=60;let k=0;const D=e.lat(),E=e.lng(),A=n.lat(),L=n.lng(),R=()=>{k++;const W=k/c,J=D+(A-D)*W,Q=E+(L-E)*W;g.position=new google.maps.LatLng(J,Q);const X=K(D,E,A,L);l.style.transform=`rotate(${X}deg)`,k<c&&requestAnimationFrame(R)};R()},x=async()=>{if(!window.google||!window.google.maps||!window.google.maps.LatLng){console.warn("Google Maps API not yet loaded");return}const o=window.google.maps;if(y.value=[],I.value=[],P.value=[],h.value=new o.LatLngBounds,_.value&&p.value&&(h.value=new o.LatLngBounds),_.value){const e=document.createElement("img");e.src=t.baseUrl+"/image/map/pickup.png",e.style.width="30px",e.style.height="30px";const n=t.pick_location;s.value={content:e,position:n,gmpDraggable:t.draggable},_.value&&h.value.extend(n)}else s.value=null;if(console.log("drop_location.value",p.value),p.value){const e=document.createElement("img");e.src=t.baseUrl+"/image/map/drop.png",e.style.width="30px",e.style.height="30px";const n=p.value;p.value&&h.value.extend(n),m.value={content:e,position:n,gmpDraggable:t.draggable}}else m.value=null;if(v.value&&v.value.forEach((e,n)=>{const g=document.createElement("img");g.src=t.baseUrl+"/image/map/"+n+".png",g.style.width="30px",g.style.height="30px";const l={position:{lat:e.lat,lng:e.lng},content:g,gmpDraggable:t.draggable};e.lat&&e.lng&&h.value.extend({lat:e.lat,lng:e.lng}),y.value.push({options:l})}),G.value){const e=new o.geometry.encoding.decodePath(G.value);P.value=e.map(n=>({lat:n.lat(),lng:n.lng()})),_.value&&p.value&&P.value.forEach(n=>h.value.extend(n))}if(M.value&&Object.keys(M.value).length>0&&Object.values(M.value).forEach(e=>{const n=document.createElement("img");n.src=t.baseUrl+`/image/map/${e.type_icon}.png`,n.style.width="30px",n.style.height="30px",e.rotation!==void 0&&(n.style.transform=`rotate(${e.rotation}deg)`);const g={position:{lat:e.lat,lng:e.lng},content:n};let l="";e.name&&(l=`<div><strong>${e.name}</strong><br>Mobile: ${e.mobile}</div>`),I.value.push({options:g,showInfo:!1,info:l})}),a.value){const e=document.createElement("img");e.src=t.baseUrl+`/image/map/${a.value.type_icon}.png`,e.style.width="30px",e.style.height="30px",a.value.rotation!==void 0&&(e.style.transform=`rotate(${a.value.rotation}deg)`);const n={position:{lat:a.value.lat,lng:a.value.lng},content:e};a.value.lat&&h.value.extend({lat:a.value.lat,lng:a.value.lng}),O.value={options:n,showInfo:!1}}(_.value||p.value)&&u.value.map&&u.value.map.fitBounds(h.value)};b(()=>{var o;return(o=u.value)==null?void 0:o.ready},async o=>{o&&await x()}),b(()=>t.pick_location,o=>{_.value=o,x()}),b(()=>t.drop_location,o=>{p.value=o,x()}),b(()=>t.stops,o=>{v.value=o,x()}),b(()=>t.nearbyDrivers,o=>{M.value=o,x()},{deep:!0}),b(()=>t.driver,async o=>{if(!(!window.google||!window.google.maps||!window.google.maps.LatLng)){if(!O.value&&a.value){const e=document.createElement("img");e.src=t.baseUrl+`/image/map/${a.value.type_icon}.png`,e.style.width="30px",e.style.height="30px",a.value.rotation!==void 0&&(e.style.transform=`rotate(${a.value.rotation}deg)`);const n={position:{lat:a.value.lat,lng:a.value.lng},content:e};O.value={options:n,showInfo:!1}}t.pick_location?o&&a.value&&o.id==a.value.id?(a.value=o,z(o),u.value.map.setCenter({lat:o.lat,lng:o.lng}),u.value.map.setZoom(15)):o&&o.lat&&(a.value=o,u.value.map.setCenter({lat:o.lat,lng:o.lng}),u.value.map.setZoom(15)):o?(a.value=o,u.value.map.setCenter({lat:o.lat,lng:o.lng}),u.value.map.setZoom(15)):(u.value.map.setCenter(i.value),u.value.map.setZoom(15))}}),b(()=>t.polyline,()=>{G.value=t.polyline,x()});const H=(o,e,n=null)=>{const g=o.latLng.lat(),l=o.latLng.lng(),c={lat:g,lng:l};F(c,e,n),e=="pickup"?s.value.position=c:e=="drop"?m.value.position=c:y.value[n].position=c},F=(o,e,n=null)=>{new google.maps.Geocoder().geocode({location:o},(l,c)=>{if(c==="OK"&&l[0]){const k=l[0].formatted_address;f("update-pickup-address",k,e,o,n)}})};return{default_location:i,pickOption:s,dropOption:m,stopOptions:y,pathCoordinates:P,currentdriverOption:O,driverOptions:I,handleDragEnd:H,reverseGeocode:F,mapRef:u}}},ae={class:"map-container"};function le(t,f,u,i,_,p){const v=B("AdvancedMarker"),M=B("InfoWindow"),a=B("Polyline"),O=B("GoogleMap",!0);return d(),S("div",ae,[ne(O,{ref:"mapRef","api-key":u.map_key,mapId:"DEMO_MAP_ID",style:{width:"100%",height:"100%"},center:i.default_location,zoom:12,libraries:u.libraries},{default:Z(()=>{var I;return[i.pickOption?(d(),w(v,{key:0,options:i.pickOption,onDragend:f[0]||(f[0]=s=>i.handleDragEnd(s,"pickup"))},null,8,["options"])):C("",!0),i.dropOption?(d(),w(v,{key:1,options:i.dropOption,onDragend:f[1]||(f[1]=s=>i.handleDragEnd(s,"drop"))},null,8,["options"])):C("",!0),(I=i.currentdriverOption)!=null&&I.option?(d(),w(v,{key:2,options:i.currentdriverOption.option,onClick:f[2]||(f[2]=s=>i.currentdriverOption.showInfo=!i.currentdriverOption.showInfo)},null,8,["options"])):C("",!0),(d(!0),S(N,null,q(i.stopOptions,(s,m)=>(d(),w(v,{key:m,options:s.options,onDragend:y=>i.handleDragEnd(y,"stop",m)},null,8,["options","onDragend"]))),128)),(d(!0),S(N,null,q(i.driverOptions,(s,m)=>(d(),w(v,{key:"drv"+m,options:s.options,onClick:y=>s.showInfo=!s.showInfo},{default:Z(()=>[s.info.length?(d(),w(M,{key:0,options:{content:s.info},open:s.showInfo,onCloseclick:y=>s.showInfo=!1},null,8,["options","open","onCloseclick"])):C("",!0)]),_:2},1032,["options","onClick"]))),128)),i.pathCoordinates.length?(d(),w(a,{key:3,options:{path:i.pathCoordinates,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:4}},null,8,["options"])):C("",!0)]}),_:1},8,["api-key","center","libraries"])])}const se=Y(te,[["render",le]]);export{se as g};
