import{_ as W,Z as Y,O as $,P as J,B as K,D as X,r as p,T as Z,R as G,o as Q,g as d,i as _,y as R,w as c,a as ee,W as L,N as te,l as n,n as e,J as i,k as v,F as se,L as le,q as j,z as m,p as I,C as O,t as b,X as y,K as oe}from"./vendor-8caf5d52.js";import{L as ie}from"./main-cc7bd0ce.js";import{P as ae}from"./page-header-18309276.js";import{P as ne}from"./Pagination-0518e4bd.js";import{s as re}from"./search-769502e2.js";import{s as de}from"./searchbar-e42e22fa.js";import{u as ce}from"./footer-502c2797.js";import{_ as _e}from"./search-file-ab3e1046.js";import"./app-974c65a1.js";const fe={data(){return{rightOffcanvas:!1}},components:{Layout:ie,PageHeader:ae,Head:Y,Pagination:ne,Multiselect:$,flatPickr:J,Link:K,search:re,searchbar:de},props:{successMessage:String,alertMessage:String,zones:Object,firebaseConfig:Object,ongoing_rides:Object,types:Object},setup(o){const{t:s}=X(),A=p(""),l=Z({transport_type:"all",ride_status:"all",is_bid_ride:null,zone_id:null,service_location_id:"all",vehicle_type_id:null,is_paid:null}),w=p(o.zones),H=p(o.types),r=p(o.ongoing_rides),C=p(!1),k=p(!1),V=p(null),x=p(o.successMessage||""),B=p(o.alertMessage||""),{selectedLocation:M}=ce(),S=p([]),T=()=>{x.value="",B.value=""},z=()=>{k.value=!0},D=()=>{l.reset(),k.value=!1};G(M,a=>{a!="all"&&(l.service_location_id=a,S.value=w.value.filter(h=>h.service_location_id==l.service_location_id)),fetchDatas()}),Q(async()=>{try{const a=o.firebaseConfig;firebase.apps.length||firebase.initializeApp(a);const h=firebase.database();r.value.forEach(g=>{h.ref(`requests/${g.id}`).on("value",function(E){const u=r.value.findIndex(f=>f.id===g);if(u!==-1){const f=E.val();f.accept!==1&&(r.value[u].driver_id=null),f.driver_id&&(r.value[u].driver_id=f.driver_id),f.hasOwnProperty("modified_by_driver")&&(r.value[u].is_driver_started=1),f.trip_arrived==1&&(r.value[u].is_driver_arrived=!0),f.trip_start==1&&(r.value[u].is_trip_start=!0),f.is_completed&&(r.value[u].is_completed=!0,setTimeout(()=>{r.value.splice(u,1)},2e3)),(f.is_cancelled||f.is_cancel)&&(r.value[u].is_cancelled=!0,setTimeout(()=>{r.value.splice(u,1)},2e3))}})}),M!="all"&&(l.service_location_id=M,S.value=w.value.filter(g=>g.service_location_id==l.service_location_id)),fetchDatas()}catch(a){console.error(s("error_initializing_firebase_or_fetching_settings"),a)}});const P=()=>{C.value=!1},U=async a=>{try{const h=await ee.get(`/rides-request/cancel/${a}`),g=r.value.findIndex(N=>N.id===a);g!==-1&&(r.value[g]=h.data.request),C.value=!1,L.fire(s("success"),s("trip_cancelled_successfully"),"success")}catch(h){console.log(h),L.fire(s("error"),s("failed_to_cancel_trip"),"error")}};return{results:r,modalShow:C,deleteItemId:V,successMessage:x,alertMessage:B,filterData:z,deleteModal:async a=>{L.fire({title:"Are you sure?",text:"You want to be cancel this ride!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#34c38f",cancelButtonColor:"#f46a6a",confirmButtonText:"Yes, Cancel!",cancelButtonText:"Close"}).then(async h=>{if(h.isConfirmed)try{await U(a)}catch(g){console.error(s("error_deleting_data"),g),L.fire(s("error"),s("failed_to_cancel_the_data"),"error")}})},closeModal:P,deleteData:U,dismissMessage:T,searchTerm:A,modalFilter:k,clearFilter:D,filter:l,zoneList:S,types:H,rideStatus:a=>a.is_cancelled?"Cancelled":a.is_completed?"Completed":a.is_trip_start?"On Trip":a.is_driver_arrived?"Driver Arrived":a.is_later&&a.is_driver_started?"Driver Started":a.is_driver_started?"Accepted":a.is_later?"Upcoming":"Searching",editData:async a=>{te.get(`/rides-request/view/${a.id}`)}}}},me={class:"table-responsive"},ue={class:"table align-middle position-relative table-nowrap"},pe={class:"table-active"},ve={scope:"col"},be={scope:"col"},he={scope:"col"},ge={scope:"col"},ye={scope:"col"},ke={scope:"col"},we={scope:"col"},Ce={scope:"col"},Be={key:0},Me={key:0},Se={key:1},Ve={key:2},xe={class:"dropdown"},ze={class:"dropdown-menu dropdown-menu-end"},De=["onClick"],Ue=["onClick"],Le={key:1},Oe={colspan:"10",class:"text-center"},Te={key:0,class:"custom-alert alert alert-success alert-border-left fade show",data:"alert",id:"alertMsg"},Pe={class:"alert-content"},Ae={key:1,class:"custom-alert alert alert-danger alert-border-left fade show",data:"alert",id:"alertMsg"},He={class:"alert-content"},qe={class:"offcanvas-body"},Fe={class:"mb-4"},Ne={for:"datepicker-range",class:"form-label text-muted text-uppercase fw-semibold mb-3"},Re={class:"form-check form-check-inline"},je={class:"form-check-label",for:"all"},Ie={class:"form-check form-check-inline"},Ee={class:"form-check-label",for:"completed"},We={class:"form-check form-check-inline"},Ye={class:"form-check-label",for:"cancelled"},$e={class:"form-check form-check-inline"},Je={class:"form-check-label",for:"upcoming"},Ke={class:"form-check form-check-inline"},Xe={class:"form-check-label",for:"ontrip"},Ze={class:"mb-4"},Ge={for:"datepicker-range",class:"form-label text-muted text-uppercase fw-semibold mb-3"},Qe={value:"all"},et={value:"taxi"},tt={value:"delivery"},st={class:"mb-4"},lt={for:"zone-select",class:"form-label text-muted text-uppercase fw-semibold mb-3"},ot={class:"mb-4"},it={for:"vehicle_type",class:"form-label text-muted text-uppercase fw-semibold mb-3"},at={class:"mb-4"},nt={for:"payment-status-select",class:"form-label text-muted text-uppercase fw-semibold mb-3"},rt={class:"form-check form-check-inline"},dt={class:"form-check-label",for:"not_paid"},ct={class:"form-check form-check-inline"},_t={class:"form-check-label",for:"paid"},ft={class:"mb-4"},mt={for:"dispatch-type-select",class:"form-label text-muted text-uppercase fw-semibold mb-3"},ut={class:"form-check form-check-inline"},pt={class:"form-check-label",for:"normal"},vt={class:"form-check form-check-inline"},bt={class:"form-check-label",for:"bidding"},ht={class:"offcanvas-footer border-top p-3 text-center hstack gap-2"};function gt(o,s,A,l,w,H){const r=d("Head"),C=d("PageHeader"),k=d("BCol"),V=d("BRow"),x=d("BCardHeader"),B=d("BBadge"),M=d("Link"),S=d("BCardBody"),T=d("BCard"),z=d("Multiselect"),D=d("BButton"),P=d("BFrom"),U=d("BOffcanvas"),q=d("Layout");return _(),R(q,null,{default:c(()=>[n(r,{title:o.$t("ongoing-rides")},null,8,["title"]),n(C,{title:o.$t("ongoing-rides"),pageTitle:o.$t("ongoing-rides")},null,8,["title","pageTitle"]),n(V,null,{default:c(()=>[n(k,{lg:"12"},{default:c(()=>[n(T,{"no-body":"",id:"tasksList"},{default:c(()=>[n(x,{class:"border-0"},{default:c(()=>[n(V,{class:"g-2"},{default:c(()=>[n(k,{md:"3"})]),_:1})]),_:1}),n(S,{class:"border border-dashed border-end-0 border-start-0"},{default:c(()=>[e("div",me,[e("table",ue,[e("thead",pe,[e("tr",null,[e("th",ve,i(o.$t("request_id")),1),e("th",be,i(o.$t("date")),1),e("th",he,i(o.$t("user_name")),1),e("th",ge,i(o.$t("driver_name")),1),e("th",ye,i(o.$t("transport_type")),1),e("th",ke,i(o.$t("trip_status")),1),e("th",we,i(o.$t("payment_option")),1),e("th",Ce,i(o.$t("action")),1)])]),l.results.length>0?(_(),v("tbody",Be,[(_(!0),v(se,null,le(l.results,(t,F)=>(_(),v("tr",{key:F},[e("td",null,i(t.request_number),1),e("td",null,i(t.is_later?t.converted_trip_start_time:t.converted_created_at),1),e("td",null,i(t.user_detail?t.user_detail.name:"----"),1),e("td",null,i(t.driver_detail?t.driver_detail.name:"----"),1),e("td",null,[t.transport_type==="taxi"?(_(),v("span",Me,i(o.$t("taxi"))+" "+i(t.is_bid_ride?o.$t("bidding"):"")+" - "+i(t.vehicle_type_name),1)):t.transport_type==="delivery"?(_(),v("span",Se,i(o.$t("delivery"))+" "+i(t.is_bid_ride?o.$t("bidding"):"")+" - "+i(t.vehicle_type_name),1)):(_(),v("span",Ve,i(o.$t("all")),1))]),e("td",null,[n(B,{class:j({"text-uppercase":!0,"text-bg-success":l.rideStatus(t)==="Completed"||l.rideStatus(t)==="Accepted"||l.rideStatus(t)==="Driver Started","text-bg-danger":l.rideStatus(t)==="Cancelled","text-bg-info":l.rideStatus(t)==="On Trip","text-bg-warning":l.rideStatus(t)==="Upcoming"||l.rideStatus(t)==="Driver Arrived"||l.rideStatus(t)==="Searching"})},{default:c(()=>[m(i(l.rideStatus(t)),1)]),_:2},1032,["class"])]),e("td",null,[n(B,{class:j({"text-uppercase":!0,"text-bg-success":t.is_paid,"text-bg-danger":!t.is_paid})},{default:c(()=>[m(i(t.payment_opt==1?"Cash":t.payment_opt==2?"Wallet":"Card"),1)]),_:2},1032,["class"])]),e("td",null,[e("div",xe,[s[18]||(s[18]=e("a",{class:"text-reset",href:"#","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},[e("span",{class:"text-muted fs-18"},[e("i",{class:"mdi mdi-dots-vertical"})])],-1)),e("div",ze,[e("div",{class:"dropdown-item",type:"button",onClick:I(a=>l.editData(t),["prevent"])},[s[15]||(s[15]=e("i",{class:"bx bx-show-alt align-center text-muted me-2"},null,-1)),m(" "+i(o.$t("view")),1)],8,De),!t.is_cancelled&&!t.is_completed?(_(),v("div",{key:0,class:"dropdown-item",type:"button",onClick:I(a=>l.deleteModal(t.id),["prevent"])},[s[16]||(s[16]=e("i",{class:"bx bx-show-alt align-center text-muted me-2"},null,-1)),m(" "+i(o.$t("cancel")),1)],8,Ue)):O("",!0),!t.driver_id&&!t.is_cancelled&&!t.is_completed?(_(),R(M,{key:1,class:"dropdown-item",type:"button",href:`ongoing-rides/assign/${t.id}`},{default:c(()=>[s[17]||(s[17]=e("i",{class:"bx bx-show-alt align-center text-muted me-2"},null,-1)),m(" "+i(o.$t("assign")),1)]),_:2,__:[17]},1032,["href"])):O("",!0)])])])]))),128))])):(_(),v("tbody",Le,[e("tr",null,[e("td",Oe,[s[19]||(s[19]=e("img",{src:_e,alt:"Loading...",style:{width:"100px"}},null,-1)),e("h5",null,i(o.$t("no_data_found")),1)])])]))])])]),_:1})]),_:1})]),_:1})]),_:1}),e("div",null,[l.successMessage?(_(),v("div",Te,[e("div",Pe,[s[20]||(s[20]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),s[21]||(s[21]=m()),s[22]||(s[22]=e("strong",null,"Success",-1)),m(" - "+i(l.successMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-success",onClick:s[0]||(s[0]=(...t)=>l.dismissMessage&&l.dismissMessage(...t)),"aria-label":"Close Success Message"})])])):O("",!0),l.alertMessage?(_(),v("div",Ae,[e("div",He,[s[23]||(s[23]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),s[24]||(s[24]=m()),s[25]||(s[25]=e("strong",null,"Alert",-1)),m(" - "+i(l.alertMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-danger",onClick:s[1]||(s[1]=(...t)=>l.dismissMessage&&l.dismissMessage(...t)),"aria-label":"Close Alert Message"})])])):O("",!0)]),n(U,{modelValue:w.rightOffcanvas,"onUpdate:modelValue":s[14]||(s[14]=t=>w.rightOffcanvas=t),placement:"end",title:o.$t("filters"),"header-class":"bg-light","body-class":"p-0 overflow-hidden","footer-class":"border-top p-3 text-center"},{default:c(()=>[n(P,{action:"",class:"d-flex flex-column justify-content-end h-100"},{default:c(()=>[e("div",qe,[e("div",Fe,[e("label",Ne,i(o.$t("status")),1),e("div",null,[e("div",Re,[b(e("input",{class:"form-check-input",type:"radio",name:"ride_status",id:"all",value:"all","onUpdate:modelValue":s[2]||(s[2]=t=>l.filter.ride_status=t)},null,512),[[y,l.filter.ride_status]]),e("label",je,i(o.$t("all")),1)]),e("div",Ie,[b(e("input",{class:"form-check-input",type:"radio",name:"ride_status",id:"completed",value:"completed","onUpdate:modelValue":s[3]||(s[3]=t=>l.filter.ride_status=t)},null,512),[[y,l.filter.ride_status]]),e("label",Ee,i(o.$t("completed")),1)]),e("div",We,[b(e("input",{class:"form-check-input",type:"radio",name:"ride_status",id:"cancelled",value:"cancelled","onUpdate:modelValue":s[4]||(s[4]=t=>l.filter.ride_status=t)},null,512),[[y,l.filter.ride_status]]),e("label",Ye,i(o.$t("cancelled")),1)]),e("div",$e,[b(e("input",{class:"form-check-input",type:"radio",name:"ride_status",id:"upcoming",value:"upcoming","onUpdate:modelValue":s[5]||(s[5]=t=>l.filter.ride_status=t)},null,512),[[y,l.filter.ride_status]]),e("label",Je,i(o.$t("upcoming")),1)]),e("div",Ke,[b(e("input",{class:"form-check-input",type:"radio",name:"ride_status",id:"ontrip",value:"ontrip","onUpdate:modelValue":s[6]||(s[6]=t=>l.filter.ride_status=t)},null,512),[[y,l.filter.ride_status]]),e("label",Xe,i(o.$t("on_trip")),1)])])]),e("div",Ze,[e("label",Ge,i(o.$t("transport_type")),1),b(e("select",{class:"form-control","data-choices":"","data-choices-search-false":"",name:"choices-select-status",id:"choices-select-status","onUpdate:modelValue":s[7]||(s[7]=t=>l.filter.transport_type=t)},[e("option",Qe,i(o.$t("all")),1),e("option",et,i(o.$t("taxi")),1),e("option",tt,i(o.$t("delivery")),1)],512),[[oe,l.filter.transport_type]])]),e("div",st,[e("label",lt,i(o.$t("zone")),1),n(z,{modelValue:l.filter.zone_id,"onUpdate:modelValue":s[8]||(s[8]=t=>l.filter.zone_id=t),id:"zone_id",mode:"tags",options:l.zoneList.map(t=>({value:t.id,label:t.name})),"close-on-select":!1,multiple:!0,searchable:!0,placeholder:o.$t("select_a_zone"),"create-option":!1},null,8,["modelValue","options","placeholder"])]),e("div",ot,[e("label",it,i(o.$t("vehicle_type")),1),n(z,{id:"vehicle_type_id",mode:"tags",modelValue:l.filter.vehicle_type_id,"onUpdate:modelValue":s[9]||(s[9]=t=>l.filter.vehicle_type_id=t),options:l.types.map(t=>({value:t.id,label:t.name})),"close-on-select":!1,searchable:!0,placeholder:o.$t("select_vehicle_type"),"create-option":!1},null,8,["modelValue","options","placeholder"])]),e("div",at,[e("label",nt,i(o.$t("payment_status")),1),e("div",null,[e("div",rt,[b(e("input",{class:"form-check-input",type:"radio",name:"payment_status",id:"not_paid",value:"1","onUpdate:modelValue":s[10]||(s[10]=t=>l.filter.is_paid=t)},null,512),[[y,l.filter.is_paid]]),e("label",dt,i(o.$t("paid")),1)]),e("div",ct,[b(e("input",{class:"form-check-input",type:"radio",name:"payment_status",id:"paid",value:"0","onUpdate:modelValue":s[11]||(s[11]=t=>l.filter.is_paid=t)},null,512),[[y,l.filter.is_paid]]),e("label",_t,i(o.$t("not_paid")),1)])])]),e("div",ft,[e("label",mt,i(o.$t("ride_type")),1),e("div",null,[e("div",ut,[b(e("input",{class:"form-check-input",type:"radio",name:"dispatch-type",id:"normal",value:"0","onUpdate:modelValue":s[12]||(s[12]=t=>l.filter.is_bid_ride=t)},null,512),[[y,l.filter.is_bid_ride]]),e("label",pt,i(o.$t("regural")),1)]),e("div",vt,[b(e("input",{class:"form-check-input",type:"radio",name:"dispatch-type",id:"bidding",value:"1","onUpdate:modelValue":s[13]||(s[13]=t=>l.filter.is_bid_ride=t)},null,512),[[y,l.filter.is_bid_ride]]),e("label",bt,i(o.$t("bidding")),1)])])]),s[26]||(s[26]=e("div",null,null,-1))]),e("div",ht,[n(D,{variant:"light",onClick:l.clearFilter,class:"w-100"},{default:c(()=>[m(i(o.$t("clear_filter")),1)]),_:1},8,["onClick"]),n(D,{type:"submit",onClick:l.filterData,variant:"success",class:"w-100"},{default:c(()=>[m(i(o.$t("apply")),1)]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["modelValue","title"])]),_:1})}const zt=W(fe,[["render",gt]]);export{zt as default};
