import{_ as se,Z as ae,D as ne,r as f,T as ie,o as U,g as L,i as r,y as D,w as z,a as N,N as E,l as x,n as e,p as j,J as l,t as g,K as G,k as d,L as F,F as q,C as c,q as le,M as h,z as y}from"./vendor-54d6cb1e.js";import{L as re}from"./main-b839be26.js";import{P as de}from"./page-header-ff719701.js";import{u as ce}from"./footer-7e4f68d9.js";import"./app-cb082573.js";const _e={components:{Layout:re,PageHeader:de,Head:ae},props:{googleMapKey:String,successMessage:String,default_lat:String,default_lng:String,alertMessage:String,existingZones:Array,enable_maximum_distance_feature:Boolean,settings:Object},setup(n){var I;const{t:o}=ne(),{languages:O,fetchData:t}=ce(),B=f("English"),k=f(((I=n.settings)==null?void 0:I.enable_peak_zone_feature)==1),i=ie({service_location_id:"",languageFields:{},unit:"",maximum_outstation_distance:n.enable_maximum_distance_feature?"":0,maximum_distance:n.enable_maximum_distance_feature?"":0,peak_zone_ride_count:k.value?"":0,peak_zone_radius:k.value?"":0,peak_zone_history_duration:k.value?"":0,peak_zone_duration:k.value?"":0,distance_price_percentage:k.value?"":0}),P=f(n.successMessage||""),v=f(n.alertMessage||""),T=f([]),b=f(""),M=f([]),s=f(null);let m=[];const S=f(null),C=f(null),K=()=>{b.value.length<3?M.value=[]:setTimeout(()=>{Z(b.value)},300)},Z=a=>{const _="https://places.googleapis.com/v1/places:autocomplete",u={"Content-Type":"application/json","X-Goog-Api-Key":n.googleMapKey,"X-Goog-FieldMask":"suggestions.placePrediction.placeId,suggestions.placePrediction.place,suggestions.placePrediction.text"};fetch(_,{method:"POST",headers:u,body:JSON.stringify({input:a})}).then(p=>p.json()).then(p=>{p.suggestions&&p.suggestions.length>0&&(M.value=p.suggestions.filter(w=>w.placePrediction).map(w=>({placeId:w.placePrediction.placeId,formattedAddress:w.placePrediction.text.text})))}).catch(p=>{console.error("Error fetching autocomplete results:",p)})},H=a=>{const _={"X-Goog-Api-Key":n.googleMapKey,"X-Goog-FieldMask":"viewport,location"};fetch(`https://places.googleapis.com/v1/places/${a.placeId}?fields=viewport,location`,{headers:_}).then(u=>u.json()).then(u=>{b.value="",M.value=[];const V=new window.google.maps.LatLng(u.location.latitude,u.location.longitude);if(s.value.setCenter(V),u.viewport&&u.viewport.high&&u.viewport.low){const p=new window.google.maps.LatLngBounds(new window.google.maps.LatLng(u.viewport.low.latitude,u.viewport.low.longitude),new window.google.maps.LatLng(u.viewport.high.latitude,u.viewport.high.longitude));s.value.fitBounds(p)}else s.value.setZoom(15)}).catch(u=>{console.error("Error fetching place details:",u)})},R=async()=>{try{const a=await N.get("list");T.value=a.data.results}catch(a){console.error("Error fetching service locations:",a)}},X=a=>{window.google.maps.event.addListener(a,"click",()=>{C.value!==a&&(m.forEach(_=>{_.setOptions({fillColor:"#0000FF",editable:!1})}),a.setOptions({fillColor:"#00FF00",editable:!0}),C.value=a)})},Y=()=>{S.value=new window.google.maps.drawing.DrawingManager({drawingMode:window.google.maps.drawing.OverlayType.POLYGON,drawingControl:!1,drawingControlOptions:{position:window.google.maps.ControlPosition.TOP_CENTER,drawingModes:[window.google.maps.drawing.OverlayType.POLYGON]},polygonOptions:{fillColor:"#0000FF",fillOpacity:.3,strokeWeight:1,clickable:!0,editable:!1,zIndex:1}}),S.value.setMap(s.value),window.google.maps.event.addListener(S.value,"overlaycomplete",function(a){a.type===window.google.maps.drawing.OverlayType.POLYGON&&(m.push(a.overlay),X(a.overlay))})},J=()=>{s.value=new window.google.maps.Map(document.getElementById("map"),{center:{lat:parseFloat(n.default_lat),lng:parseFloat(n.default_lng)},zoom:10}),n.existingZones&&n.existingZones.length>0&&n.existingZones.forEach(a=>{new window.google.maps.Polygon({paths:a,fillColor:"#FF0000",fillOpacity:.5,strokeWeight:1,clickable:!1,editable:!1,zIndex:1,map:s.value})}),Y()},A=a=>{if(S.value){const _=a==="draw"?window.google.maps.drawing.OverlayType.POLYGON:null;S.value.setDrawingMode(_)}},W=()=>{if(C.value){const a=m.indexOf(C.value);A("grab"),a>-1&&(m[a].setMap(null),m.splice(a,1),C.value=null)}},Q=()=>{m.forEach(a=>{a.setMap(null)}),m=[],C.value=null},$=async()=>{const a=te();if(Object.keys(a).length===0)try{if(m.length===0){v.value=o("at_least_one_completed_polygon_is_required");return}const _=m.map(p=>p.getPath().getArray().map(w=>[w.lng(),w.lat()])),u={...i.data(),coordinates:JSON.stringify(_)};console.log("Form data being sent:",u),(await N.post("store",u)).status===201?(P.value=o("zone_created_successfully"),i.reset(),E.get("/zones")):v.value=o("failed_to_create_zone")}catch(_){_.response&&_.response.status===403?(v.value=_.response.data.alertMessage,setTimeout(()=>{E.get("/zones")},5e3)):_.response&&_.response.status===422?(v.value=_.response.data.message,i.errors={coordinates:_.response.data.message}):(i.errors={},v.value=o("failed_to_create_zone_catch"),console.error(o("error_updating_zone"),_))}else i.errors=a},ee=a=>{B.value=a},oe=()=>{P.value="",v.value=""},te=()=>{const a={};return i.unit||(a.unit=o("unit_is_required")),i.service_location_id||(a.service_location_id=o("service_location_is_required")),m.length===0&&(a.coordinates=o("at_least_one_completed_polygon_is_required")),n.enable_maximum_distance_feature&&((i.maximum_distance===""||i.maximum_distance===null||i.maximum_distance===void 0)&&(a.maximum_distance=o("required")),(i.maximum_outstation_distance===""||i.maximum_outstation_distance===null||i.maximum_outstation_distance===void 0)&&(a.maximum_outstation_distance=o("required"))),k.value&&((i.peak_zone_ride_count===""||i.peak_zone_ride_count===null||i.peak_zone_ride_count===void 0)&&(a.peak_zone_ride_count=o("required")),(i.peak_zone_radius===""||i.peak_zone_radius===null||i.peak_zone_radius===void 0)&&(a.peak_zone_radius=o("required")),(i.peak_zone_history_duration===""||i.peak_zone_history_duration===null||i.peak_zone_history_duration===void 0)&&(a.peak_zone_history_duration=o("required")),(i.peak_zone_duration===""||i.peak_zone_duration===null||i.peak_zone_duration===void 0)&&(a.peak_zone_duration=o("required")),(i.distance_price_percentage===""||i.distance_price_percentage===null||i.distance_price_percentage===void 0)&&(a.distance_price_percentage=o("required"))),a};return U(async()=>{Object.keys(O.value||{}).length===0&&await t()}),U(()=>{if(!n.googleMapKey){console.error(o("google_map_api_key_is_null_or_undefined"));return}const a=document.createElement("script");a.src=`https://maps.googleapis.com/maps/api/js?key=${n.googleMapKey}&libraries=places,drawing`,a.onload=()=>{J(),R()},document.head.appendChild(a)}),{form:i,successMessage:P,alertMessage:v,handleSubmit:$,serviceLocations:T,search:b,suggestions:M,handleInput:K,selectSuggestion:H,setActiveTab:ee,removeAllPolygons:Q,removeSelectedPolygon:W,changeDrawingMode:A,activeTab:B,languages:O,enable_peak_zone_feature:k,dismissMessage:oe}},computed:{selectedUnitLabel(){return this.form.unit==1?this.$t("kilo_meter"):this.form.unit==2?this.$t("miles"):""}}},ue={class:"row"},me={class:"col-lg-6"},pe={class:"card"},ge={class:"card-body"},fe={class:"mb-3"},ve={for:"service_location",class:"form-label"},be={value:"",disabled:""},he=["value"],ye={key:0,class:"text-danger"},ke={class:"nav nav-tabs nav-tabs-custom nav-success nav-justified",role:"tablist"},we={class:"nav-item",role:"presentation"},ze=["onClick"],xe=["id"],Me={class:"col-sm-6 mt-3"},Ce={class:"mb-3"},Le=["for"],Oe=["placeholder","id","onUpdate:modelValue","required"],Pe={class:"mb-3"},Se={for:"select_unit",class:"form-label"},Te={disabled:"",value:""},Fe={value:1},qe={value:2},Be={key:0,class:"text-danger"},Ve={key:0,class:"mb-3"},Ae={for:"maximum_distance",class:"form-label"},Ie=["placeholder"],Ue={key:0,class:"text-danger"},De={key:1,class:"mb-3"},Ne={for:"maximum_outstation_distance",class:"form-label"},Ee=["placeholder"],je={key:0,class:"text-danger"},Ge={key:2,class:"row"},Ke={class:"col-sm-6"},Ze={class:"mb-3"},He={for:"peak_zone_ride_count",class:"form-label"},Re={class:"input-group"},Xe=["placeholder"],Ye={key:0,class:"text-danger"},Je={class:"col-sm-6"},We={class:"mb-3"},Qe={for:"peak_zone_radius",class:"form-label"},$e={class:"input-group"},eo=["placeholder"],oo={key:0,class:"text-danger"},to={key:3,class:"row"},so={class:"col-sm-6"},ao={class:"mb-3"},no={for:"peak_zone_history_duration",class:"form-label"},io=["placeholder"],lo={key:0,class:"text-danger"},ro={class:"col-sm-6"},co={class:"mb-3"},_o={for:"peak_zone_duration",class:"form-label"},uo={class:"input-group"},mo=["placeholder"],po={key:0,class:"text-danger"},go={key:4,class:"row"},fo={class:"col-sm-6"},vo={class:"mb-3"},bo={for:"distance_price_percentage",class:"form-label"},ho={class:"input-group"},yo=["placeholder"],ko={key:0,class:"text-danger"},wo={class:"text-end"},zo={type:"submit",class:"btn btn-primary"},xo={class:"mb-3"},Mo={key:0,class:"text-danger"},Co={class:"col-lg-6 col-md-10 col-sm-10"},Lo={class:"card"},Oo={class:"card-body"},Po={class:"autocomplete-container"},So={class:"input-group"},To=["placeholder"],Fo={key:0,class:"autocomplete-results"},qo=["onClick"],Bo={class:"col-lg-1 col-md-2 col-sm-2",style:{position:"absolute","z-index":"50",top:"20%"}},Vo={class:"d-flex align-items-center"},Ao={class:"card-body"},Io={class:"d-flex align-items-center"},Uo={class:"card-body"},Do={class:"d-flex align-items-center"},No={class:"card-body"},Eo={class:"d-flex align-items-center"},jo={class:"card-body"},Go={key:0,class:"custom-alert alert alert-success alert-border-left fade show",role:"alert",id:"alertMsg"},Ko={class:"alert-content"},Zo={key:1,class:"custom-alert alert alert-danger alert-border-left fade show",role:"alert",id:"alertMsg"},Ho={class:"alert-content"};function Ro(n,o,O,t,B,k){const i=L("Head"),P=L("PageHeader"),v=L("BCol"),T=L("BRow"),b=L("BButton"),M=L("Layout");return r(),D(M,null,{default:z(()=>[x(i,{title:"Zones"}),x(P,{title:n.$t("create"),pageTitle:n.$t("zone"),pageLink:"/zones"},null,8,["title","pageTitle"]),e("div",ue,[e("div",me,[e("div",pe,[e("div",ge,[e("form",{onSubmit:o[10]||(o[10]=j((...s)=>t.handleSubmit&&t.handleSubmit(...s),["prevent"]))},[e("div",fe,[e("label",ve,l(n.$t("service_location")),1),g(e("select",{class:"form-select",id:"service_location","onUpdate:modelValue":o[0]||(o[0]=s=>t.form.service_location_id=s)},[e("option",be,l(n.$t("select_service_location")),1),(r(!0),d(q,null,F(t.serviceLocations,s=>(r(),d("option",{key:s.id,value:s.id},l(s.name),9,he))),128))],512),[[G,t.form.service_location_id]]),t.form.errors.service_location_id?(r(),d("span",ye,l(t.form.errors.service_location_id),1)):c("",!0)]),e("ul",ke,[(r(!0),d(q,null,F(t.languages,s=>(r(),D(T,{key:s.code},{default:z(()=>[x(v,{lg:"12"},{default:z(()=>[e("li",we,[e("a",{class:le(["nav-link",{active:t.activeTab===s.label}]),onClick:m=>t.setActiveTab(s.label),role:"tab","aria-selected":"true"},l(s.label),11,ze)])]),_:2},1024)]),_:2},1024))),128))]),(r(!0),d(q,null,F(t.languages,s=>(r(),d("div",{class:"tab-content text-muted",key:s.code},[t.activeTab===s.label?(r(),d("div",{key:0,class:"tab-pane active show",id:`${s.label}`,role:"tabpanel"},[e("div",Me,[e("div",Ce,[e("label",{for:`name-${s.code}`,class:"form-label"},l(n.$t("name")),9,Le),g(e("input",{type:"text",class:"form-control",placeholder:n.$t("enter_name_in",{language:`${s.label}`}),id:`name-${s.code}`,"onUpdate:modelValue":m=>t.form.languageFields[s.code]=m,required:s.code==="en"},null,8,Oe),[[h,t.form.languageFields[s.code]]])])])],8,xe)):c("",!0)]))),128)),e("div",Pe,[e("label",Se,l(n.$t("select_unit")),1),g(e("select",{id:"select_unit",class:"form-select","onUpdate:modelValue":o[1]||(o[1]=s=>t.form.unit=s)},[e("option",Te,l(n.$t("choose_unit")),1),e("option",Fe,l(n.$t("kilo_meter")),1),e("option",qe,l(n.$t("miles")),1)],512),[[G,t.form.unit]]),t.form.errors.unit?(r(),d("span",Be,l(t.form.errors.unit),1)):c("",!0)]),O.enable_maximum_distance_feature?(r(),d("div",Ve,[e("label",Ae,[y(l(n.$t("maximum_distance"))+" ",1),o[17]||(o[17]=e("span",{class:"text-danger"},"*",-1))]),g(e("input",{type:"number",step:"any",class:"form-control",placeholder:n.$t("enter_maximum_distance"),id:"maximum_distance","onUpdate:modelValue":o[2]||(o[2]=s=>t.form.maximum_distance=s)},null,8,Ie),[[h,t.form.maximum_distance,void 0,{number:!0}]]),t.form.errors.maximum_distance?(r(),d("span",Ue,l(t.form.errors.maximum_distance),1)):c("",!0)])):c("",!0),O.enable_maximum_distance_feature?(r(),d("div",De,[e("label",Ne,[y(l(n.$t("maximum_outstation_distance"))+" ",1),o[18]||(o[18]=e("span",{class:"text-danger"},"*",-1))]),g(e("input",{type:"number",step:"any",class:"form-control",placeholder:n.$t("enter_maximum_outstation_distance"),id:"maximum_outstation_distance","onUpdate:modelValue":o[3]||(o[3]=s=>t.form.maximum_outstation_distance=s)},null,8,Ee),[[h,t.form.maximum_outstation_distance,void 0,{number:!0}]]),t.form.errors.maximum_outstation_distance?(r(),d("span",je,l(t.form.errors.maximum_outstation_distance),1)):c("",!0)])):c("",!0),t.enable_peak_zone_feature?(r(),d("div",Ge,[e("div",Ke,[e("div",Ze,[e("label",He,[y(l(n.$t("peak_zone_ride_count"))+" ",1),o[19]||(o[19]=e("span",{class:"text-danger"},"*",-1))]),e("div",Re,[g(e("input",{type:"number",step:"any",class:"form-control",placeholder:n.$t("enter_peak_zone_ride_count"),id:"peak_zone_ride_count","onUpdate:modelValue":o[4]||(o[4]=s=>t.form.peak_zone_ride_count=s)},null,8,Xe),[[h,t.form.peak_zone_ride_count,void 0,{number:!0}]])]),t.form.errors.peak_zone_ride_count?(r(),d("span",Ye,l(t.form.errors.peak_zone_ride_count),1)):c("",!0)])]),e("div",Je,[e("div",We,[e("label",Qe,[y(l(n.$t("peak_zone_radius"))+" ",1),o[20]||(o[20]=e("span",{class:"text-danger"},"*",-1))]),e("div",$e,[g(e("input",{type:"number",step:"any",class:"form-control",placeholder:n.$t("enter_peak_zone_radius"),id:"peak_zone_radius","onUpdate:modelValue":o[5]||(o[5]=s=>t.form.peak_zone_radius=s)},null,8,eo),[[h,t.form.peak_zone_radius,void 0,{number:!0}]])]),t.form.errors.peak_zone_radius?(r(),d("span",oo,l(t.form.errors.peak_zone_radius),1)):c("",!0)])])])):c("",!0),t.enable_peak_zone_feature?(r(),d("div",to,[e("div",so,[e("div",ao,[e("label",no,[y(l(n.$t("peak_zone_history_duration"))+" ",1),o[21]||(o[21]=e("span",{class:"text-danger"},"*",-1))]),g(e("input",{type:"number",step:"any",class:"form-control",placeholder:n.$t("enter_peak_zone_history_duration"),id:"peak_zone_history_duration","onUpdate:modelValue":o[6]||(o[6]=s=>t.form.peak_zone_history_duration=s)},null,8,io),[[h,t.form.peak_zone_history_duration,void 0,{number:!0}]]),t.form.errors.peak_zone_history_duration?(r(),d("span",lo,l(t.form.errors.peak_zone_history_duration),1)):c("",!0)])]),e("div",ro,[e("div",co,[e("label",_o,[y(l(n.$t("peak_zone_duration"))+" ",1),o[22]||(o[22]=e("span",{class:"text-danger"},"*",-1))]),e("div",uo,[g(e("input",{type:"number",step:"any",class:"form-control",placeholder:n.$t("enter_peak_zone_duration"),id:"peak_zone_duration","onUpdate:modelValue":o[7]||(o[7]=s=>t.form.peak_zone_duration=s)},null,8,mo),[[h,t.form.peak_zone_duration,void 0,{number:!0}]])]),t.form.errors.peak_zone_duration?(r(),d("span",po,l(t.form.errors.peak_zone_duration),1)):c("",!0)])])])):c("",!0),t.enable_peak_zone_feature?(r(),d("div",go,[e("div",fo,[e("div",vo,[e("label",bo,[y(l(n.$t("distance_price_percentage"))+" ",1),o[23]||(o[23]=e("span",{class:"text-danger"},"*",-1)),e("a",{href:"#",class:"text-success","data-bs-toggle":"modal","data-bs-target":"#surge",onClick:o[8]||(o[8]=j(()=>{},["prevent"]))},l(n.$t("how_it_works")),1)]),e("div",ho,[g(e("input",{type:"number",step:"any",class:"form-control",placeholder:n.$t("enter_distance_price_percentage"),id:"distance_price_percentage","onUpdate:modelValue":o[9]||(o[9]=s=>t.form.distance_price_percentage=s)},null,8,yo),[[h,t.form.distance_price_percentage,void 0,{number:!0}]])]),t.form.errors.distance_price_percentage?(r(),d("span",ko,l(t.form.errors.distance_price_percentage),1)):c("",!0)])])])):c("",!0),e("div",wo,[e("button",zo,l(n.$t("save")),1)]),e("div",xo,[t.form.errors.coordinates?(r(),d("span",Mo,l(t.form.errors.coordinates),1)):c("",!0)])],32)])])]),e("div",Co,[e("div",Lo,[e("div",Oo,[e("div",Po,[e("div",So,[g(e("input",{type:"text",class:"form-control","onUpdate:modelValue":o[11]||(o[11]=s=>t.search=s),placeholder:n.$t("search_for_a_city"),id:"pac-input",autocomplete:"off",onInput:o[12]||(o[12]=(...s)=>t.handleInput&&t.handleInput(...s))},null,40,To),[[h,t.search]])]),t.suggestions.length>0?(r(),d("div",Fo,[(r(!0),d(q,null,F(t.suggestions,s=>(r(),d("div",{key:s.placeId,class:"autocomplete-item",onClick:m=>t.selectSuggestion(s)},l(s.formattedAddress),9,qo))),128))])):c("",!0)]),o[28]||(o[28]=e("div",{id:"map",style:{height:"400px",position:"relative","z-index":"10"}},null,-1)),e("div",Bo,[e("div",Vo,[e("div",Ao,[x(b,{onClick:o[13]||(o[13]=s=>t.changeDrawingMode("grab")),class:"align-center btn-dark border border-light","data-bs-toggle":"tooltip","data-bs-placement":"right",title:"Select"},{default:z(()=>[...o[24]||(o[24]=[e("i",{class:"bx bxs-hand-up fs-16"},null,-1)])]),_:1})])]),e("div",Io,[e("div",Uo,[x(b,{onClick:o[14]||(o[14]=s=>t.changeDrawingMode("draw")),class:"align-center btn-dark border border-light","data-bs-toggle":"tooltip","data-bs-placement":"right",title:"Add"},{default:z(()=>[...o[25]||(o[25]=[e("i",{class:"bx bx-plus fs-16"},null,-1)])]),_:1})])]),e("div",Do,[e("div",No,[x(b,{onClick:t.removeSelectedPolygon,class:"align-center btn-dark border border-light","data-bs-toggle":"tooltip","data-bs-placement":"right",title:"Remove selected polygon"},{default:z(()=>[...o[26]||(o[26]=[e("i",{class:"bx bx-x fs-16"},null,-1)])]),_:1},8,["onClick"])])]),e("div",Eo,[e("div",jo,[x(b,{onClick:t.removeAllPolygons,class:"align-center btn-dark border border-light","data-bs-toggle":"tooltip","data-bs-placement":"right",title:"Remove all"},{default:z(()=>[...o[27]||(o[27]=[e("i",{class:"bx bx-trash fs-16"},null,-1)])]),_:1},8,["onClick"])])])])]),o[29]||(o[29]=e("div",{class:"card-footer"},[e("div",{class:"alert alert-warning f-18",role:"alert"},[e("strong",null,"Avoid drawing multiple zones that overlap with each other.")])],-1))])])]),t.successMessage?(r(),d("div",Go,[e("div",Ko,[o[30]||(o[30]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),o[31]||(o[31]=e("strong",null,"Success",-1)),y(" - "+l(t.successMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-success",onClick:o[15]||(o[15]=(...s)=>t.dismissMessage&&t.dismissMessage(...s)),"aria-label":"Close Success Message"})])])):c("",!0),t.alertMessage?(r(),d("div",Zo,[e("div",Ho,[o[32]||(o[32]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),o[33]||(o[33]=e("strong",null,"Alert",-1)),y(" - "+l(t.alertMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-danger",onClick:o[16]||(o[16]=(...s)=>t.dismissMessage&&t.dismissMessage(...s)),"aria-label":"Close Alert Message"})])])):c("",!0),o[34]||(o[34]=e("div",{id:"surge",class:"modal fade",tabindex:"-1","aria-labelledby":"surgeLabel","aria-hidden":"true",style:{display:"none"}},[e("div",{class:"modal-dialog"},[e("div",{class:"modal-content"},[e("div",{class:"modal-header"},[e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]),e("div",{class:"modal-body"},[e("h5",{class:"fs-15"}," Peak Zone Surge Percentage "),e("p",{class:"text-muted"}," The percentage with which the price per distance increases when the ride is created within the peakzone ")])])])],-1))]),_:1})}const $o=se(_e,[["render",Ro],["__scopeId","data-v-5d1d12e0"]]);export{$o as default};
