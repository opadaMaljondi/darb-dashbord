import{_ as ie,Z as oe,O as le,P as ne,B as re,a as W,D as de,r as _,T as ce,R as J,o as me,g as c,i as u,y as K,w as d,W as A,N as _e,l as n,n as e,J as o,t as w,K as fe,k as b,L as X,F as Z,q as C,C as P,z as f,p as G,X as S}from"./vendor-8caf5d52.js";import{L as ue}from"./main-cc7bd0ce.js";import{P as ve}from"./page-header-18309276.js";import{P as pe}from"./Pagination-0518e4bd.js";import{s as be}from"./search-769502e2.js";import{s as ge}from"./searchbar-e42e22fa.js";import{u as he}from"./footer-502c2797.js";import{_ as ye}from"./search-file-ab3e1046.js";import"./app-974c65a1.js";const ke={data(){return{rightOffcanvas:!1}},components:{Layout:ue,PageHeader:ve,Head:oe,Pagination:pe,Multiselect:le,flatPickr:ne,Link:re,search:be,searchbar:ge},props:{successMessage:String,alertMessage:String,zones:Object,firebaseConfig:Object,ongoing_rides:Object,enable_outstation:Boolean,types:Object},methods:{navigateToInvoice(i,t){const k=`/rides-request/download-invoice/${t}?invoice_type=${i}`;window.location.href=k},navigateUserInvoice(i){this.navigateToInvoice("user",i)},navigateDriverInvoice(i){this.navigateToInvoice("driver",i)},invoiceToMail(i,t){W.post(`/rides-request/send-invoice-mail/${t}`,{invoice_type:i})},userInvoiceMail(i){this.invoiceToMail("user",i)},driverInvoiceMail(i){this.invoiceToMail("driver",i)}},setup(i){const{t}=de(),k=_(""),s=_("all"),g=ce({ride_status:"all",is_bid_ride:null,zone_id:null,vehicle_type_id:null,service_location_id:null,is_paid:null,limit:10,payment_opt:null}),V=_(i.zones),H=_(i.types),R=_(i.ongoing_rides),r=_([]),x=_({}),B=_(!1),M=_(!1),F=_(null),D=_(i.successMessage||""),I=_(i.alertMessage||""),L=_({}),{selectedLocation:O}=he(),T=_([]),E=()=>{D.value="",I.value=""},U=_(!1),N=()=>{h(),M.value=!0,U.value=!1},j=()=>{g.reset(),h(),M.value=!1,U.value=!1};J(s,l=>{g.ride_status=l,h()}),J(O,l=>{l!="all"&&(g.service_location_id=l,T.value=V.value.filter(m=>m.service_location_id==g.service_location_id)),h()}),me(async()=>{try{const l=i.firebaseConfig;firebase.apps.length||firebase.initializeApp(l);const m=firebase.database();R.value.forEach(v=>{m.ref(`requests/${v}`).on("value",function(se){const y=r.value.findIndex(p=>p.id===v);if(y!==-1){const p=se.val();p.is_completed&&(r.value[y].is_completed=!0),p.accept!==1&&(r.value[y].driver_id=null),p.driver_id&&(r.value[y].driver_id=p.driver_id),p.hasOwnProperty("modified_by_driver")&&(r.value[y].is_driver_started=1),p.trip_arrived==1&&(r.value[y].is_driver_arrived=!0),p.trip_start==1&&(r.value[y].is_trip_start=!0),p.is_completed&&(r.value[y].is_completed=!0),(p.is_cancelled||p.is_cancel)&&(r.value[y].is_cancelled=!0)}})}),O!="all"&&(g.service_location_id=O,T.value=V.value.filter(v=>v.service_location_id==g.service_location_id)),h()}catch(l){console.error(t("error_initializing_firebase_or_fetching_settings"),l)}});const a=()=>{B.value=!1},q=async l=>{try{const m=await W.get(`/rides-request/cancel/${l}`),v=r.value.findIndex(Y=>Y.id===l);v!==-1&&(r.value[v]=m.data.request),B.value=!1,A.fire(t("success"),t("trip_cancelled_successfully"),"success")}catch(m){console.log(m),A.fire(t("error"),t("failed_to_cancel_trip"),"error")}},z=async l=>{A.fire({title:"Are you sure?",text:"You want to be cancel this ride!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#34c38f",cancelButtonColor:"#f46a6a",confirmButtonText:"Yes, Cancel!",cancelButtonText:"Close"}).then(async m=>{if(m.isConfirmed)try{await q(l)}catch(v){console.error(t("error_deleting_data"),v),A.fire(t("error"),t("failed_to_cancel_the_data"),"error")}})},Q=async l=>{k.value=l,h()},h=async(l=1)=>{try{const m=g.data();k.value.length>0&&(m.search=k.value),m.page=l;const v=await W.get("/rides-request/list",{params:m});r.value=v.data.results,x.value=v.data.paginator,ae(x.value.total),M.value=!1}catch(m){console.error(t("error_fetching_requests"),m)}},$=async l=>{h(l)},ee=l=>l.is_cancelled?"Cancelled":l.is_completed?"Completed":l.is_trip_start?"On Trip":l.is_driver_arrived?"Driver Arrived":l.is_later&&l.is_driver_started?"Driver Started":l.is_driver_started?"Accepted":l.is_later?"Upcoming":"Searching",te=async l=>{_e.get(`/rides-request/view/${l.id}`)},ae=()=>{L.value=[10,25,50,100,200,500]};return{results:r,modalShow:B,deleteItemId:F,successMessage:D,alertMessage:I,filterData:N,deleteModal:z,closeModal:a,deleteData:q,dismissMessage:E,searchTerm:k,paginator:x,modalFilter:M,clearFilter:j,fetchDatas:h,filter:g,zoneList:T,types:H,rideStatus:ee,handlePageChanged:$,editData:te,activeTab:s,fetchSearch:Q,rightOffcanvas:U,paginatorOption:L,changeEntriesPerPage:()=>{h()}}}},we={class:"d-flex align-items-center mt-3"},Ce={class:"me-2 text-muted"},Be=["value"],Me={class:"ms-2 text-muted"},Se={class:"card-header"},Te={class:"row align-items-center"},Pe={class:"col"},Ve={class:"nav nav-tabs-custom card-header-tabs border-bottom-0",role:"tablist"},xe={class:"nav-item",role:"presentation"},De={class:"nav-item",role:"presentation"},Oe={class:"nav-item",role:"presentation"},Ue={class:"nav-item",role:"presentation"},ze={key:0,class:"nav-item",role:"presentation"},Ie={class:"nav-item",role:"presentation"},Le={class:"d-flex align-items-center gap-2"},qe={class:"table-responsive"},Ae={class:"table align-middle position-relative table-nowrap"},He={class:"table-active"},Re={scope:"col"},Fe={scope:"col"},Ee={scope:"col"},Ne={scope:"col"},je={scope:"col"},We={scope:"col"},Ye={scope:"col"},Je={scope:"col"},Ke={key:0},Xe={class:"dropdown"},Ze={class:"dropdown-menu dropdown-menu-end"},Ge=["onClick"],Qe=["onClick"],$e={key:2},et=["onClick"],tt=["onClick"],at={key:1},st={colspan:"10",class:"text-center"},it={key:0,class:"custom-alert alert alert-success alert-border-left fade show",data:"alert",id:"alertMsg"},ot={class:"alert-content"},lt={key:1,class:"custom-alert alert alert-danger alert-border-left fade show",data:"alert",id:"alertMsg"},nt={class:"alert-content"},rt={class:"offcanvas-body"},dt={class:"mb-4"},ct={for:"zone-select",class:"form-label text-muted text-uppercase fw-semibold mb-3"},mt={class:"mb-4"},_t={for:"vehicle_type",class:"form-label text-muted text-uppercase fw-semibold mb-3"},ft={class:"mb-4"},ut={for:"payment-status-select",class:"form-label text-muted text-uppercase fw-semibold mb-3"},vt={class:"form-check form-check-inline"},pt={class:"form-check-label",for:"not_paid"},bt={class:"form-check form-check-inline"},gt={class:"form-check-label",for:"paid"},ht={class:"mb-4"},yt={for:"dispatch-type-select",class:"form-label text-muted text-uppercase fw-semibold mb-3"},kt={class:"form-check form-check-inline"},wt={class:"form-check-label",for:"normal"},Ct={class:"form-check form-check-inline"},Bt={class:"form-check-label",for:"bidding"},Mt={class:"mb-4"},St={for:"payment-status-select",class:"form-label text-muted text-uppercase fw-semibold mb-3"},Tt={class:"form-check form-check-inline"},Pt={class:"form-check-label",for:"card"},Vt={class:"form-check form-check-inline"},xt={class:"form-check-label",for:"cash"},Dt={class:"form-check form-check-inline"},Ot={class:"form-check-label",for:"wallet"},Ut={class:"offcanvas-footer border-top p-3 text-center hstack gap-2"};function zt(i,t,k,s,g,V){const H=c("Head"),R=c("PageHeader"),r=c("BCol"),x=c("searchbar"),B=c("BButton"),M=c("BRow"),F=c("BCardHeader"),D=c("BBadge"),I=c("Link"),L=c("BCardBody"),O=c("BCard"),T=c("Multiselect"),E=c("BFrom"),U=c("BOffcanvas"),N=c("Pagination"),j=c("Layout");return u(),K(j,null,{default:d(()=>[n(H,{title:"Rides Request"}),n(R,{title:i.$t("index"),pageTitle:i.$t("ride_request")},null,8,["title","pageTitle"]),n(M,null,{default:d(()=>[n(r,{lg:"12"},{default:d(()=>[n(O,{"no-body":"",id:"tasksList"},{default:d(()=>[n(F,{class:"border-0"},{default:d(()=>[n(M,{class:"g-2"},{default:d(()=>[n(r,{md:"3"},{default:d(()=>[e("div",we,[e("label",Ce,o(i.$t("show")),1),w(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>s.filter.limit=a),onChange:t[1]||(t[1]=(...a)=>s.changeEntriesPerPage&&s.changeEntriesPerPage(...a)),class:"form-select form-select-sm w-auto"},[(u(!0),b(Z,null,X(s.paginatorOption,a=>(u(),b("option",{key:a,value:a},o(a),9,Be))),128))],544),[[fe,s.filter.limit]]),e("label",Me,o(i.$t("entries")),1)])]),_:1}),n(r,{md:"6"},{default:d(()=>[e("div",Se,[e("div",Te,[e("div",Pe,[e("ul",Ve,[e("li",xe,[e("a",{class:C(["nav-link fw-semibold btn",{active:s.activeTab==="all"}]),onClick:t[2]||(t[2]=a=>s.activeTab="all"),role:"tab","aria-selected":"false"},o(i.$t("all")),3)]),e("li",De,[e("a",{class:C(["nav-link fw-semibold btn",{active:s.activeTab==="completed"}]),onClick:t[3]||(t[3]=a=>s.activeTab="completed"),role:"tab","aria-selected":"false"},o(i.$t("completed")),3)]),e("li",Oe,[e("a",{class:C(["nav-link fw-semibold btn",{active:s.activeTab==="cancelled"}]),onClick:t[4]||(t[4]=a=>s.activeTab="cancelled"),role:"tab","aria-selected":"true"},o(i.$t("cancelled")),3)]),e("li",Ue,[e("a",{class:C(["nav-link fw-semibold btn",{active:s.activeTab==="upcoming"}]),onClick:t[5]||(t[5]=a=>s.activeTab="upcoming"),role:"tab","aria-selected":"true"},o(i.$t("upcoming")),3)]),k.enable_outstation?(u(),b("li",ze,[e("a",{class:C(["nav-link fw-semibold btn",{active:s.activeTab==="outstation"}]),onClick:t[6]||(t[6]=a=>s.activeTab="outstation"),role:"tab","aria-selected":"true"},o(i.$t("outstation")),3)])):P("",!0),e("li",Ie,[e("a",{class:C(["nav-link fw-semibold btn",{active:s.activeTab==="ontrip"}]),onClick:t[7]||(t[7]=a=>s.activeTab="ontrip"),role:"tab","aria-selected":"true"},o(i.$t("on_trip")),3)])])])])])]),_:1}),n(r,{md:"auto",class:"ms-auto"},{default:d(()=>[e("div",Le,[n(x,{onSearch:s.fetchSearch},null,8,["onSearch"]),n(B,{variant:"danger",onClick:t[8]||(t[8]=a=>s.rightOffcanvas=!0)},{default:d(()=>[t[21]||(t[21]=e("i",{class:"ri-filter-2-line me-1 align-bottom"},null,-1)),f(" "+o(i.$t("filters")),1)]),_:1,__:[21]})])]),_:1})]),_:1})]),_:1}),n(L,{class:"border border-dashed border-end-0 border-start-0"},{default:d(()=>[e("div",qe,[e("table",Ae,[e("thead",He,[e("tr",null,[e("th",Re,o(i.$t("request_id")),1),e("th",Fe,o(i.$t("date")),1),e("th",Ee,o(i.$t("user_name")),1),e("th",Ne,o(i.$t("driver_name")),1),e("th",je,o(i.$t("transport_type")),1),e("th",We,o(i.$t("trip_status")),1),e("th",Ye,o(i.$t("payment_option")),1),e("th",Je,o(i.$t("action")),1)])]),s.results.length>0?(u(),b("tbody",Ke,[(u(!0),b(Z,null,X(s.results,(a,q)=>(u(),b("tr",{key:q},[e("td",null,o(a.request_number),1),e("td",null,o(a.is_later?a.converted_trip_start_time:a.converted_created_at),1),e("td",null,o(a.user_name?a.user_name:"----"),1),e("td",null,o(a.driver_name?a.driver_name:"----"),1),e("td",null,o(a.transport_type=="taxi"?i.$t("taxi"):i.$t("delivery"))+" "+o(a.is_bid_ride?i.$t("bidding"):"")+" - "+o(a.vehicle_type_name),1),e("td",null,[n(D,{class:C({"text-uppercase":!0,"text-bg-success":s.rideStatus(a)==="Completed"||s.rideStatus(a)==="Accepted"||s.rideStatus(a)==="Driver Started","text-bg-danger":s.rideStatus(a)==="Cancelled","text-bg-info":s.rideStatus(a)==="On Trip","text-bg-warning":s.rideStatus(a)==="Upcoming"||s.rideStatus(a)==="Driver Arrived"||s.rideStatus(a)==="Searching"})},{default:d(()=>[f(o(s.rideStatus(a)),1)]),_:2},1032,["class"])]),e("td",null,[n(D,{class:C({"text-uppercase":!0,"text-bg-success":a.is_paid,"text-bg-danger":!a.is_paid})},{default:d(()=>[f(o(a.payment_opt==1?"Cash":a.payment_opt==2?"Wallet":"Card"),1)]),_:2},1032,["class"])]),e("td",null,[e("div",Xe,[t[27]||(t[27]=e("a",{class:"text-reset",href:"#","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},[e("span",{class:"text-muted fs-18"},[e("i",{class:"mdi mdi-dots-vertical"})])],-1)),e("div",Ze,[e("div",{class:"dropdown-item",type:"button",onClick:G(z=>s.editData(a),["prevent"])},[t[22]||(t[22]=e("i",{class:"bx bx-show-alt align-center text-muted me-2"},null,-1)),f(" "+o(i.$t("view")),1)],8,Ge),!a.is_cancelled&&!a.is_completed?(u(),b("div",{key:0,class:"dropdown-item",type:"button",onClick:G(z=>s.deleteModal(a.id),["prevent"])},[t[23]||(t[23]=e("i",{class:"bx bx-show-alt align-center text-muted me-2"},null,-1)),f(" "+o(i.$t("cancel")),1)],8,Qe)):P("",!0),!a.driver_id&&!a.is_cancelled&&!a.is_completed?(u(),K(I,{key:1,class:"dropdown-item",type:"button",href:`ongoing-rides/assign/${a.id}`},{default:d(()=>[t[24]||(t[24]=e("i",{class:"bx bx-show-alt align-center text-muted me-2"},null,-1)),f(" "+o(i.$t("assign")),1)]),_:2,__:[24]},1032,["href"])):P("",!0),a.is_completed?(u(),b("div",$e,[e("button",{onClick:z=>V.navigateUserInvoice(a.id),class:"dropdown-item"},[t[25]||(t[25]=e("i",{class:"bx bx-file align-center text-muted me-2"},null,-1)),f(" "+o(i.$t("Download User Invoice")),1)],8,et),e("button",{onClick:z=>V.navigateDriverInvoice(a.id),class:"dropdown-item"},[t[26]||(t[26]=e("i",{class:"bx bx-file align-center text-muted me-2"},null,-1)),f(" "+o(i.$t("Download Driver Invoice")),1)],8,tt)])):P("",!0)])])])]))),128))])):(u(),b("tbody",at,[e("tr",null,[e("td",st,[t[28]||(t[28]=e("img",{src:ye,alt:"Loading...",style:{width:"100px"}},null,-1)),e("h5",null,o(i.$t("no_data_found")),1)])])]))])])]),_:1})]),_:1})]),_:1})]),_:1}),e("div",null,[s.successMessage?(u(),b("div",it,[e("div",ot,[t[29]||(t[29]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),t[30]||(t[30]=f()),t[31]||(t[31]=e("strong",null,"Success",-1)),f(" - "+o(s.successMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-success",onClick:t[9]||(t[9]=(...a)=>s.dismissMessage&&s.dismissMessage(...a)),"aria-label":"Close Success Message"})])])):P("",!0),s.alertMessage?(u(),b("div",lt,[e("div",nt,[t[32]||(t[32]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),t[33]||(t[33]=f()),t[34]||(t[34]=e("strong",null,"Alert",-1)),f(" - "+o(s.alertMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-danger",onClick:t[10]||(t[10]=(...a)=>s.dismissMessage&&s.dismissMessage(...a)),"aria-label":"Close Alert Message"})])])):P("",!0)]),n(U,{modelValue:s.rightOffcanvas,"onUpdate:modelValue":t[20]||(t[20]=a=>s.rightOffcanvas=a),placement:"end",title:i.$t("filters"),"header-class":"bg-light","body-class":"p-0 overflow-hidden","footer-class":"border-top p-3 text-center"},{default:d(()=>[n(E,{action:"",class:"d-flex flex-column justify-content-end h-100"},{default:d(()=>[e("div",rt,[e("div",dt,[e("label",ct,o(i.$t("zone")),1),n(T,{modelValue:s.filter.zone_id,"onUpdate:modelValue":t[11]||(t[11]=a=>s.filter.zone_id=a),id:"zone_id",mode:"tags",options:s.zoneList.map(a=>({value:a.id,label:a.name})),"close-on-select":!1,multiple:!0,searchable:!0,placeholder:i.$t("select_a_zone"),"create-option":!1},null,8,["modelValue","options","placeholder"])]),e("div",mt,[e("label",_t,o(i.$t("vehicle_type")),1),n(T,{id:"vehicle_type_id",mode:"tags",modelValue:s.filter.vehicle_type_id,"onUpdate:modelValue":t[12]||(t[12]=a=>s.filter.vehicle_type_id=a),options:s.types.map(a=>({value:a.id,label:a.name})),"close-on-select":!1,searchable:!0,placeholder:i.$t("select_vehicle_type"),"create-option":!1},null,8,["modelValue","options","placeholder"])]),e("div",ft,[e("label",ut,o(i.$t("payment_status")),1),e("div",null,[e("div",vt,[w(e("input",{class:"form-check-input",type:"radio",name:"payment_status",id:"not_paid",value:"1","onUpdate:modelValue":t[13]||(t[13]=a=>s.filter.is_paid=a)},null,512),[[S,s.filter.is_paid]]),e("label",pt,o(i.$t("paid")),1)]),e("div",bt,[w(e("input",{class:"form-check-input",type:"radio",name:"payment_status",id:"paid",value:"0","onUpdate:modelValue":t[14]||(t[14]=a=>s.filter.is_paid=a)},null,512),[[S,s.filter.is_paid]]),e("label",gt,o(i.$t("not_paid")),1)])])]),e("div",ht,[e("label",yt,o(i.$t("ride_type")),1),e("div",null,[e("div",kt,[w(e("input",{class:"form-check-input",type:"radio",name:"dispatch-type",id:"normal",value:"0","onUpdate:modelValue":t[15]||(t[15]=a=>s.filter.is_bid_ride=a)},null,512),[[S,s.filter.is_bid_ride]]),e("label",wt,o(i.$t("regural")),1)]),e("div",Ct,[w(e("input",{class:"form-check-input",type:"radio",name:"dispatch-type",id:"bidding",value:"1","onUpdate:modelValue":t[16]||(t[16]=a=>s.filter.is_bid_ride=a)},null,512),[[S,s.filter.is_bid_ride]]),e("label",Bt,o(i.$t("bidding")),1)])])]),e("div",Mt,[e("label",St,o(i.$t("payment_option")),1),e("div",null,[e("div",Tt,[w(e("input",{class:"form-check-input",type:"radio",name:"payment_opt",id:"card",value:"0","onUpdate:modelValue":t[17]||(t[17]=a=>s.filter.payment_opt=a)},null,512),[[S,s.filter.payment_opt]]),e("label",Pt,o(i.$t("card")),1)]),e("div",Vt,[w(e("input",{class:"form-check-input",type:"radio",name:"payment_opt",id:"cash",value:"1","onUpdate:modelValue":t[18]||(t[18]=a=>s.filter.payment_opt=a)},null,512),[[S,s.filter.payment_opt]]),e("label",xt,o(i.$t("cash")),1)]),e("div",Dt,[w(e("input",{class:"form-check-input",type:"radio",name:"payment_opt",id:"wallet",value:"2","onUpdate:modelValue":t[19]||(t[19]=a=>s.filter.payment_opt=a)},null,512),[[S,s.filter.payment_opt]]),e("label",Ot,o(i.$t("wallet")),1)])])]),t[35]||(t[35]=e("div",null,null,-1))]),e("div",Ut,[n(B,{variant:"light",onClick:s.clearFilter,class:"w-100"},{default:d(()=>[f(o(i.$t("clear_filter")),1)]),_:1},8,["onClick"]),n(B,{type:"submit",onClick:s.filterData,variant:"success",class:"w-100"},{default:d(()=>[f(o(i.$t("apply")),1)]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["modelValue","title"]),n(N,{paginator:s.paginator,onPageChanged:s.handlePageChanged},null,8,["paginator","onPageChanged"])]),_:1})}const Wt=ie(ke,[["render",zt]]);export{Wt as default};
