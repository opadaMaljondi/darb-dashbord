import{_ as J,Z as K,O as W,D as Z,r as v,R as G,o as Q,g as u,i as g,y as q,w as c,l as n,n as l,J as d,z as N,k as D,F as X,L as Y,C as E}from"./vendor-54d6cb1e.js";import{L as ee}from"./dispatchmain-7b8a389c.js";import{g as te}from"./googleMap-c31fbadb.js";import{P as le}from"./page-header-ff719701.js";import"./footer-7e4f68d9.js";import"./dispatchHorizontal-f9ab2bd0.js";import"./app-cb082573.js";const se={components:{Head:K,Layout:ee,PageHeader:le,Multiselect:W,googleMap:te},props:{firebaseSettings:Object,map_key:String,service_location:Array,vehicle_type:Array,app_for:String,default_location:Object,baseUrl:String},setup(t){var U,I;Z(),v(null);const o=v(null),i=v([]),a=v([]),P=v(t.service_location.map(r=>({value:r.id,label:r.name}))),z=v(t.vehicle_type.map(r=>({value:r.id,label:r.name}))),S=v((I=(U=P.value)==null?void 0:U[0])==null?void 0:I.value),x=v({}),h=v(null),j=()=>{h.value=null,o.value=null,i.value=[],p()},R=()=>{h.value=null,p()};G([o,i],()=>{h.value=null,p()});const p=async()=>{firebase.database().ref("drivers").once("value",V=>{const s=V.val();s&&(x.value={},a.value=[],Object.keys(s).forEach(k=>{const e=s[k],L=e.g,m=A(L);if(m&&e.service_location_id){new google.maps.LatLng(m.lat,m.lon);let w=!!e.service_location_id;S.value&&S.value!=="all"&&(w=S.value==e.service_location_id);let T=Array.isArray(e.vehicle_types);o.value&&Array.isArray(e.vehicle_types)&&e.vehicle_types.length>0&&(T=(Array.isArray(e.vehicle_types)&&e.vehicle_types.some(f=>o.value===f))??!1);let F=i.value.length>0?i.value.includes("online"):!0,H=i.value.length>0?i.value.includes("onride"):!0,$=i.value.length>0?i.value.includes("offline"):!0,b="",y="offline",_="";if(e.hasOwnProperty("is_active")&&e.hasOwnProperty("is_available")){if(e.is_active==1&&e.is_available==!0&&F)b=`/image/map/${e.vehicle_type_icon}.png`,y="online";else if(e.is_active==1&&e.is_available==!1&&H)y="onride",b=`/image/map/${e.vehicle_type_icon}.png`;else if($){b=`/image/map/${e.vehicle_type_icon}.png`;let f=new Date-new Date(e.updated_at),B=parseInt(f/6e4),M=0,C=0,O=0;B>59&&(M=parseInt(B/60),M>23&&(C=parseInt(M/24),C>6&&(O=parseInt(C/7)))),B<=1&&(_="just now"),B>1&&B<59&&(_=B+" minutes ago"),M==1&&(_="An hour ago"),M>1&&(_=M+" hours ago"),C==1&&(_="A day ago"),C>1&&(_=C+" days ago"),O==1&&(_="A week ago"),O>1&&(_=O+" weeks ago")}}if(w&&T&&b.length>0){const f=t.app_for=="demo"?"*********":e.mobile;e.status=y,e.last_seen=_,a.value.push(e),x.value[e.id]={lat:m.lat,lng:m.lon,type_icon:e.vehicle_type_icon,name:e.name,mobile:f}}}}))})},A=r=>{const V="0123456789bcdefghjkmnpqrstuvwxyz",s=[16,8,4,2,1];let k=!0,e=-90,L=90,m=-180,w=180,T,F;if(r){for(let H=0;H<r.length;H++){let $=r.charAt(H),b=V.indexOf($);for(let y=0;y<5;y++){let _=s[y];if(k){let f=(m+w)/2;b&_?m=f:w=f}else{let f=(e+L)/2;b&_?e=f:L=f}k=!k}}return T=(e+L)/2,F=(m+w)/2,{lat:T,lon:F}}};return G([i,o],()=>{p()}),Q(async()=>{var r={apiKey:t.firebaseSettings.firebase_api_key,authDomain:t.firebaseSettings.firebase_auth_domain,databaseURL:t.firebaseSettings.firebase_database_url,projectId:t.firebaseSettings.firebase_project_id,storageBucket:t.firebaseSettings.firebase_storage_bucket,messagingSenderId:t.firebaseSettings.firebase_messaging_sender_id,appId:t.firebaseSettings.firebase_app_id};firebase.apps.length||firebase.initializeApp(r),p()}),{serviceLocations:P,vehicleTypes:z,selectedDriverModes:i,selectedDriver:h,drivers_list:a,clearFilters:j,applyFilters:R,driverMarkers:x,selectedVehicleTypes:o}}},ae={class:"row"},oe={class:"col-12 col-lg-3"},ie={class:"mb-3"},ne={for:"select_driver_mode",class:"form-label"},re={class:"col-12 col-lg-3"},ce={class:"mb-3"},de={for:"vehicle_type",class:"form-label"},_e={class:"col-12 col-lg-12 d-flex gap-1"},fe={key:0,class:"overflow-auto",style:{height:"400px"}},ue=["onClick"],me={class:"accordion-header",id:"headingThree"},ve={class:"accordion-button p-2 shadow-none","data-bs-toggle":"collapse",href:"#","aria-expanded":"false","aria-controls":"collapseThree"},pe={class:"d-flex align-items-center"},ge={class:"flex-shrink-0 border border-4 rounded-circle",style:{border:"var(--landing_header_act_text)"}},he=["src"],be={class:"d-flex justify-content-around"},ye={class:"flex-grow-1 ms-3"},ke={class:"fs-15 mb-1 fw-semibold",style:{color:"var(--landing_header_act_text)"}},we={class:"fs-15 mb-1 fw-normal",style:{color:"var(--landing_header_act_text)"}},Be={class:"fs-15 mb-1 fw-normal"},Me={class:"text-end ms-5 d-block"},Ce={key:0,class:"fs-15 mb-1 fw-semibold text-danger"},De={key:1,class:"fs-15 mb-1 fw-semibold text-success"},Se={key:2,class:"fs-15 mb-1 fw-semibold text-primary"},xe={class:"flex-grow-1 fs-15 mb-1 text-muted mt-5"},Ae={key:1,class:"d-flex",style:{height:"400px"}},Ie={id:"map",style:{height:"400px"}};function Ve(t,o,i,a,P,z){const S=u("Head"),x=u("PageHeader"),h=u("Multiselect"),j=u("BButton"),R=u("BCardHeader"),p=u("BCard"),A=u("BCol"),U=u("googleMap"),I=u("BRow"),r=u("BCardBody"),V=u("Layout");return g(),q(V,null,{default:c(()=>[n(S,{title:t.$t("gods-eye")},null,8,["title"]),n(x,{title:t.$t("gods-eye"),pageTitle:t.$t("dispatch")},null,8,["title","pageTitle"]),n(I,null,{default:c(()=>[n(A,{lg:"12"},{default:c(()=>[n(p,{"no-body":"",id:"tasksList"},{default:c(()=>[n(R,{class:"border-0"},{default:c(()=>[l("h4",null,d(t.$t("filters")),1),l("div",ae,[l("div",oe,[l("div",ie,[l("label",ne,d(t.$t("drivers")),1),n(h,{modelValue:a.selectedDriverModes,"onUpdate:modelValue":o[0]||(o[0]=s=>a.selectedDriverModes=s),id:"select_driver_mode",mode:"tags","close-on-select":!1,searchable:!0,"create-option":!1,options:[{value:"offline",label:t.$t("offline")},{value:"online",label:t.$t("online")},{value:"onride",label:t.$t("onride")}],placeholder:t.$t("select_mode")},null,8,["modelValue","options","placeholder"])])]),l("div",re,[l("div",ce,[l("label",de,d(t.$t("vehicle_types")),1),n(h,{modelValue:a.selectedVehicleTypes,"onUpdate:modelValue":o[1]||(o[1]=s=>a.selectedVehicleTypes=s),options:a.vehicleTypes,label:"label","track-by":"value",multiple:"","close-on-select":"",placeholder:t.$t("select_vehicle_types")},null,8,["modelValue","options","placeholder"])])]),l("div",_e,[n(j,{type:"button",variant:"success",class:"btn btn-md",onClick:a.applyFilters},{default:c(()=>[N(d(t.$t("apply")),1)]),_:1},8,["onClick"]),n(j,{type:"button",variant:"danger",class:"btn btn-md",onClick:a.clearFilters},{default:c(()=>[N(d(t.$t("clear")),1)]),_:1},8,["onClick"])])])]),_:1}),n(r,{class:"border border-dashed border-end-0 border-start-0"},{default:c(()=>[n(I,null,{default:c(()=>[n(A,{lg:"4"},{default:c(()=>[a.drivers_list.length>0?(g(),D("div",fe,[(g(!0),D(X,null,Y(a.drivers_list,s=>(g(),q(p,{class:"col-lg-12"},{default:c(()=>[l("div",{onClick:k=>a.selectedDriver=a.driverMarkers[s.id],class:"accordion-item border-0"},[l("div",me,[l("a",ve,[l("div",pe,[l("div",ge,[l("img",{src:s.profile_picture,alt:"",class:"avatar-md rounded-circle"},null,8,he)]),l("div",be,[l("div",ye,[l("h4",ke,d(s.name),1),l("h6",we,d(i.app_for=="demo"?"*********":s.mobile),1),l("h6",Be,[N(d(s.rating)+" ",1),o[2]||(o[2]=l("i",{class:"ri-star-fill text-warning align-bottom me-1"},null,-1))])]),l("div",Me,[s.status=="offline"?(g(),D("h4",Ce,d(s.status),1)):E("",!0),s.status=="online"?(g(),D("h4",De,d(s.status),1)):E("",!0),s.status=="onride"?(g(),D("h4",Se,d(s.status),1)):E("",!0),l("p",xe,d(s.last_seen),1)])])])])])],8,ue)]),_:2},1024))),256))])):(g(),D("div",Ae,[...o[3]||(o[3]=[l("img",{src:"/image/map/no-drivers.png",style:{width:"60%",margin:"auto"},alt:"No Drivers Found"},null,-1)])]))]),_:1}),n(A,{lg:"8"},{default:c(()=>[l("div",Ie,[n(U,{baseUrl:i.baseUrl,default_location:i.default_location,nearbyDrivers:a.driverMarkers,driver:a.selectedDriver,map_key:i.map_key,libraries:["marker"]},{default:c(()=>[N(d(t.$t("map_loading")),1)]),_:1},8,["baseUrl","default_location","nearbyDrivers","driver","map_key"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const Ne=J(se,[["render",Ve]]);export{Ne as default};
