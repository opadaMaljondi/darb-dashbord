import{_ as Q,Z as $,O as ee,P as te,B as se,D as oe,r as _,T as le,R as ne,S as ae,g as m,i as f,y as E,w as d,W as C,a as H,N as ie,l as i,n as e,J as s,z as c,k as g,L as U,F as A,C as N,t as V,K as W,p as re,X as z}from"./vendor-54d6cb1e.js";import{L as de}from"./main-b839be26.js";import{P as ce}from"./page-header-ff719701.js";import{P as ue}from"./Pagination-b5e3d5c9.js";import{u as me,l as fe}from"./footer-7e4f68d9.js";import{s as _e}from"./searchbar-3bdb3315.js";import{_ as ge}from"./search-file-ab3e1046.js";import"./app-cb082573.js";const be={data(){return{rightOffcanvas:!1,showUsers:!1}},components:{Layout:de,PageHeader:ce,Head:$,Pagination:ue,Multiselect:ee,flatPickr:te,Link:se,searchbar:_e},props:{successMessage:String,alertMessage:String,promo:{type:Object,required:!0}},setup(o){var I;const{t}=oe(),r=_(""),{selectedLocation:n}=me(),x=le({promo_id:(I=o.promo)==null?void 0:I.id,status:null,transport_type:null,service_location_id:"all",limit:10}),v=_([]),P=_({}),M=_(!1),b=_(!1),p=_(null),k=_({}),y=_(o.successMessage||""),j=_(o.alertMessage||""),S=()=>{y.value="",j.value=""},R=async(a,u)=>{C.fire({title:t("are_you_sure"),text:t("you_are_about_to_change_status"),icon:"warning",showCancelButton:!0,confirmButtonColor:"#34c38f",cancelButtonColor:"#f46a6a",confirmButtonText:t("yes"),cancelButtonText:t("cancel")}).then(async h=>{if(h.isConfirmed)try{await H.post("/promo-code/update-status",{id:a,status:u});const D=v.value.findIndex(Z=>Z.id===a);D!==-1&&(v.value[D].active=u),C.fire(t("changed"),t("status_updated_successfully"),"success")}catch(D){console.error(t("error_updating_status"),D),C.fire(t("error"),t("failed_to_update_status"),"error")}})},q=a=>a.charAt(0).toUpperCase()+a.slice(1),L=_(!1),T=()=>{w(),b.value=!0,L.value=!1},F=()=>{x.reset(),w(),L.value=!1},l=()=>{M.value=!1},B=async a=>{try{await H.delete(`/promo-code/delete/${a}`);const u=v.value.findIndex(h=>h.id===a);u!==-1&&v.value.splice(u,1),M.value=!1,C.fire(t("success"),t("promo_code_deleted_successfully"),"success")}catch{C.fire(t("error"),t("failed_to_delete_promo_code"),"error")}},O=async a=>{C.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#34c38f",cancelButtonColor:"#f46a6a",confirmButtonText:"Yes, delete it!"}).then(async u=>{if(u.isConfirmed)try{await B(a)}catch(h){console.error(t("error_deleting_data"),h),C.fire(t("error"),t("failed_to_delete_the_data"),"error")}})},Y=a=>a.is_cancelled?"Cancelled":a.is_completed?"Completed":a.is_trip_start?"On Trip":a.is_driver_arrived?"Driver Arrived":a.is_later&&a.is_driver_started?"Driver Started":a.is_driver_started?"Accepted":a.is_later?"Upcoming":"Searching",G=async a=>{r.value=a,w()},w=async(a=1)=>{try{const u=x.data();u.search=r.value,u.page=a;const h=await H.get("/promo-code/historyList",{params:u});v.value=h.data.results,P.value=h.data.paginator,X(P.value.total),b.value=!1}catch(u){console.error(t("error_fetching_promo_codes"),u)}},J=async a=>{localStorage.setItem("promo-code/historyList",a),w(a)},K=async a=>{ie.get(`/rides-request/view/${a.id}`)},X=()=>{k.value=[10,25,50,100,200,500]};return ne(n,a=>{x.service_location_id=a,w()}),{results:v,modalShow:M,deleteItemId:p,successMessage:y,alertMessage:j,filterData:T,deleteModal:O,closeModal:l,deleteData:B,dismissMessage:S,paginator:P,modalFilter:b,clearFilter:F,fetchDatas:w,filter:x,handlePageChanged:J,rideStatus:Y,editData:K,capitalizeFirstLetter:q,toggleActiveStatus:R,rightOffcanvas:L,paginatorOption:k,changeEntriesPerPage:()=>{w()},selectedLocation:n,searchTerm:r,fetchSearch:G}},computed:{...fe,...ae(["permissions"])},mounted(){this.filter.service_location_id=this.selectedLocation,this.fetchDatas();const o=localStorage.getItem("promo-code/historyList");o?this.handlePageChanged(Number(o)):this.handlePageChanged(1)}},he={class:"d-flex flex-wrap gap-3"},ve={class:"profile-border fs-18"},pe={class:"d-flex align-items-center justify-content-between"},ye={class:"d-flex align-items-center justify-content-between"},we={class:"d-flex align-items-center justify-content-between"},Ce={class:"d-flex align-items-center justify-content-between"},ke={class:"profile-border fs-18"},Be={class:"d-flex align-items-center justify-content-between"},xe={class:"d-flex align-items-center justify-content-between"},Pe={class:"d-flex align-items-center justify-content-between"},Me={class:"d-flex align-items-center justify-content-between"},Se={class:"profile-border fs-18"},Le={class:"d-flex align-items-center justify-content-between"},je={class:"d-flex align-items-center justify-content-between"},Oe={class:"d-flex align-items-center justify-content-between"},De={class:"d-flex align-items-center justify-content-between"},Ve={class:"flex-grow-1 text-start text-muted badge bg-secondary-subtle fs-18"},Re={class:"d-flex mb-2 align-items-center justify-content-between"},qe={class:"d-flex align-items-center mt-3"},Te={class:"me-2 text-muted"},Fe=["value"],He={class:"ms-2 text-muted"},Ue={class:"d-flex align-items-center gap-2"},Ae={class:"table-responsive"},Ne={class:"table align-middle position-relative table-nowrap"},Ie={class:"table-active"},Ee={scope:"col"},We={scope:"col"},ze={scope:"col"},Ye={scope:"col"},Ge={scope:"col"},Je={scope:"col"},Ke={key:0},Xe={class:"dropdown"},Ze={class:"dropdown-menu dropdown-menu-end"},Qe=["onClick"],$e={key:1},et={colspan:"10",class:"text-center"},tt={key:0,class:"custom-alert alert alert-success alert-border-left fade show",data:"alert",id:"alertMsg"},st={class:"alert-content"},ot={key:1,class:"custom-alert alert alert-danger alert-border-left fade show",data:"alert",id:"alertMsg"},lt={class:"alert-content"},nt={class:"offcanvas-body"},at={class:"mb-4"},it={for:"datepicker-range",class:"form-label text-muted text-uppercase fw-semibold mb-3"},rt={class:"form-check form-check-inline"},dt={class:"form-check-label",for:"WithoutinlineRadio2"},ct={class:"form-check form-check-inline"},ut={class:"form-check-label",for:"WithoutinlineRadio3"},mt={class:"mb-4"},ft={for:"datepicker-range",class:"form-label text-muted text-uppercase fw-semibold mb-3"},_t={value:"taxi"},gt={value:"delivery"},bt={value:"both"},ht={class:"offcanvas-footer border-top p-3 text-center hstack gap-2"};function vt(o,t,r,n,x,v){const P=m("Head"),M=m("PageHeader"),b=m("BCardBody"),p=m("BCard"),k=m("BRow"),y=m("BCol"),j=m("searchbar"),S=m("BButton"),R=m("BCardHeader"),q=m("BFrom"),L=m("BOffcanvas"),T=m("Pagination"),F=m("Layout");return f(),E(F,null,{default:d(()=>[i(P,{title:"Promo Code"}),i(M,{title:o.$t("promo_code"),pageTitle:o.$t("promo_code")},null,8,["title","pageTitle"]),i(k,null,{default:d(()=>[i(y,{lg:"12"},{default:d(()=>[i(p,{"no-body":"",id:"tasksList"},{default:d(()=>[i(R,{class:"border-0"},{default:d(()=>[i(k,null,{default:d(()=>{var l;return[e("div",he,[i(p,{class:"flex-fill equal-card","no-body":"",id:"tasksList"},{default:d(()=>[i(b,{class:"border-0"},{default:d(()=>[e("div",ve,[e("div",pe,[e("h5",null,[e("b",null,s(o.$t("code")),1)]),t[10]||(t[10]=c()),t[11]||(t[11]=e("br",null,null,-1)),e("h5",null,s(r.promo.code),1)]),e("div",ye,[e("h5",null,[e("b",null,s(o.$t("service_location")),1)]),t[12]||(t[12]=c()),t[13]||(t[13]=e("br",null,null,-1)),e("h5",null,s(r.promo.area_name),1)]),e("div",we,[e("h5",null,[e("b",null,s(o.$t("transport_type")),1)]),t[14]||(t[14]=c()),t[15]||(t[15]=e("br",null,null,-1)),e("h5",null,s(o.$t(r.promo.transport_type)),1)]),e("div",Ce,[e("h5",null,[e("b",null,s(o.$t("discount_percentage")),1)]),t[16]||(t[16]=c()),t[17]||(t[17]=e("br",null,null,-1)),e("h5",null,s(r.promo.discount_percent??0)+" % ",1)])])]),_:1})]),_:1}),i(p,{class:"flex-fill equal-card","no-body":"",id:"tasksList"},{default:d(()=>[i(b,{class:"border-0"},{default:d(()=>[e("div",ke,[e("div",Be,[e("h5",null,[e("b",null,s(o.$t("from")),1)]),e("h5",null,s(r.promo.from_date),1)]),e("div",xe,[e("h5",null,[e("b",null,s(o.$t("to")),1)]),e("h5",null,s(r.promo.to_date),1)]),e("div",Pe,[e("h5",null,[e("b",null,s(o.$t("discount_used")),1)]),t[18]||(t[18]=c()),t[19]||(t[19]=e("br",null,null,-1)),e("h5",null,s(r.promo.area_unit)+" "+s(r.promo.cummulative_maximum_discount_amount-r.promo.available_balance),1)]),e("div",Me,[e("h5",null,[e("b",null,s(o.$t("available_balance")),1)]),t[20]||(t[20]=c()),t[21]||(t[21]=e("br",null,null,-1)),e("h5",null,s(r.promo.area_unit)+" "+s(r.promo.available_balance),1)])])]),_:1})]),_:1}),i(p,{class:"flex-fill equal-card","no-body":"",id:"tasksList"},{default:d(()=>[i(b,{class:"border-0"},{default:d(()=>[e("div",Se,[e("div",Le,[e("h5",null,[e("b",null,s(o.$t("minimum_amount")),1)]),t[22]||(t[22]=c()),t[23]||(t[23]=e("br",null,null,-1)),e("h5",null,s(r.promo.area_unit)+" "+s(r.promo.minimum_trip_amount),1)]),e("div",je,[e("h5",null,[e("b",null,s(o.$t("maximum_discount")),1)]),t[24]||(t[24]=c()),t[25]||(t[25]=e("br",null,null,-1)),e("h5",null,s(r.promo.area_unit)+" "+s(r.promo.maximum_discount_amount),1)]),e("div",Oe,[e("h5",null,[e("b",null,s(o.$t("uses_per_user")),1)]),e("h5",null,s(r.promo.uses_per_user),1)]),e("div",De,[e("h5",null,[e("b",null,s(o.$t("cummulative_maximum_discount")),1)]),e("h5",null,s(r.promo.area_unit)+" "+s(r.promo.cummulative_maximum_discount_amount),1)])])]),_:1})]),_:1}),r.promo.user_specific&&((l=r.promo.users)!=null&&l.length)?(f(),E(p,{key:0,class:"flex-fill equal-card","no-body":"",id:"tasksList"},{default:d(()=>[e("h5",Ve,[e("b",null,s(o.$t("users")),1)]),i(b,{class:"border-0 overflow-auto users-scroll"},{default:d(()=>[(f(!0),g(A,null,U(r.promo.users,(B,O)=>(f(),g("div",{class:"card mb-0",key:O},[e("div",Re,[e("h5",null,s(B.user_name),1)])]))),128))]),_:1})]),_:1})):N("",!0)])]}),_:1}),i(k,{class:"g-2"},{default:d(()=>[i(y,{md:"3"},{default:d(()=>[e("div",qe,[e("label",Te,s(o.$t("show")),1),V(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>n.filter.limit=l),onChange:t[1]||(t[1]=(...l)=>n.changeEntriesPerPage&&n.changeEntriesPerPage(...l)),class:"form-select form-select-sm w-auto"},[(f(!0),g(A,null,U(n.paginatorOption,l=>(f(),g("option",{key:l,value:l},s(l),9,Fe))),128))],544),[[W,n.filter.limit]]),e("label",He,s(o.$t("entries")),1)])]),_:1}),i(y,{md:"3"}),i(y,{md:"auto",class:"ms-auto"},{default:d(()=>[e("div",Ue,[i(j,{onSearch:n.fetchSearch},null,8,["onSearch"]),i(S,{variant:"danger",onClick:t[2]||(t[2]=l=>n.rightOffcanvas=!0)},{default:d(()=>[t[26]||(t[26]=e("i",{class:"ri-filter-2-line me-1 align-bottom"},null,-1)),c(" "+s(o.$t("filters")),1)]),_:1})])]),_:1})]),_:1})]),_:1}),i(b,{class:"border border-dashed border-end-0 border-start-0"},{default:d(()=>[e("div",Ae,[e("table",Ne,[e("thead",Ie,[e("tr",null,[e("th",Ee,s(o.$t("request_id")),1),e("th",We,s(o.$t("date")),1),e("th",ze,s(o.$t("user_name")),1),e("th",Ye,s(o.$t("transport_type")),1),e("th",Ge,s(o.$t("discount")),1),e("th",Je,s(o.$t("action")),1)])]),n.results.length>0?(f(),g("tbody",Ke,[(f(!0),g(A,null,U(n.results,(l,B)=>(f(),g("tr",{key:B},[e("td",null,s(l.request_number),1),e("td",null,s(l.is_later?l.converted_trip_start_time:l.converted_created_at),1),e("td",null,s(l.user_name?l.user_name:"----"),1),e("td",null,s(l.transport_type=="taxi"?o.$t("taxi"):o.$t("delivery"))+" "+s(l.is_bid_ride?o.$t("bidding"):"")+" - "+s(l.vehicle_type_name),1),e("td",null,s(l.requested_currency_symbol)+" "+s(l.promo_discount??0),1),e("td",null,[e("div",Xe,[t[28]||(t[28]=e("a",{class:"text-reset",href:"#","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},[e("span",{class:"text-muted fs-18"},[e("i",{class:"mdi mdi-dots-vertical"})])],-1)),e("div",Ze,[e("div",{class:"dropdown-item",type:"button",onClick:re(O=>n.editData(l),["prevent"])},[t[27]||(t[27]=e("i",{class:"bx bx-show-alt align-center text-muted me-2"},null,-1)),c(" "+s(o.$t("view")),1)],8,Qe)])])])]))),128))])):(f(),g("tbody",$e,[e("tr",null,[e("td",et,[t[29]||(t[29]=e("img",{src:ge,alt:"Loading...",style:{width:"100px"}},null,-1)),e("h5",null,s(o.$t("no_data_found")),1)])])]))])])]),_:1})]),_:1})]),_:1})]),_:1}),e("div",null,[n.successMessage?(f(),g("div",tt,[e("div",st,[t[30]||(t[30]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),t[31]||(t[31]=c()),t[32]||(t[32]=e("strong",null,"Success",-1)),c(" - "+s(n.successMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-success",onClick:t[3]||(t[3]=(...l)=>n.dismissMessage&&n.dismissMessage(...l)),"aria-label":"Close Success Message"})])])):N("",!0),n.alertMessage?(f(),g("div",ot,[e("div",lt,[t[33]||(t[33]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),t[34]||(t[34]=c()),t[35]||(t[35]=e("strong",null,"Alert",-1)),c(" - "+s(n.alertMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-danger",onClick:t[4]||(t[4]=(...l)=>n.dismissMessage&&n.dismissMessage(...l)),"aria-label":"Close Alert Message"})])])):N("",!0)]),i(L,{modelValue:n.rightOffcanvas,"onUpdate:modelValue":t[9]||(t[9]=l=>n.rightOffcanvas=l),placement:"end",title:o.$t("promo_filters"),"header-class":"bg-light","body-class":"p-0 overflow-hidden","footer-class":"border-top p-3 text-center"},{default:d(()=>[i(q,{action:"",class:"d-flex flex-column justify-content-end h-100"},{default:d(()=>[e("div",nt,[e("div",at,[e("label",it,s(o.$t("status")),1),e("div",null,[e("div",rt,[V(e("input",{class:"form-check-input",type:"radio",name:"inlineRadioOptions",id:"WithoutinlineRadio2",value:"1","onUpdate:modelValue":t[5]||(t[5]=l=>n.filter.status=l)},null,512),[[z,n.filter.status]]),e("label",dt,s(o.$t("active")),1)]),e("div",ct,[V(e("input",{class:"form-check-input",type:"radio",name:"inlineRadioOptions",id:"WithoutinlineRadio3",value:"0","onUpdate:modelValue":t[6]||(t[6]=l=>n.filter.status=l)},null,512),[[z,n.filter.status]]),e("label",ut,s(o.$t("inactive")),1)])])]),e("div",mt,[e("label",ft,s(o.$t("transport_type")),1),V(e("select",{class:"form-control","data-choices":"","data-choices-search-false":"",name:"choices-select-status",id:"choices-select-status","onUpdate:modelValue":t[7]||(t[7]=l=>n.filter.transport_type=l)},[e("option",_t,s(o.$t("taxi")),1),e("option",gt,s(o.$t("delivery")),1),e("option",bt,s(o.$t("both")),1)],512),[[W,n.filter.transport_type]])])]),e("div",ht,[i(S,{variant:"light",onClick:t[8]||(t[8]=l=>n.clearFilter()),class:"w-100"},{default:d(()=>[c(s(o.$t("clear_filter")),1)]),_:1}),i(S,{type:"submit",onClick:n.filterData,variant:"success",class:"w-100"},{default:d(()=>[c(s(o.$t("apply")),1)]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["modelValue","title"]),i(T,{paginator:n.paginator,onPageChanged:n.handlePageChanged},null,8,["paginator","onPageChanged"])]),_:1})}const St=Q(be,[["render",vt]]);export{St as default};
