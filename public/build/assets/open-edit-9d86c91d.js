import{_ as I,Z as J,D as R,r as k,T as U,Y as f,o as G,g as h,i as l,y as x,w as C,a as N,N as V,l as E,k as d,n as s,p as Z,J as u,t as O,K,F as T,L as S,C as g,q as Y,M as Q,z as W}from"./vendor-54d6cb1e.js";import{L as X}from"./main-b839be26.js";import{P as $}from"./page-header-ff719701.js";import{u as ee}from"./footer-7e4f68d9.js";import"./app-cb082573.js";const te={components:{Layout:X,PageHeader:$,Head:J},props:{airport:Object,successMessage:String,languages:Array,alertMessage:String},setup(c){const{airport:t}=c,{t:v}=R(),{languages:o,fetchData:D}=ee(),L=k("English"),w=k(c.successMessage||""),b=k(c.alertMessage||""),p=U({service_location_id:t.service_location_id,name:t.name,coordinates:t.coordinates||[]}),A=k([]);let m,e,_=[];const B=f.latLngBounds(),F=async()=>{const n=await N.get("/airport/list");A.value=n.data.results},H=()=>{if(t&&t.coordinates){m=f.map("map").setView([0,0],10),f.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"Â© OpenStreetMap"}).addTo(m);const n=new f.FeatureGroup;m.addLayer(n);let a=[];if(Array.isArray(t.coordinates))a=t.coordinates;else if(t.coordinates&&typeof t.coordinates=="object"&&t.coordinates.coordinates)a=t.coordinates.coordinates;else if(typeof t.coordinates=="string")try{const r=JSON.parse(t.coordinates);a=Array.isArray(r)?r:r.coordinates||[]}catch(r){console.error("Error parsing coordinates:",r),a=[]}Array.isArray(a)&&a.length>0&&(a.forEach(r=>{if(Array.isArray(r)&&r.length>0&&Array.isArray(r[0])){const y=r[0].map(i=>i&&i.coordinates&&Array.isArray(i.coordinates)?[i.coordinates[1],i.coordinates[0]]:Array.isArray(i)&&i.length>=2?[i[1],i[0]]:null).filter(i=>i!==null);y.length>0&&(e=f.polygon(y,{color:"blue",weight:3,fillOpacity:.2}).addTo(n),B.extend(e.getBounds()),_.push(e))}}),_.length>0&&m.fitBounds(B)),j(n)}},j=n=>{const a=new f.Control.Draw({edit:{featureGroup:n,remove:!0},draw:{polygon:{allowIntersection:!1},rectangle:!1,circle:!1,polyline:!1,marker:!1}});m.addControl(a),m.on(f.Draw.Event.CREATED,function(r){const y=r.layer;n.addLayer(y),_.push(y)}),m.on(f.Draw.Event.DELETED,function(r){r.layers.eachLayer(function(i){console.log("Deleted layer:",i),_=_.filter(M=>M!==i)})})},q=async()=>{const n=z();if(Object.keys(n).length===0)try{if(_.length===0){b.value=v("at_least_one_completed_polygon_is_required");return}const a=_.map(i=>i.getLatLngs()[0].map(M=>[M.lng,M.lat])),r={...p.data(),coordinates:JSON.stringify(a)};(await N.post(`/airport/update/${t.id}`,r)).status===200?(w.value=v("airport_created_successfully"),p.reset(),V.get("/airport")):console.error(v("failed_to_update_airport"))}catch(a){a.response&&a.response.status===403?(b.value=a.response.data.alertMessage,setTimeout(()=>{V.get("/airport")},5e3)):console.error(v("error_updating_airport"),a)}else p.errors=n},z=()=>{const{service_location_id:n}=p,a={};return n?delete a.service_location_id:a.service_location_id=v("service_location_is_required"),a},P=n=>{L.value=n};return G(async()=>{Object.keys(o).length==0&&await D(),H(),F()}),{form:p,serviceLocations:A,handleSubmit:q,setActiveTab:P,languages:o,activeTab:L,successMessage:w,alertMessage:b}}},se={key:0,class:"row"},oe={class:"col-lg-6"},ae={class:"card"},re={class:"card-body"},ie={class:"mb-3"},ne={for:"service_location",class:"form-label"},le={value:"",disabled:""},ce=["value"],de={key:0,class:"text-danger"},_e={class:"nav nav-tabs nav-tabs-custom nav-success nav-justified",role:"tablist"},ue={class:"nav-item",role:"presentation"},me=["onClick"],fe=["id"],ve={class:"col-sm-6 mt-3"},pe={class:"mb-3"},ye=["for"],ge=["placeholder","id","onUpdate:modelValue","required"],be={class:"text-end"},he={type:"submit",class:"btn btn-primary"},we={class:"mb-3"},Ae={key:0,class:"text-danger"},Me={key:1,class:"alert alert-success"},ke={key:2,class:"custom-alert alert alert-danger alert-border-left fade show",role:"alert",id:"alertMsg"},Le={class:"alert-content"};function Ce(c,t,v,o,D,L){const w=h("Head"),b=h("PageHeader"),p=h("BCol"),A=h("BRow"),m=h("Layout");return l(),x(m,null,{default:C(()=>[E(w,{title:"Edit Airport"}),E(b,{title:c.$t("edit"),pageTitle:c.$t("airport"),pageLink:"/airport"},null,8,["title","pageTitle"]),v.airport?(l(),d("div",se,[s("div",oe,[s("div",ae,[s("div",re,[s("form",{onSubmit:t[1]||(t[1]=Z((...e)=>o.handleSubmit&&o.handleSubmit(...e),["prevent"]))},[s("div",ie,[s("label",ne,u(c.$t("service_location")),1),O(s("select",{class:"form-select",id:"service_location","onUpdate:modelValue":t[0]||(t[0]=e=>o.form.service_location_id=e)},[s("option",le,u(c.$t("select_service_location")),1),(l(!0),d(T,null,S(o.serviceLocations,e=>(l(),d("option",{key:e.id,value:e.id},u(e.name),9,ce))),128))],512),[[K,o.form.service_location_id]]),o.form.errors.service_location_id?(l(),d("span",de,u(o.form.errors.service_location_id),1)):g("",!0)]),s("ul",_e,[(l(!0),d(T,null,S(o.languages,e=>(l(),x(A,{key:e.code},{default:C(()=>[E(p,{lg:"12"},{default:C(()=>[s("li",ue,[s("a",{class:Y(["nav-link",{active:o.activeTab===e.label}]),onClick:_=>o.setActiveTab(e.label),role:"tab","aria-selected":"true"},u(e.label),11,me)])]),_:2},1024)]),_:2},1024))),128))]),(l(!0),d(T,null,S(o.languages,e=>(l(),d("div",{class:"tab-content text-muted",key:e.code},[o.activeTab===e.label?(l(),d("div",{key:0,class:"tab-pane active show",id:`${e.label}`,role:"tabpanel"},[s("div",ve,[s("div",pe,[s("label",{for:`name-${e.code}`,class:"form-label"},u(c.$t("name")),9,ye),O(s("input",{type:"text",class:"form-control",placeholder:`Enter Name in ${e.label}`,id:`name-${e.code}`,"onUpdate:modelValue":_=>o.form.languageFields[e.code]=_,required:e.code==="en"},null,8,ge),[[Q,o.form.languageFields[e.code]]])])])],8,fe)):g("",!0)]))),128)),s("div",be,[s("button",he,u(c.$t("update")),1)]),s("div",we,[o.form.errors.coordinates?(l(),d("span",Ae,u(o.form.errors.coordinates),1)):g("",!0)])],32)])])]),t[3]||(t[3]=s("div",{class:"col-lg-6"},[s("div",{class:"card"},[s("div",{class:"card-body"},[s("div",{id:"map",style:{height:"400px"}})])])],-1))])):g("",!0),o.successMessage?(l(),d("div",Me,u(o.successMessage),1)):g("",!0),o.alertMessage?(l(),d("div",ke,[s("div",Le,[t[4]||(t[4]=s("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),t[5]||(t[5]=s("strong",null,"Alert",-1)),W(" - "+u(o.alertMessage)+" ",1),s("button",{type:"button",class:"btn-close btn-close-danger",onClick:t[2]||(t[2]=(...e)=>c.dismissMessage&&c.dismissMessage(...e)),"aria-label":"Close Alert Message"})])])):g("",!0)]),_:1})}const xe=I(te,[["render",Ce],["__scopeId","data-v-883afc46"]]);export{xe as default};
