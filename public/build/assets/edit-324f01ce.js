import{_ as ae,Z as ne,D as ie,r as b,T as re,o as le,g as P,i as d,y as Z,w as x,a as K,N as G,l as w,k as c,n as e,p as de,J as l,t as v,K as H,F as B,L as I,C as u,q as ce,M as y,z as k}from"./vendor-8caf5d52.js";import{L as _e}from"./main-cc7bd0ce.js";import{P as me}from"./page-header-18309276.js";import{u as ue}from"./footer-502c2797.js";import"./app-974c65a1.js";const ge={components:{Layout:_e,PageHeader:me,Head:ne},props:{zone:Object,googleMapKey:String,successMessage:String,alertMessage:String,app_for:String,existingZones:Array,enable_maximum_distance_feature:Boolean,settings:Object},setup(a){const{zone:t,googleMapKey:p}=a,{t:o}=ie(),{languages:T,fetchData:U}=ue(),S=b("English"),V=b(a.settings.enable_peak_zone_feature==1),E=b(a.successMessage||""),z=b(a.alertMessage||""),f=re({service_location_id:t.service_location_id,languageFields:t?t.languageFields||{}:{},unit:t.unit,coordinates:t.coordinates||[],maximum_outstation_distance:t.maximum_outstation_distance??(a.enable_maximum_distance_feature?"":0),maximum_distance:t.maximum_distance??(a.maximum_distance?"":0),peak_zone_radius:t.peak_zone_radius??(a.peak_zone_radius?"":0),peak_zone_duration:t.peak_zone_duration??(a.peak_zone_duration?"":0),peak_zone_history_duration:t.peak_zone_history_duration??(a.peak_zone_history_duration?"":0),peak_zone_ride_count:t.peak_zone_ride_count??(a.peak_zone_ride_count?"":0),distance_price_percentage:t.distance_price_percentage??(a.distance_price_percentage?"":0)}),M=b([]);let s,g=[];const L=b(null),C=b(null),D=async()=>{const n=await K.get("/zones/list");M.value=n.data.results},O=b(""),F=b([]),J=()=>{O.value.length<3?F.value=[]:setTimeout(()=>{R(O.value)},300)},R=n=>{const i="https://places.googleapis.com/v1/places:autocomplete",r={"Content-Type":"application/json","X-Goog-Api-Key":a.googleMapKey,"X-Goog-FieldMask":"suggestions.placePrediction.placeId,suggestions.placePrediction.place,suggestions.placePrediction.text"};fetch(i,{method:"POST",headers:r,body:JSON.stringify({input:n})}).then(_=>_.json()).then(_=>{var m;((m=_.suggestions)==null?void 0:m.length)>0&&(F.value=_.suggestions.filter(A=>A.placePrediction).map(A=>({placeId:A.placePrediction.placeId,formattedAddress:A.placePrediction.text.text})))}).catch(_=>{console.error("Error fetching autocomplete results:",_)})},X=async n=>{const i={"X-Goog-Api-Key":a.googleMapKey,"X-Goog-FieldMask":"viewport,location"};fetch(`https://places.googleapis.com/v1/places/${n.placeId}?fields=viewport,location`,{headers:i}).then(r=>r.json()).then(r=>{O.value="",F.value=[];const h=new google.maps.LatLng(r.location.latitude,r.location.longitude);if(s.setCenter(h),r.viewport&&r.viewport.high&&r.viewport.low){const _=new google.maps.LatLngBounds(new google.maps.LatLng(r.viewport.low.latitude,r.viewport.low.longitude),new google.maps.LatLng(r.viewport.high.latitude,r.viewport.high.longitude));s.fitBounds(_)}else s.setZoom(15)}).catch(r=>{console.error("Error fetching autocomplete results:",r)})},N=()=>{if(t){s=new google.maps.Map(document.getElementById("map"),{center:{lat:0,lng:0},zoom:10});const n=new google.maps.LatLngBounds;t.coordinates&&Array.isArray(t.coordinates)&&t.coordinates.length>0&&(t.coordinates.forEach((i,r)=>{try{if(i&&Array.isArray(i)&&i.length>0){const h=i[0];if(h&&Array.isArray(h)&&h.length>0){const _=h.map(m=>m&&m.coordinates&&Array.isArray(m.coordinates)&&m.coordinates.length>=2?{lat:m.coordinates[1],lng:m.coordinates[0]}:null).filter(m=>m!==null);if(_.length>0){const m=new google.maps.Polygon({paths:_,fillColor:"#FF0000",fillOpacity:.5,strokeWeight:1,clickable:!0,editable:!1,zIndex:10,map:s});g.push(m),q(m),m.getPath().forEach(A=>n.extend(A))}}}}catch(h){console.error(`Error processing polygon at index ${r}:`,h)}}),g.length>0&&s.fitBounds(n)),a.existingZones&&Array.isArray(a.existingZones)&&a.existingZones.forEach(i=>{i&&Array.isArray(i)&&new google.maps.Polygon({paths:i,fillColor:"#FF0000",fillOpacity:.5,strokeWeight:1,clickable:!1,editable:!1,zIndex:1,map:s})}),ee()}},q=n=>{google.maps.event.addListener(n,"click",()=>{C.value!==n&&(g.forEach(i=>{i.setOptions({fillColor:"#FF0000",editable:!1})}),n.setOptions({fillColor:"#00FF00",editable:!0}),C.value=n)})},j=n=>{if(L.value){let i=n=="draw"?google.maps.drawing.OverlayType.POLYGON:null;L.value.setDrawingMode(i)}},W=()=>{if(C.value){const n=$(C.value);n>-1&&(g[n].setMap(null),g.splice(n,1)),C.value=null,j("grab")}},Y=()=>{g.forEach(n=>{n.setMap(null),C.value=null}),g=[]},Q=(n,i)=>{const r=n.getPath().getArray().map(_=>({lat:_.lat(),lng:_.lng()})),h=i.getPath().getArray().map(_=>({lat:_.lat(),lng:_.lng()}));return JSON.stringify(r)===JSON.stringify(h)},$=n=>{for(let i=0;i<g.length;i++)if(Q(n,g[i]))return i;return-1},ee=()=>{L.value=new google.maps.drawing.DrawingManager({drawingMode:null,drawingControl:!1,polygonOptions:{fillColor:"#FF0000",fillOpacity:.5,strokeWeight:1,clickable:!0,editable:!1,zIndex:1}}),L.value.setMap(s),google.maps.event.addListener(L.value,"overlaycomplete",function(n){n.type===google.maps.drawing.OverlayType.POLYGON&&(g.push(n.overlay),q(n.overlay))})},te=async()=>{if(a.app_for=="demo"){Swal.fire(o("error"),o("you_are_not_authorised"),"error");return}const n=oe();if(Object.keys(n).length===0)try{if(g.length===0){z.value=o("at_least_one_completed_polygon_is_required");return}const i=g.map(_=>_.getPath().getArray().map(m=>[m.lng(),m.lat()])),r={...f.data(),coordinates:JSON.stringify(i)};(await K.post(`/zones/update/${t.id}`,r)).status===200?(E.value=o("zone_created_successfully"),f.reset(),G.get("/zones")):console.error(o("failed_to_update_zone"))}catch(i){i.response&&i.response.status===403?(z.value=i.response.data.alertMessage,setTimeout(()=>{G.get("/zones")},5e3)):i.response&&i.response.status===422?(z.value=i.response.data.message,f.errors={coordinates:i.response.data.message}):(f.errors={},z.value=o("failed_to_create_zone_catch"),console.error(o("error_updating_zone"),i))}else f.errors=n},oe=()=>{const{service_location_id:n,unit:i}=f,r={};return i?delete r.unit:r.unit="Unit is required",n?delete r.service_location_id:r.service_location_id=o("service_location_is_required"),a.enable_maximum_distance_feature&&(maximum_distance?delete r.maximum_distance:r.maximum_distance=o("required"),maximum_outstation_distance?delete r.maximum_outstation_distance:r.maximum_outstation_distance=o("required")),r},se=n=>{S.value=n};return le(async()=>{let n=!1;if(!p){console.error(o("google_map_api_key_is_null_or_undefined"));return}if(Object.keys(T).length==0&&await U(),document.querySelector(`script[src="https://maps.googleapis.com/maps/api/js?key=${p}&libraries=places,drawing"]`))n||(N(),D(),n=!0);else{const i=document.createElement("script");i.src=`https://maps.googleapis.com/maps/api/js?key=${p}&libraries=places,drawing`,i.onload=()=>{n||(N(),D(),n=!0)},document.head.appendChild(i)}}),{form:f,serviceLocations:M,handleSubmit:te,serviceLocations:M,setActiveTab:se,serviceLocations:M,search:O,suggestions:F,handleInput:J,selectSuggestion:X,alertMessage:z,languages:T,removeAllPolygons:Y,removeSelectedPolygon:W,changeDrawingMode:j,activeTab:S,enable_peak_zone_feature:V}},computed:{selectedUnitLabel(){return this.form.unit==1?this.$t("kilo_meter"):this.form.unit==2?this.$t("miles"):""}}},pe={key:0,class:"row"},fe={class:"col-lg-6"},he={class:"card"},ve={class:"card-body"},be={class:"mb-3"},ye={for:"service_location",class:"form-label"},ke={value:"",disabled:""},ze=["value"],xe={key:0,class:"text-danger"},we={class:"nav nav-tabs nav-tabs-custom nav-success nav-justified",role:"tablist"},Me={class:"nav-item",role:"presentation"},Ce=["onClick"],Ae=["id"],Pe={class:"col-sm-6 mt-3"},Le={class:"mb-3"},Se=["for"],Oe=["placeholder","id","onUpdate:modelValue","required"],Fe={class:"mb-3"},Be={for:"select_unit",class:"form-label"},Ie={disabled:"",value:""},Te={value:"1"},Ve={value:"2"},Ee={key:0,class:"text-danger"},Ue={key:0,class:"mb-3"},De={for:"maximum_distance",class:"form-label"},Ne=["placeholder"],qe={key:0,class:"text-danger"},je={key:1,class:"mb-3"},Ze={for:"maximum_outstation_distance",class:"form-label"},Ke=["placeholder"],Ge={key:0,class:"text-danger"},He={key:2,class:"row"},Je={class:"col-sm-6"},Re={class:"mb-3"},Xe={for:"peak_zone_ride_count",class:"form-label"},We={class:"input-group"},Ye=["readonly","placeholder"],Qe={key:0,class:"text-danger"},$e={class:"col-sm-6"},et={class:"mb-3"},tt={for:"peak_zone_radius",class:"form-label"},ot={class:"input-group"},st=["readonly","placeholder"],at={key:0,class:"text-danger"},nt={key:3,class:"row"},it={class:"col-sm-6"},rt={class:"mb-3"},lt={for:"peak_zone_history_duration",class:"form-label"},dt=["readonly","placeholder"],ct={key:0,class:"text-danger"},_t={class:"col-sm-6"},mt={class:"mb-3"},ut={for:"peak_zone_duration",class:"form-label"},gt={class:"input-group"},pt=["readonly","placeholder"],ft={key:0,class:"text-danger"},ht={key:0,class:"row"},vt={class:"col-sm-6"},bt={class:"mb-3"},yt={for:"distance_price_percentage",class:"form-label"},kt={href:"",class:"text-success","data-bs-toggle":"modal","data-bs-target":"#surge"},zt={class:"input-group"},xt=["readonly","placeholder"],wt={key:0,class:"text-danger"},Mt={class:"text-end"},Ct=["disabled"],At={class:"mb-3"},Pt={key:0,class:"text-danger"},Lt={class:"col-lg-6"},St={class:"card"},Ot={class:"card-body"},Ft={class:"autocomplete-container"},Bt={class:"input-group"},It=["placeholder"],Tt={key:0,class:"autocomplete-results"},Vt=["onClick"],Et={class:"col-lg-1 col-md-2 col-sm-2",style:{position:"absolute","z-index":"50",top:"20%"}},Ut={class:"d-flex align-items-center"},Dt={class:"card-body"},Nt={class:"d-flex align-items-center"},qt={class:"card-body"},jt={class:"d-flex align-items-center"},Zt={class:"card-body"},Kt={class:"d-flex align-items-center"},Gt={class:"card-body"},Ht={key:1},Jt={key:2,class:"custom-alert alert alert-danger alert-border-left fade show",role:"alert",id:"alertMsg"},Rt={class:"alert-content"};function Xt(a,t,p,o,T,U){const S=P("Head"),V=P("PageHeader"),E=P("BCol"),z=P("BRow"),f=P("BButton"),M=P("Layout");return d(),Z(M,null,{default:x(()=>[w(S,{title:"Edit Zone"}),w(V,{title:a.$t("edit"),pageTitle:a.$t("zone"),pageLink:"/zones"},null,8,["title","pageTitle"]),p.zone?(d(),c("div",pe,[e("div",fe,[e("div",he,[e("div",ve,[e("form",{onSubmit:t[9]||(t[9]=de((...s)=>o.handleSubmit&&o.handleSubmit(...s),["prevent"]))},[e("div",be,[e("label",ye,l(a.$t("service_location")),1),v(e("select",{class:"form-select",id:"service_location","onUpdate:modelValue":t[0]||(t[0]=s=>o.form.service_location_id=s)},[e("option",ke,l(a.$t("select_service_location")),1),(d(!0),c(B,null,I(o.serviceLocations,s=>(d(),c("option",{key:s.id,value:s.id},l(s.name),9,ze))),128))],512),[[H,o.form.service_location_id]]),o.form.errors.service_location_id?(d(),c("span",xe,l(o.form.errors.service_location_id),1)):u("",!0)]),e("ul",we,[(d(!0),c(B,null,I(o.languages,s=>(d(),Z(z,{key:s.code},{default:x(()=>[w(E,{lg:"12"},{default:x(()=>[e("li",Me,[e("a",{class:ce(["nav-link",{active:o.activeTab===s.label}]),onClick:g=>o.setActiveTab(s.label),role:"tab","aria-selected":"true"},l(s.label),11,Ce)])]),_:2},1024)]),_:2},1024))),128))]),(d(!0),c(B,null,I(o.languages,s=>(d(),c("div",{class:"tab-content text-muted",key:s.code},[o.activeTab===s.label?(d(),c("div",{key:0,class:"tab-pane active show",id:`${s.label}`,role:"tabpanel"},[e("div",Pe,[e("div",Le,[e("label",{for:`name-${s.code}`,class:"form-label"},l(a.$t("name")),9,Se),v(e("input",{type:"text",class:"form-control",placeholder:`Enter Name in ${s.label}`,id:`name-${s.code}`,"onUpdate:modelValue":g=>o.form.languageFields[s.code]=g,required:s.code==="en"},null,8,Oe),[[y,o.form.languageFields[s.code]]])])])],8,Ae)):u("",!0)]))),128)),e("div",Fe,[e("label",Be,l(a.$t("select_unit")),1),v(e("select",{id:"select_unit",class:"form-select","onUpdate:modelValue":t[1]||(t[1]=s=>o.form.unit=s)},[e("option",Ie,l(a.$t("choose_unit")),1),e("option",Te,l(a.$t("kilo_meter")),1),e("option",Ve,l(a.$t("miles")),1)],512),[[H,o.form.unit]]),o.form.errors.unit?(d(),c("span",Ee,l(o.form.errors.unit),1)):u("",!0)]),p.enable_maximum_distance_feature?(d(),c("div",Ue,[e("label",De,[k(l(a.$t("maximum_distance"))+" ",1),t[15]||(t[15]=e("span",{class:"text-danger"},"*",-1))]),v(e("input",{type:"number",step:"any",class:"form-control",placeholder:a.$t("enter_maximum_distance"),id:"maximum_distance","onUpdate:modelValue":t[2]||(t[2]=s=>o.form.maximum_distance=s)},null,8,Ne),[[y,o.form.maximum_distance,void 0,{number:!0}]]),o.form.errors.enter_maximum_distance?(d(),c("span",qe,l(o.form.errors.enter_maximum_distance),1)):u("",!0)])):u("",!0),p.enable_maximum_distance_feature?(d(),c("div",je,[e("label",Ze,[k(l(a.$t("maximum_outstation_distance"))+" ",1),t[16]||(t[16]=e("span",{class:"text-danger"},"*",-1))]),v(e("input",{type:"number",step:"any",class:"form-control",placeholder:a.$t("enter_maximum_outstation_distance"),id:"maximum_outstation_distance","onUpdate:modelValue":t[3]||(t[3]=s=>o.form.maximum_outstation_distance=s)},null,8,Ke),[[y,o.form.maximum_outstation_distance,void 0,{number:!0}]]),o.form.errors.maximum_outstation_distance?(d(),c("span",Ge,l(o.form.errors.maximum_outstation_distance),1)):u("",!0)])):u("",!0),o.enable_peak_zone_feature?(d(),c("div",He,[e("div",Je,[e("div",Re,[e("label",Xe,[k(l(a.$t("peak_zone_ride_count"))+" ",1),t[17]||(t[17]=e("span",{class:"text-danger"},"*",-1))]),e("div",We,[v(e("input",{type:"number",readonly:p.app_for==="demo",class:"form-control",placeholder:a.$t("enter_peak_zone_ride_count"),id:"peak_zone_ride_count","onUpdate:modelValue":t[4]||(t[4]=s=>o.form.peak_zone_ride_count=s)},null,8,Ye),[[y,o.form.peak_zone_ride_count]]),o.form.errors.peak_zone_ride_count?(d(),c("span",Qe,l(o.form.errors.peak_zone_ride_count),1)):u("",!0)])])]),e("div",$e,[e("div",et,[e("label",tt,[k(l(a.$t("peak_zone_radius"))+" ",1),t[18]||(t[18]=e("span",{class:"text-danger"},"*",-1))]),e("div",ot,[v(e("input",{type:"number",readonly:p.app_for==="demo",class:"form-control",placeholder:a.$t("enter_peak_zone_radius"),id:"peak_zone_radius","onUpdate:modelValue":t[5]||(t[5]=s=>o.form.peak_zone_radius=s)},null,8,st),[[y,o.form.peak_zone_radius]]),o.form.errors.peak_zone_radius?(d(),c("span",at,l(o.form.errors.peak_zone_radius),1)):u("",!0)])])])])):u("",!0),o.enable_peak_zone_feature?(d(),c("div",nt,[e("div",it,[e("div",rt,[e("label",lt,[k(l(a.$t("peak_zone_history_duration"))+" ",1),t[19]||(t[19]=e("span",{class:"text-danger"},"*",-1))]),v(e("input",{type:"number",readonly:p.app_for==="demo",class:"form-control",placeholder:a.$t("enter_peak_zone_history_duration"),id:"peak_zone_history_duration","onUpdate:modelValue":t[6]||(t[6]=s=>o.form.peak_zone_history_duration=s)},null,8,dt),[[y,o.form.peak_zone_history_duration]]),o.form.errors.peak_zone_history_duration?(d(),c("span",ct,l(o.form.errors.peak_zone_history_duration),1)):u("",!0)])]),e("div",_t,[e("div",mt,[e("label",ut,[k(l(a.$t("peak_zone_duration"))+" ",1),t[20]||(t[20]=e("span",{class:"text-danger"},"*",-1))]),e("div",gt,[v(e("input",{type:"number",readonly:p.app_for==="demo",class:"form-control",placeholder:a.$t("enter_peak_zone_duration"),id:"peak_zone_duration","onUpdate:modelValue":t[7]||(t[7]=s=>o.form.peak_zone_duration=s)},null,8,pt),[[y,o.form.peak_zone_duration]]),o.form.errors.peak_zone_duration?(d(),c("span",ft,l(o.form.errors.peak_zone_duration),1)):u("",!0)])])]),o.enable_peak_zone_feature?(d(),c("div",ht,[e("div",vt,[e("div",bt,[e("label",yt,[k(l(a.$t("distance_price_percentage"))+" ",1),t[21]||(t[21]=e("span",{class:"text-danger"},"*",-1)),e("a",kt,l(a.$t("how_it_works")),1)]),e("div",zt,[v(e("input",{type:"number",readonly:p.app_for==="demo",class:"form-control",placeholder:a.$t("enter_distance_price_percentage"),id:"distance_price_percentage","onUpdate:modelValue":t[8]||(t[8]=s=>o.form.distance_price_percentage=s)},null,8,xt),[[y,o.form.distance_price_percentage]]),o.form.errors.distance_price_percentage?(d(),c("span",wt,l(o.form.errors.distance_price_percentage),1)):u("",!0)])])])])):u("",!0)])):u("",!0),e("div",Mt,[e("button",{type:"submit",class:"btn btn-primary",disabled:p.app_for==="demo"},l(a.$t("update")),9,Ct)]),e("div",At,[o.form.errors.coordinates?(d(),c("span",Pt,l(o.form.errors.coordinates),1)):u("",!0)])],32)])])]),e("div",Lt,[e("div",St,[e("div",Ot,[e("div",Ft,[e("div",Bt,[v(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[10]||(t[10]=s=>o.search=s),placeholder:a.$t("search_for_a_city"),id:"pac-input",autocomplete:"off",onInput:t[11]||(t[11]=(...s)=>o.handleInput&&o.handleInput(...s))},null,40,It),[[y,o.search]])]),o.suggestions.length>0?(d(),c("div",Tt,[(d(!0),c(B,null,I(o.suggestions,s=>(d(),c("div",{key:s.placeId,class:"autocomplete-item",onClick:g=>o.selectSuggestion(s)},l(s.formattedAddress),9,Vt))),128))])):u("",!0)]),t[26]||(t[26]=e("div",{id:"map",style:{height:"400px"}},null,-1)),e("div",Et,[e("div",Ut,[e("div",Dt,[w(f,{onClick:t[12]||(t[12]=s=>o.changeDrawingMode("grab")),class:"align-center btn-dark border border-light","data-bs-toggle":"tooltip","data-bs-placement":"right",title:"Select"},{default:x(()=>t[22]||(t[22]=[e("i",{class:"bx bxs-hand-up fs-16"},null,-1)])),_:1,__:[22]})])]),e("div",Nt,[e("div",qt,[w(f,{onClick:t[13]||(t[13]=s=>o.changeDrawingMode("draw")),class:"align-center btn-dark border border-light","data-bs-toggle":"tooltip","data-bs-placement":"right",title:"Add"},{default:x(()=>t[23]||(t[23]=[e("i",{class:"bx bx-plus fs-16"},null,-1)])),_:1,__:[23]})])]),e("div",jt,[e("div",Zt,[w(f,{onClick:o.removeSelectedPolygon,class:"align-center btn-dark border border-light","data-bs-toggle":"tooltip","data-bs-placement":"right",title:"Remove selected polygon"},{default:x(()=>t[24]||(t[24]=[e("i",{class:"bx bx-x fs-16"},null,-1)])),_:1,__:[24]},8,["onClick"])])]),e("div",Kt,[e("div",Gt,[w(f,{onClick:o.removeAllPolygons,class:"align-center btn-dark border border-light","data-bs-toggle":"tooltip","data-bs-placement":"right",title:"Remove all"},{default:x(()=>t[25]||(t[25]=[e("i",{class:"bx bx-trash fs-16"},null,-1)])),_:1,__:[25]},8,["onClick"])])])])]),t[27]||(t[27]=e("div",{class:"card-footer"},[e("div",{class:"alert alert-warning f-18",role:"alert"},[e("strong",null," Avoid make new polygons that overlap with existing zones.")])],-1))])])])):(d(),c("div",Ht,l(a.$t("lodaing")),1)),o.alertMessage?(d(),c("div",Jt,[e("div",Rt,[t[28]||(t[28]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),t[29]||(t[29]=e("strong",null,"Alert",-1)),k(" - "+l(o.alertMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-danger",onClick:t[14]||(t[14]=(...s)=>a.dismissMessage&&a.dismissMessage(...s)),"aria-label":"Close Alert Message"})])])):u("",!0),t[30]||(t[30]=e("div",{id:"surge",class:"modal fade",tabindex:"-1","aria-labelledby":"surgeLabel","aria-hidden":"true",style:{display:"none"}},[e("div",{class:"modal-dialog"},[e("div",{class:"modal-content"},[e("div",{class:"modal-header"},[e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]),e("div",{class:"modal-body"},[e("h5",{class:"fs-15"}," Peak Zone Surge Percentage "),e("p",{class:"text-muted"}," The percentage with which the price per distance increases when the ride is created within the peakzone ")])])])],-1))]),_:1,__:[30]})}const to=ae(ge,[["render",Xt],["__scopeId","data-v-dd04c852"]]);export{to as default};
