import{ab as R,ac as A,a0 as z,ad as D,a as k,_ as F,g as j,i as P,k as M,l as b,w as g,n as w,J as N,z as O}from"./vendor-8caf5d52.js";const G={...R("layout",{layoutType:n=>n.layoutType,sidebarSize:n=>n.sidebarSize,layoutWidth:n=>n.layoutWidth,topbar:n=>n.topbar,mode:n=>n.mode,position:n=>n.position,sidebarView:n=>n.sidebarView,sidebarColor:n=>n.sidebarColor,sidebarImage:n=>n.sidebarImage,visibility:n=>n.visibility})},Q=A("layout",["changeLayoutType","changeLayoutWidth","changeSidebarSize","changeTopbar","changeMode","changePosition","changeSidebarView","changeSidebarColor","changeSidebarImage","changePreloader","changeVisibility"]);A("notification",["success","error","clear"]);({...R("todo",{todos:n=>n.todos})});A("todo",["fetchTodos"]);const t=z({languages:null,locations:null,selectedLocation:null,notifications:[],chats:[],unreadNotification:0,unreadChat:0,permissions:[]});function X(){const n=async()=>{if(t.languages==null){const e=await(await fetch("/current-languages")).json();t.languages=e.data.map(o=>({value:o.id,label:o.name,code:o.code,default:o.default_status,direction:o.direction}))}},u=new Audio("/audio/notification.mp3");let h=!1;const _=()=>{h||(h=!0,u.play().then(()=>{h=!1}).catch(a=>{console.error("Audio playback failed:",a),h=!1}),u.onended=()=>{h=!1})},v=async()=>{if(t.permissions==null){const e=await(await fetch("/user/permissions")).json();t.permissions=e.data}},L=async()=>{if(t.locations==null){const e=await(await fetch("/current-locations")).json();t.locations=e.data.map(o=>({value:o.id,label:o.name}))}},m=a=>{t.selectedLocation=a,localStorage.setItem("selectedLocation",a)};localStorage.getItem("selectedLocation")&&(t.selectedLocation=localStorage.getItem("selectedLocation"));const C=(a,e)=>{a.child(e).on("value",async function(o){const s=o.val();if(s&&s.sender_type==="user"){let c=t.chats.find(l=>l.id===s.conversation_id);c&&(c.unread=parseInt(c.unread)+1,c.last_sent=s.created_at,c.last_message=s.message,u.paused&&_())}})},y=a=>{if(a){const e=new Date(a),o=e.getHours().toString().padStart(2,"0"),s=e.getMinutes().toString().padStart(2,"0");return`${o}:${s}`}return""},x=async()=>{try{const e=(await k.get("/firebase/get")).data.response,o={apiKey:e.firebase_api_key,authDomain:e.firebase_auth_domain,databaseURL:e.firebase_database_url,projectId:e.firebase_project_id,storageBucket:e.firebase_storage_bucket,messagingSenderId:e.firebase_messaging_sender_id,appId:e.firebase_app_id};firebase.apps.length||firebase.initializeApp(o),firebase.database().ref("admin-notification").on("value",d=>{const i=d.val();if(i){const f=Object.keys(i).map(r=>({id:r,...i[r]})).filter(r=>!r.read).sort((r,p)=>p.updated_at-r.updated_at);t.notifications=f,t.unreadNotification=f.length}else console.log("No notifications found.")});const c=firebase.database().ref("conversation");let l=new Set,S=!1;const I=await fetch("/chat/fetchChat").then(d=>d.json()).then(d=>d);t.chats=I,t.unreadChat=0,t.chats.forEach(d=>{d.unread&&(t.unreadChat+=parseInt(d.unread)),l.add(d.id),c.child(d.id).on("value",async function(i){var f=i.val();if(S&&f&&f.sender_type=="user"){let r=t.chats.find(p=>p.id===f.conversation_id);r&&(r.unread=parseInt(r.unread)+1,r.last_seen=y(f.created_at),r.last_message=f.message,t.unreadChat++,_())}})}),setTimeout(()=>{S=!0},4e3),c.on("child_added",async function(d){if(S){const i=d.val();if(l.has(i.conversation_id))return;if(console.log("child added"),(await k.get(`/chat/verify-chat?conversationId=${i.conversation_id}`)).data.data){l.add(i.conversation_id);const p=await $(i.sender_id);let V={id:i.conversation_id,unread:1,subject:p.name,profile_picture:p.profile_picture,last_seen:y(i.created_at),last_message:i.message};C(c,i.conversation_id),t.unreadChat++,t.chats.unshift(V),_()}}})}catch(a){console.error("Error initializing Firebase or fetching settings:",a)}},B=async a=>{try{const o=(await firebase.database().ref(`admin-notification/${a}`).once("value")).val();o?(console.log("Snapshot Data:",o),o.read||(await firebase.database().ref(`admin-notification/${a}`).update({read:!0}),await new Promise(s=>setTimeout(s,100)),await firebase.database().ref(`admin-notification/${a}`).remove(),o.read=!0,t.unreadNotification=t.notifications.filter(s=>!s.read).length,console.log("Notification marked as read:",a)),o.url&&(window.location.href=o.url)):console.error("Notification not found in Firebase:",a)}catch(e){console.error("Error fetching, updating, or removing notification:",e)}},$=async a=>{try{return(await k.get(`/chat/fetch-user?user_id=${a}`)).data}catch(e){console.error(e)}},T=async a=>{try{const e=t.chats.find(o=>o.id==a);t.unreadChat-=e.unread,t.chats=t.chats.filter(o=>o.id!==a)}catch(e){console.error(e)}},E=async(a="notification")=>{try{if(t.unreadNotification>0&&a=="notification"){const e=firebase.database().ref("admin-notification"),s=(await e.once("value")).val();if(s){const c={};Object.keys(s).forEach(l=>{c[`${l}/read`]=!0}),await e.update(c),t.notifications.forEach(l=>l.read=!0),t.unreadNotification=0,window.location.reload()}}t.unreadChat>0&&a=="chat"&&(await fetch("/chat/readAll").then(e=>e.json()).then(e=>e),t.chats=[],t.unreadChat=0)}catch(e){console.error("Error marking all notifications as read:",e)}};return{...D(t),fetchData:n,fetchLocations:L,setServiceLocation:m,fetchFirebaseSettings:x,handleNotificationClick:B,handleMarkAllAsRead:E,markChatAsRead:T,playAudioOnce:_,fetchPermissions:v}}const W={data(){return{footerContent1:window.footer_content1,footerContent2:window.footer_content2}}},U={class:"footer"},H={class:"text-sm-start d-none d-sm-block"},J={class:"text-sm-center d-none d-sm-block"};function K(n,u,h,_,v,L){const m=j("BCol"),C=j("BRow"),y=j("BContainer");return P(),M("footer",U,[b(y,{fluid:""},{default:g(()=>[b(C,null,{default:g(()=>[b(m,{col:"",sm:"4"},{default:g(()=>[w("div",H,N(v.footerContent1),1)]),_:1}),b(m,{col:"",sm:"4"},{default:g(()=>[w("div",J,N(v.footerContent2),1)]),_:1}),b(m,{col:"",sm:"4"},{default:g(()=>u[0]||(u[0]=[w("div",{class:"text-sm-end d-none d-sm-block"},[O(" App version "),w("span",{class:"badge bg-success-subtle text-success fs-12"},"2.0")],-1)])),_:1,__:[0]})]),_:1})]),_:1})])}const Y=F(W,[["render",K]]);export{Y as F,Q as a,G as l,X as u};
