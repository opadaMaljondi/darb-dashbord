import{_ as F,Z as I,O as R,P as V,B as E,D as U,r as p,T as W,o as Y,S as G,g as f,i as l,y as A,w as g,a as J,W as S,N as Z,l as _,n as e,J as a,k as d,F as K,L as Q,q as H,z as m,p as N,C as y}from"./vendor-54d6cb1e.js";import{L as X}from"./dispatchmain-7b8a389c.js";import{P as ee}from"./page-header-ff719701.js";import{P as te}from"./Pagination-b5e3d5c9.js";import{s as se}from"./search-06463c60.js";import{s as ie}from"./searchbar-3bdb3315.js";import"./footer-7e4f68d9.js";import{_ as ae}from"./search-file-ab3e1046.js";import"./dispatchHorizontal-f9ab2bd0.js";import"./app-cb082573.js";const oe={data(){return{rightOffcanvas:!1}},components:{Layout:X,PageHeader:ee,Head:I,Pagination:te,Multiselect:R,flatPickr:V,Link:E,search:se,searchbar:ie},props:{successMessage:String,alertMessage:String,zones:Object,service_location_id:String,firebaseConfig:Object,ongoing_rides:Object,types:Object},setup(i){const{t:s}=U(),T=p(""),o=W({transport_type:"all",ride_status:"all",is_bid_ride:null,zone_id:null,service_location_id:i.service_location_id,vehicle_type_id:null,is_paid:null}),z=p(i.zones),O=p(i.types),r=p(i.ongoing_rides),C=p(!1),h=p(!1),k=p(null),B=p(i.successMessage||""),w=p(i.alertMessage||""),x=p([]),D=()=>{B.value="",w.value=""},L=()=>{h.value=!0},q=()=>{o.reset(),h.value=!1};Y(async()=>{try{const n=i.firebaseConfig;firebase.apps.length||firebase.initializeApp(n);const v=firebase.database();r.value.forEach(b=>{v.ref(`requests/${b.id}`).on("value",function(j){const u=r.value.findIndex(c=>c.id===b);if(u!==-1){const c=j.val();c.accept!==1&&(r.value[u].driver_id=null),c.driver_id&&(r.value[u].driver_id=c.driver_id),c.hasOwnProperty("modified_by_driver")&&(r.value[u].is_driver_started=1),c.trip_arrived==1&&(r.value[u].is_driver_arrived=!0),c.trip_start==1&&(r.value[u].is_trip_start=!0),c.is_completed&&(r.value[u].is_completed=!0,setTimeout(()=>{r.value.splice(u,1)},2e3)),(c.is_cancelled||c.is_cancel)&&(r.value[u].is_cancelled=!0,setTimeout(()=>{r.value.splice(u,1)},2e3))}})})}catch(n){console.error(s("error_initializing_firebase_or_fetching_settings"),n)}});const t=()=>{C.value=!1},M=async n=>{try{const v=await J.get(`/dispatcher/rides_request/cancel/${n}`),b=r.value.findIndex($=>$.id===n);b!==-1&&(r.value[b]=v.data.request),C.value=!1,S.fire(s("success"),s("trip_cancelled_successfully"),"success")}catch(v){console.log(v),S.fire(s("error"),s("failed_to_cancel_trip"),"error")}};return{results:r,modalShow:C,deleteItemId:k,successMessage:B,alertMessage:w,filterData:L,deleteModal:async n=>{S.fire({title:"Are you sure?",text:"You want to be cancel this ride!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#34c38f",cancelButtonColor:"#f46a6a",confirmButtonText:"Yes, Cancel!",cancelButtonText:"Close"}).then(async v=>{if(v.isConfirmed)try{await M(n)}catch(b){console.error(s("error_deleting_data"),b),S.fire(s("error"),s("failed_to_cancel_the_data"),"error")}})},closeModal:t,deleteData:M,dismissMessage:D,searchTerm:T,modalFilter:h,clearFilter:q,filter:o,zones:z,types:O,rideStatus:n=>n.is_cancelled?"Cancelled":n.is_completed?"Completed":n.is_trip_start?"On Trip":n.is_driver_arrived?"Driver Arrived":n.is_later&&n.is_driver_started?"Driver Started":n.is_driver_started?"Accepted":n.is_later?"Upcoming":"Searching",editData:async n=>{Z.get(`/dispatcher/rides_request/view/${n.id}`)},zoneList:x}},computed:{...G(["permissions"])}},ne={class:"table-responsive"},re={class:"table align-middle position-relative table-nowrap"},le={class:"table-active"},de={scope:"col"},ce={scope:"col"},_e={scope:"col"},ue={scope:"col"},pe={scope:"col"},fe={scope:"col"},ge={scope:"col"},me={scope:"col"},ve={key:0},be={key:0},ye={key:1},he={key:2},Ce={class:"dropdown"},we={class:"dropdown-menu dropdown-menu-end"},ke=["onClick"],Be={key:1},Me=["onClick"],Se={key:2},xe={key:1},De={colspan:"10",class:"text-center"},Le={key:0,class:"custom-alert alert alert-success alert-border-left fade show",data:"alert",id:"alertMsg"},qe={class:"alert-content"},Te={key:1,class:"custom-alert alert alert-danger alert-border-left fade show",data:"alert",id:"alertMsg"},ze={class:"alert-content"};function Oe(i,s,T,o,z,O){const r=f("Head"),C=f("PageHeader"),h=f("BCol"),k=f("BRow"),B=f("BCardHeader"),w=f("BBadge"),x=f("Link"),D=f("BCardBody"),L=f("BCard"),q=f("Layout");return l(),A(q,null,{default:g(()=>[_(r,{title:i.$t("ongoing-rides")},null,8,["title"]),_(C,{title:i.$t("ongoing-rides"),pageTitle:i.$t("ongoing-rides")},null,8,["title","pageTitle"]),_(k,null,{default:g(()=>[_(h,{lg:"12"},{default:g(()=>[_(L,{"no-body":"",id:"tasksList"},{default:g(()=>[_(B,{class:"border-0"},{default:g(()=>[_(k,{class:"g-2"},{default:g(()=>[_(h,{md:"3"})]),_:1})]),_:1}),_(D,{class:"border border-dashed border-end-0 border-start-0"},{default:g(()=>[e("div",ne,[e("table",re,[e("thead",le,[e("tr",null,[e("th",de,a(i.$t("request_id")),1),e("th",ce,a(i.$t("date")),1),e("th",_e,a(i.$t("user_name")),1),e("th",ue,a(i.$t("driver_name")),1),e("th",pe,a(i.$t("transport_type")),1),e("th",fe,a(i.$t("trip_status")),1),e("th",ge,a(i.$t("payment_option")),1),e("th",me,a(i.$t("action")),1)])]),o.results.length>0?(l(),d("tbody",ve,[(l(!0),d(K,null,Q(o.results,(t,M)=>(l(),d("tr",{key:M},[e("td",null,a(t.request_number),1),e("td",null,a(t.converted_created_at),1),e("td",null,a(t.userDetail?t.userDetail.name:"----"),1),e("td",null,a(t.driverDetail?t.driverDetail.name:"----"),1),e("td",null,[t.transport_type==="taxi"?(l(),d("span",be,a(i.$t("taxi"))+" "+a(t.is_bid_ride?i.$t("bidding"):""),1)):t.transport_type==="delivery"?(l(),d("span",ye,a(i.$t("delivery"))+" "+a(t.is_bid_ride?i.$t("bidding"):""),1)):(l(),d("span",he,a(i.$t("all")),1))]),e("td",null,[_(w,{class:H({"text-uppercase":!0,"text-bg-success":o.rideStatus(t)==="Completed"||o.rideStatus(t)==="Accepted"||o.rideStatus(t)==="Driver Started","text-bg-danger":o.rideStatus(t)==="Cancelled","text-bg-info":o.rideStatus(t)==="On Trip","text-bg-warning":o.rideStatus(t)==="Upcoming"||o.rideStatus(t)==="Driver Arrived"||o.rideStatus(t)==="Searching"})},{default:g(()=>[m(a(o.rideStatus(t)),1)]),_:2},1032,["class"])]),e("td",null,[_(w,{class:H({"text-uppercase":!0,"text-bg-success":t.is_paid,"text-bg-danger":!t.is_paid})},{default:g(()=>[m(a(t.payment_opt==1?"Cash":t.payment_opt==2?"Wallet":"Card"),1)]),_:2},1032,["class"])]),e("td",null,[e("div",Ce,[s[5]||(s[5]=e("a",{class:"text-reset",href:"#","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},[e("span",{class:"text-muted fs-18"},[e("i",{class:"mdi mdi-dots-vertical"})])],-1)),e("div",we,[i.permissions.includes("dispatcher-ongoing-request-view")?(l(),d("div",{key:0,class:"dropdown-item",type:"button",onClick:N(P=>o.editData(t),["prevent"])},[s[2]||(s[2]=e("i",{class:"bx bx-show-alt align-center text-muted me-2"},null,-1)),m(" "+a(i.$t("view")),1)],8,ke)):y("",!0),i.permissions.includes("dispatcher-ongoing-request-cancel")?(l(),d("div",Be,[!t.is_cancelled&&!t.is_completed?(l(),d("div",{key:0,class:"dropdown-item",type:"button",onClick:N(P=>o.deleteModal(t.id),["prevent"])},[s[3]||(s[3]=e("i",{class:"bx bx-show-alt align-center text-muted me-2"},null,-1)),m(" "+a(i.$t("cancel")),1)],8,Me)):y("",!0)])):y("",!0),i.permissions.includes("dispatcher-ongoing-request-assign")?(l(),d("div",Se,[!t.driver_id&&!t.is_cancelled&&!t.is_completed?(l(),A(x,{key:0,class:"dropdown-item",type:"button",href:`ongoing_request/assign/${t.id}`},{default:g(()=>[s[4]||(s[4]=e("i",{class:"bx bx-show-alt align-center text-muted me-2"},null,-1)),m(" "+a(i.$t("assign")),1)]),_:1},8,["href"])):y("",!0)])):y("",!0)])])])]))),128))])):(l(),d("tbody",xe,[e("tr",null,[e("td",De,[s[6]||(s[6]=e("img",{src:ae,alt:"Loading...",style:{width:"100px"}},null,-1)),e("h5",null,a(i.$t("no_data_found")),1)])])]))])])]),_:1})]),_:1})]),_:1})]),_:1}),e("div",null,[o.successMessage?(l(),d("div",Le,[e("div",qe,[s[7]||(s[7]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),s[8]||(s[8]=m()),s[9]||(s[9]=e("strong",null,"Success",-1)),m(" - "+a(o.successMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-success",onClick:s[0]||(s[0]=(...t)=>o.dismissMessage&&o.dismissMessage(...t)),"aria-label":"Close Success Message"})])])):y("",!0),o.alertMessage?(l(),d("div",Te,[e("div",ze,[s[10]||(s[10]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),s[11]||(s[11]=m()),s[12]||(s[12]=e("strong",null,"Alert",-1)),m(" - "+a(o.alertMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-danger",onClick:s[1]||(s[1]=(...t)=>o.dismissMessage&&o.dismissMessage(...t)),"aria-label":"Close Alert Message"})])])):y("",!0)])]),_:1})}const We=F(oe,[["render",Oe]]);export{We as default};
